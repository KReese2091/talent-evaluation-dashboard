<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calibration Discussion Prep Tool - Working Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #A4DBE8 0%, #00AFD7 100%);
            color: #11224B;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
            padding: 0;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #11224B;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px 0;
            z-index: 1000;
            box-shadow: 0 2px 12px rgba(17, 34, 75, 0.15);
            border-bottom: 3px solid #0073CE;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            height: 80px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 115, 206, 0.15));
            flex-shrink: 0;
        }

        .header-text {
            text-align: center;
            flex-grow: 0;
        }

        .header h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 600;
            color: #11224B;
            line-height: 1.2;
            text-align: center;
        }

        .header p {
            margin: 8px 0 0 0;
            font-size: 18px;
            color: #666666;
            font-weight: 400;
            line-height: 1.3;
            text-align: center;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #11224B 0%, #112756 100%);
            padding: 120px 0 20px 0;
            box-shadow: 4px 0 12px rgba(17, 34, 75, 0.3);
            position: relative;
        }

        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0 20px;
        }

        .step {
            width: 100%;
            text-align: left;
            padding: 16px 20px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .step:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .step.active {
            background: #0067A0;
            border-color: #00AFD7;
            box-shadow: 0 4px 12px rgba(0, 103, 160, 0.4);
        }

        .step.completed {
            background: #00358E;
            border-color: #0067A0;
        }

        .step.completed::after {
            content: "✓";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #A4DBE8;
            font-weight: bold;
            font-size: 16px;
        }

        /* Evaluation Mode Sidebar Styles */
        .current-employee-info {
            padding: 0 15px 20px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .current-employee-info h4 {
            color: white;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .employee-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .employee-card .employee-name {
            color: white !important;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .employee-card .employee-position {
            color: #A4DBE8 !important;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .employee-card .employee-status {
            color: white !important;
            font-size: 11px;
            font-weight: 500;
        }

        .progress-steps {
            padding: 20px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-steps h4 {
            color: white;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .progress-steps .step {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .progress-steps .step:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-steps .step.active {
            background: rgba(0, 175, 215, 0.3);
            border: 1px solid #00AFD7;
        }

        .progress-steps .step.completed {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid #28a745;
        }

        .step-number {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .progress-steps .step.active .step-number {
            background: #00AFD7;
        }

        .progress-steps .step.completed .step-number {
            background: #28a745;
        }

        .step-title {
            color: #A4DBE8;
            font-size: 11px;
            font-weight: 500;
        }

        .progress-steps .step.active .step-title {
            color: white;
        }

        .progress-steps .step.completed .step-title {
            color: #90ee90;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 120px 40px 20px 40px;
            background: linear-gradient(135deg, #A4DBE8 0%, #00AFD7 100%);
            overflow-y: auto;
        }

        /* Progress Indicator */
        .progress-indicator {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 25px;
            margin: 0 -25px 0 -25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: none; /* Hidden by default, shown in evaluation mode */
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-title {
            font-size: 14px;
            font-weight: 600;
            color: #11224B;
        }

        .progress-percentage {
            font-size: 16px;
            font-weight: 700;
            color: #0067A0;
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00AFD7 0%, #0067A0 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-current-step {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        /* Horizontal Step Navigation */
        .horizontal-step-nav {
            background: linear-gradient(90deg, #11224B 0%, #112756 100%);
            padding: 12px 0;
            margin: 0 -25px 20px -25px;
            border-radius: 0;
            box-shadow: 0 2px 8px rgba(17, 34, 75, 0.2);
        }

        .step-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .step-navigation .step {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .step-navigation .step:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .step-navigation .step.active {
            background: #0067A0;
            border-color: #00AFD7;
            box-shadow: 0 4px 12px rgba(0, 103, 160, 0.4);
        }

        .step-navigation .step.completed {
            background: #00AFD7;
            color: #11224B;
        }

        .step-navigation .step.completed::after {
            content: "✓";
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #00AFD7;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Content Area */
        .content-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 24px rgba(17, 34, 75, 0.15);
            margin: 0 auto 20px auto;
            min-height: calc(100vh - 200px);
            max-width: 800px;
        }

        .slide {
            display: none;
        }

        .slide.active {
            display: block;
        }

        h2 {
            color: #11224B;
            margin-bottom: 10px;
            font-size: 22px;
        }

        .description {
            color: #666;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.4;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #11224B;
            font-size: 13px;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0067A0;
        }

        input[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        /* Rating Buttons */
        .rating-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .rating-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            min-width: 120px;
        }

        .rating-btn:hover {
            border-color: #0067A0;
            transform: translateY(-1px);
        }

        .rating-btn.selected {
            border-color: #0067A0;
            background: #f0f8ff;
        }

        .rating-btn strong {
            display: block;
            color: #11224B;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .rating-btn small {
            color: #666;
            font-size: 11px;
        }

        /* Smart Suggestions */
        .suggestions {
            background: #f0f8ff;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .suggestions h4 {
            margin-bottom: 6px;
            color: #0067A0;
            font-size: 14px;
        }

        .suggestion-item {
            background: white;
            padding: 8px;
            margin: 6px 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            border: 1px solid #ddd;
            transition: all 0.2s;
        }

        .suggestion-item:hover {
            background: #0067A0;
            color: white;
            transform: translateX(5px);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(17, 34, 75, 0.1);
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #00AFD7;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #0096b8;
        }

        .btn-primary.step-ready {
            background: #00AFD7 !important;
            box-shadow: 0 2px 8px rgba(0, 175, 215, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary.step-ready:hover {
            background: #0096b8 !important;
            transform: scale(1.05);
        }

        .btn-outline {
            background: transparent;
            color: #0067A0;
            border: 2px solid #0067A0;
        }

        .btn-outline:hover {
            background: #0067A0;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: 2px solid #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
            border-color: #5a6268;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .step-info {
            font-weight: 500;
            color: #11224B;
        }







        .help-content li {
            margin-bottom: 10px;
            line-height: 1.5;
            color: #333;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 120px 0 20px 0;
            }
            
            .progress-steps {
                flex-direction: row;
                overflow-x: auto;
                gap: 10px;
                padding: 0 20px;
            }
            
            .step {
                min-width: 150px;
                text-align: center;
                padding: 12px 16px;
                font-size: 12px;
            }
            
            .main-content {
                padding: 120px 20px 20px 20px;
            }
            
            .step-navigation {
                gap: 15px;
                padding: 0 15px;
            }
            
            .step-navigation .step {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
            
            .header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: white;
                border-bottom: 2px solid #0073CE;
            }
            
            .header-content {
                flex-direction: column;
                gap: 20px;
                padding: 0 15px;
            }
            
            .logo {
                height: 60px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .header p {
                font-size: 16px;
            }
            
            .header-text {
                text-align: center;
            }
            
            .content-card {
                min-height: auto;
            }
        }

        @media (max-width: 768px) {
            .step-navigation {
                gap: 10px;
                padding: 0 10px;
                overflow-x: auto;
            }
            
            .step-navigation .step {
                width: 40px;
                height: 40px;
                font-size: 14px;
                flex-shrink: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .rating-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .rating-btn {
                min-width: auto;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 6px;
            }
            
            .content-card {
                max-width: none;
                margin: 0 0 20px 0;
            }
        }

        /* Reviewer Dashboard Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #A4DBE8 0%, #00AFD7 100%);
        }

        .login-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 24px rgba(17, 34, 75, 0.15);
            max-width: 500px;
            width: 100%;
        }

        .login-card h2 {
            margin-bottom: 10px;
            color: #11224B;
            text-align: center;
        }

        .login-card p {
            margin-bottom: 30px;
            color: #666;
            text-align: center;
        }

        .demo-reviewers {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .demo-reviewers h4 {
            margin-bottom: 15px;
            color: #11224B;
        }

        .demo-reviewers .btn {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
        }

        .quick-guide {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .quick-guide h4 {
            margin-bottom: 15px;
            color: #11224B;
            font-size: 16px;
        }

        .guide-steps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .guide-step {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #11224B;
            border-left: 3px solid #00AFD7;
        }

        .guide-note {
            font-size: 12px;
            color: #666;
            margin: 0;
            text-align: center;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 4px;
        }

        /* Enhanced Reviewer Search Styles */
        .reviewer-search-container {
            position: relative;
        }

        .reviewer-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }

        .dropdown-loading {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .reviewer-option {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f3f6;
            transition: all 0.2s ease;
            position: relative;
        }

        .reviewer-option:last-child {
            border-bottom: none;
        }

        .reviewer-option:hover, .reviewer-option.highlighted {
            background-color: #f0f8ff;
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0, 115, 206, 0.1);
        }

        .reviewer-option.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #0073CE;
        }

        .reviewer-name {
            font-weight: 600;
            color: #11224B;
            margin-bottom: 0;
            font-size: 15px;
            line-height: 1.3;
        }

        .team-size {
            display: inline-block;
            background: #0073CE;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .no-results {
            padding: 20px;
            text-align: center;
            color: #999;
            font-style: italic;
        }

        /* Employee Search Dropdown Styles */
        .employee-search-container {
            position: relative;
            padding: 0 20px;
            margin-bottom: 15px;
        }

        .employee-search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .employee-search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .employee-search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #00AFD7;
            box-shadow: 0 0 0 2px rgba(0, 175, 215, 0.3);
        }

        .employee-dropdown {
            position: absolute;
            top: 100%;
            left: 20px;
            right: 20px;
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }

        .employee-option {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f3f6;
            transition: background-color 0.2s ease;
        }

        .employee-option:last-child {
            border-bottom: none;
        }

        .employee-option:hover, .employee-option.highlighted {
            background-color: #f8f9fa;
        }

        .employee-option.selected {
            background-color: #f1f3f4;
            border-left: 3px solid #0073CE;
        }

        .employee-name {
            font-weight: 600;
            color: #11224B;
            margin-bottom: 4px;
            font-size: 15px;
            line-height: 1.3;
        }

        .employee-status-info {
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .status-indicator.completed {
            background: #e8f5e8;
            color: #2e7d2e;
        }

        .status-indicator.inprogress {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-indicator.notstarted {
            background: #f5f5f5;
            color: #666;
        }

        .reviewer-info {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .reviewer-info h3 {
            margin: 0;
            color: white;
            font-size: 17px;
            font-weight: 600;
        }

        .reviewer-info p {
            margin: 5px 0 15px 0;
            color: #A4DBE8;
            font-size: 14px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .employee-list {
            margin-bottom: 30px;
        }

        .employee-list h4 {
            color: white;
            margin-bottom: 15px;
            padding: 0 20px;
        }

        /* Search Styles */
        .search-section {
            padding: 0 20px;
            margin-bottom: 15px;
        }

        .search-container {
            position: relative;
            margin-bottom: 12px;
        }

        .employee-search {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .employee-search::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .employee-search:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #00AFD7;
            box-shadow: 0 0 0 2px rgba(0, 175, 215, 0.3);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        .clear-search {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .clear-search:hover {
            background: rgba(255, 255, 255, 0.3);
        }



        /* Old employee dropdown styles - replaced by new searchable dropdown */

        .employee-actions-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .selected-employee-info {
            color: white;
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 14px;
        }

        .smart-actions-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .smart-action-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
        }

        .smart-action-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(2px);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .action-buttons .btn {
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            white-space: nowrap;
        }

        .action-buttons .btn-primary {
            background: #00AFD7;
            color: white;
            grid-column: 1 / -1; /* Span full width */
        }

        .action-buttons .btn-primary:hover {
            background: #0096b8;
        }

        .action-buttons .btn-download {
            background: #28a745;
            color: white;
        }

        .action-buttons .btn-download:hover:not(:disabled) {
            background: #1e7e34;
        }

        .action-buttons .btn-download:disabled {
            background: #6c757d;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-buttons .btn-archive {
            background: #6c757d;
            color: white;
        }

        .action-buttons .btn-archive:hover {
            background: #5a6268;
        }

        .action-buttons .btn-delete {
            background: #dc3545;
            color: white;
        }

        .action-buttons .btn-delete:hover {
            background: #c82333;
        }

        .employee-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 4px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-content {
            flex: 1;
            cursor: pointer;
        }

        .employee-item:hover {
            background: rgba(255, 255, 255, 0.35) !important;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .employee-actions {
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .employee-item:hover .employee-actions {
            opacity: 1;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-left: 4px;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .btn-archive {
            background: #6c757d;
            color: white;
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-right: 3px;
        }

        .btn-archive:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        .btn-restore {
            background: #28a745;
            color: white;
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-right: 3px;
        }

        .btn-restore:hover {
            background: #218838;
            transform: scale(1.1);
        }

        .btn-download {
            background: #0073CE;
            color: white;
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-right: 3px;
        }

        .btn-download:hover:not(.disabled) {
            background: #005a9d;
            transform: scale(1.1);
        }

        .btn-download.disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-download.disabled:hover {
            transform: none;
        }

        .archived-employees {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .archived-toggle {
            cursor: pointer;
            color: #ccc;
            font-size: 14px;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .archived-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .employee-item.archived {
            opacity: 0.7;
            border-left-color: #6c757d;
        }

        .archived-status {
            color: #6c757d;
            font-size: 12px;
        }

        .employee-item.completed {
            border-left-color: #28a745;
        }

        .employee-item.in-progress {
            border-left-color: #ffc107;
        }

        .employee-item.not-started {
            border-left-color: #6c757d;
        }

        .employee-name {
            color: white;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.3;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .employee-position {
            color: #ffffff !important;
            font-size: 12px;
            margin: 1px 0;
            opacity: 0.85 !important;
            font-weight: 500 !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .employee-status {
            font-size: 12px;
            font-weight: 500;
            margin-top: 5px;
        }

        .status-completed {
            color: #28a745 !important;
            font-weight: 400 !important;
        }

        .status-in-progress {
            color: #ffc107 !important;
            font-weight: 400 !important;
        }

        .status-not-started {
            color: #6c757d !important;
            font-weight: 400 !important;
        }

        .btn-add-employee {
            width: 100%;
            margin: 15px 20px 0 20px;
            width: calc(100% - 40px);
        }

        /* Undo/Redo Button Styles */
        .undo-redo-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
            min-height: 32px;
        }

        .undo-redo-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        .undo-redo-btn:disabled {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
        }

        .undo-redo-btn:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 175, 215, 0.25);
        }

        .undo-redo-btn .btn-icon {
            font-size: 14px;
            font-weight: bold;
        }

        .undo-redo-btn .btn-text {
            font-weight: 500;
        }

        .undo-redo-btn:disabled .btn-icon,
        .undo-redo-btn:disabled .btn-text {
            opacity: 0.5;
        }

        /* Undo/Redo Controls Panel */
        .undo-redo-controls {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .undo-redo-controls h5 {
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .undo-redo-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .undo-redo-note {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            line-height: 1.3;
        }

        .team-summary {
            padding: 0 15px;
        }

        .team-summary h4 {
            color: white;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-stats {
            display: flex;
            gap: 8px;
            justify-content: space-around;
        }

        .stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 4px;
            flex: 1;
        }

        .stat-number {
            display: block;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .stat-label {
            color: #A4DBE8;
            font-size: 10px;
        }

        .summary-actions-simple {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .summary-textarea {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }

        .dashboard-welcome {
            text-align: center;
        }

        .quick-actions {
            margin: 40px 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .recent-activity {
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
        }

        .activity-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-main {
            flex: 1;
            min-width: 0;
        }

        .activity-name {
            font-weight: 600;
            color: #11224B;
            font-size: 15px;
            line-height: 1.3;
            margin-bottom: 2px;
        }

        .activity-action {
            color: #666;
            font-size: 14px;
            line-height: 1.3;
        }

        .activity-date {
            color: #666;
            font-size: 13px;
            white-space: nowrap;
            flex-shrink: 0;
            text-align: right;
            font-weight: 500;
        }

        .evaluation-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .btn-back {
            flex-shrink: 0;
        }

        .employee-info {
            flex-grow: 1;
        }

        .employee-info h2 {
            margin: 0;
            color: #11224B;
            font-size: 18px;
        }

        .employee-info p {
            margin: 5px 0 0 0;
            color: #666;
        }

        .employee-status-line {
            font-weight: 400 !important;
            font-size: 12px;
        }

        .employee-status-line span {
            font-weight: 400 !important;
        }

        .progress-indicator {
            margin-bottom: 20px;
        }

        .progress-indicator .progress-steps {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .progress-indicator .step {
            background: #e9ecef;
            color: #6c757d;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .progress-indicator .step.active {
            background: #0067A0;
            color: white;
        }

        .progress-indicator .step.completed {
            background: #28a745;
            color: white;
        }

        /* Status Change Notification */
        .status-notification {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1001;
            animation: slideInRight 0.3s ease-out;
        }

        .notification-content {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .notification-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        .notification-text {
            color: #856404;
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: #856404;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .notification-close:hover {
            background-color: rgba(133, 100, 4, 0.1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* AI Writing Coach */
        .writing-coach {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border: 1px solid #0067A0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .coach-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .coach-header h4 {
            color: #0067A0;
            margin: 0;
            margin-left: 8px;
            font-size: 14px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 8px;
            margin-bottom: 10px;
        }

        .metric {
            text-align: center;
            padding: 6px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .metric.good {
            border-color: #28a745;
        }

        .metric.warning {
            border-color: #ffc107;
        }

        .metric.poor {
            border-color: #dc3545;
        }

        .metric-value {
            font-size: 16px;
            font-weight: bold;
            display: block;
        }

        .metric.good .metric-value {
            color: #28a745;
        }

        .metric.warning .metric-value {
            color: #ffc107;
        }

        .metric.poor .metric-value {
            color: #dc3545;
        }

        .metric-label {
            font-size: 10px;
            color: #666;
            margin-top: 3px;
        }

        .bias-alerts {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 6px;
            margin-top: 8px;
        }

        .bias-alert {
            color: #856404;
            font-size: 11px;
            margin: 3px 0;
        }

        .bias-alert strong {
            color: #dc3545;
        }

        /* Carousel Slide Styles */
        .slide {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            padding: 0;
        }

        .slide.active {
            display: block;
            opacity: 1;
        }

        /* Professional Analytics Container */
        .analytics-container {
            display: block;
            padding: 0;
            background: transparent;
            border-radius: 0;
            margin: 0;
            max-width: 100%;
        }

        .insights-section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0, 175, 215, 0.1);
            border: 1px solid #e9ecef;
            margin-bottom: 32px;
            min-height: 200px;
        }

        .insights-section h3 {
            margin: 0 0 32px 0;
            color: #212529;
            font-size: 28px;
            font-weight: 700;
            padding-bottom: 16px;
            border-bottom: 4px solid #00AFD7;
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .insights-section h3::before {
            content: '';
            width: 6px;
            height: 32px;
            background: linear-gradient(135deg, #00AFD7 0%, #FFC220 100%);
            border-radius: 3px;
        }

        /* Consistent Grid Layout for All Content */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analytics-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #00AFD7;
            height: fit-content;
        }

        .analytics-card h4 {
            margin: 0 0 12px 0;
            color: #212529;
            font-size: 16px;
            font-weight: 600;
        }

        .analytics-card p {
            margin: 0;
            color: #495057;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Consistent Pattern Cards */
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pattern-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #00AFD7;
            border: 1px solid #e9ecef;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .pattern-title {
            font-weight: 600;
            color: #212529;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .pattern-description {
            font-size: 14px;
            color: #495057;
            margin-bottom: 8px;
            line-height: 1.4;
            flex-grow: 1;
        }

        .pattern-data {
            font-size: 14px;
            color: #00AFD7;
            font-weight: 600;
        }

        /* Clean Metric Display */
        .insight-metric {
            display: inline-block;
            background: #00AFD7;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            margin: 0;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .insight-metric.secondary {
            background: #FFC220;
            color: #212529;
        }

        /* Compact Performance Snapshot */
        .performance-snapshot {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 8px 0;
        }

        .snapshot-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .snapshot-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .snapshot-label {
            font-size: 12px;
            font-weight: 500;
            color: #495057;
        }

        .snapshot-item.exemplary .snapshot-number { color: #00AFD7; }
        .snapshot-item.successful .snapshot-number { color: #28a745; }
        .snapshot-item.opportunity .snapshot-number { color: #FFC220; }

        /* Simplified Rating Display - Removed (using snapshot instead) */

        /* Professional Bias Analysis */
        .bias-analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 0;
        }

        .bias-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .bias-type {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 8px;
        }

        .bias-count {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .bias-level {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .bias-card.high .bias-count { color: #dc3545; }
        .bias-card.high .bias-level { background: #dc3545; color: white; }
        .bias-card.medium .bias-count { color: #FFC220; }
        .bias-card.medium .bias-level { background: #FFC220; color: #212529; }
        .bias-card.low .bias-count { color: #00AFD7; }
        .bias-card.low .bias-level { background: #00AFD7; color: white; }

        .trend-chart {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .recommendations-list {
            list-style: none;
            padding: 0;
        }

        .recommendations-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .recommendation-icon {
            background: #00AFD7;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-top: 2px;
        }

        /* Professional Anomaly Detection */
        .anomaly-detection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 0;
        }

        .anomaly-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .anomaly-card.high {
            border-left: 4px solid #dc3545;
        }

        .anomaly-card.medium {
            border-left: 4px solid #FFC220;
        }

        .anomaly-card.low {
            border-left: 4px solid #00AFD7;
        }

        .anomaly-header {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 12px;
        }

        .anomaly-icon {
            font-size: 18px;
            line-height: 1;
        }

        .anomaly-info {
            flex: 1;
        }

        .anomaly-title {
            font-weight: 600;
            color: #212529;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .anomaly-severity {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .anomaly-card.high .anomaly-severity {
            background: #dc3545;
            color: white;
        }

        .anomaly-card.medium .anomaly-severity {
            background: #FFC220;
            color: #212529;
        }

        .anomaly-card.low .anomaly-severity {
            background: #00AFD7;
            color: white;
        }

        .anomaly-description {
            color: #666;
            font-size: 12px;
            line-height: 1.4;
            flex-grow: 1;
        }

        .anomaly-details {
            margin-top: 8px;
        }

        .anomaly-count {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .anomaly-recommendation {
            font-size: 12px;
            color: #495057;
            font-weight: 500;
        }

        .anomaly-count {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .anomaly-recommendation {
            font-size: 13px;
            color: #0073CE;
            font-style: italic;
        }

        .anomaly-summary {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .risk-indicator {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .risk-indicator.low {
            background: #00AFD7;
            color: white;
        }

        .risk-indicator.medium {
            background: #FFC220;
            color: #212529;
        }

        .risk-indicator.high {
            background: #dc3545;
            color: white;
        }

        /* Help Button and Tooltip Styles */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            position: relative;
        }

        .help-button {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0073CE, #FFC220);
            border: none;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 115, 206, 0.3);
        }

        /* No backdrop needed - clean tooltip system */
        .tooltip-backdrop {
            display: none !important;
        }

        .help-tooltip {
            position: fixed;
            background: white;
            border: 2px solid #00AFD7;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
            width: 380px;
            max-width: 90vw;
            max-height: 400px;
            overflow-y: auto;
            z-index: 999999999 !important;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            /* Position in upper right corner for consistent visibility */
            top: 20px;
            right: 20px;
        }

        .help-tooltip.show {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
            z-index: 999999999 !important;
        }

        /* Bold Evaluation Questions */
        .slide .description {
            font-weight: 700 !important;
            color: #2c3e50 !important;
            line-height: 1.5;
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* Remove arrow pointer since tooltip is now centered */
        .help-tooltip::before {
            display: none;
        }
        
        .help-tooltip.positioned-above::before {
            display: none;
        }

        .help-tooltip h4 {
            color: #00AFD7;
            margin: 0 0 16px 0;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 2px solid #00AFD7;
        }

        .help-tooltip h4::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #00AFD7, #FFC220);
            border-radius: 2px;
        }

        .help-tooltip p {
            color: #495057;
            margin: 0 0 16px 0;
            font-size: 15px;
            line-height: 1.6;
        }

        .help-tooltip ul {
            margin: 0 0 8px 0;
            padding-left: 20px;
            color: #495057;
            font-size: 15px;
        }

        .help-tooltip li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .help-tooltip li strong {
            color: #212529;
            font-weight: 600;
        }

        .help-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #6c757d;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .help-close:hover {
            color: #dc3545;
        }







        /* Team Report Modal Styles */
        .team-report-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(17, 34, 75, 0.8);
            z-index: 2000;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            padding-top: 5vh;
            overflow-y: auto;
        }

        .team-report-modal {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(17, 34, 75, 0.3);
            max-width: 900px;
            width: 100%;
            max-height: none;
            overflow-y: visible;
            position: relative;
            margin-bottom: 5vh;
        }

        .report-header {
            background: linear-gradient(135deg, #11224B 0%, #112756 100%);
            color: white;
            padding: 30px;
            border-radius: 12px 12px 0 0;
            position: relative;
        }

        .report-header h2 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: 600;
        }

        .report-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .report-content {
            padding: 30px;
        }

        .report-section {
            margin-bottom: 35px;
        }

        .report-section h3 {
            color: #11224B;
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 2px solid #0073CE;
            padding-bottom: 8px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 10px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: #0073CE;
            box-shadow: 0 4px 12px rgba(0, 115, 206, 0.15);
        }

        .metric-number {
            font-size: 36px;
            font-weight: bold;
            color: #11224B;
            line-height: 1;
            margin-bottom: 8px;
        }

        .metric-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .rating-distribution {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .rating-bar:last-child {
            margin-bottom: 0;
        }

        .rating-label {
            width: 100px;
            font-weight: 600;
            color: #11224B;
            font-size: 14px;
        }

        .rating-progress {
            flex: 1;
            background: #e9ecef;
            border-radius: 20px;
            height: 24px;
            position: relative;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            border-radius: 20px;
            transition: width 0.6s ease;
        }

        .rating-fill.exemplary {
            background: linear-gradient(90deg, #28a745, #34ce57);
        }

        .rating-fill.successful {
            background: linear-gradient(90deg, #0073CE, #1e88e5);
        }

        .rating-fill.opportunity {
            background: linear-gradient(90deg, #ffc107, #ffeb3b);
        }

        .rating-fill.not-rated {
            background: linear-gradient(90deg, #6c757d, #8d9297);
        }

        .rating-count {
            width: 30px;
            text-align: center;
            font-weight: bold;
            color: #11224B;
            font-size: 16px;
        }

        .employee-status-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .employee-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .employee-status-item:last-child {
            border-bottom: none;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            color: #11224B;
            font-size: 15px;
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .team-report-modal .employee-name {
            color: #11224B;
            font-weight: 600;
        }

        .employee-status-list .employee-name {
            color: #11224B;
            font-weight: 600;
        }

        .employee-position {
            color: #495057 !important;
            font-size: 14px;
            font-weight: 500;
        }

        .team-report-modal .employee-position {
            color: #495057 !important;
        }

        .status-info {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.in-progress {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-badge.not-started {
            background: #f8d7da;
            color: #721c24;
        }

        .rating-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 400;
            text-transform: capitalize;
        }

        .rating-badge.exemplary {
            background: #d4edda;
            color: #155724;
        }

        .rating-badge.successful {
            background: #cce7ff;
            color: #004085;
        }

        .rating-badge.opportunity {
            background: #fff3cd;
            color: #856404;
        }

        .rating-badge.not-set {
            background: #e9ecef;
            color: #6c757d;
        }

        .report-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .team-report-modal {
                margin: 10px;
                max-height: 95vh;
            }

            .report-header {
                padding: 20px;
            }

            .report-content {
                padding: 20px;
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
            }

            .employee-status-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .status-info {
                align-self: stretch;
                justify-content: flex-end;
            }

            .report-actions {
                flex-direction: column;
                align-items: stretch;
            }


        }

        /* Hide Navigation Buttons to Clean Up Interface */
        .navigation {
            display: none !important;
        }



        /* Hide Sidebar Step Navigation Buttons Only */
        .sidebar .progress-steps {
            display: none !important;
        }
        
        .sidebar .step {
            display: none !important;
        }

        /* Ensure Navigation Buttons Are Visible */
        .navigation {
            display: flex !important;
        }

        #prevBtn, #nextBtn, .step-info, #stepInfo {
            display: block !important;
        }

        /* Compact Executive Summary */
        .executive-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            padding: 0;
            margin: 0;
            background: transparent;
        }

        .exec-overview, .exec-insights, .exec-recommendations, .exec-actions {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            height: 180px;
            display: flex;
            flex-direction: column;
        }

        .exec-overview h4, .exec-insights h4, .exec-recommendations h4, .exec-actions h4 {
            color: #212529;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 2px solid #00AFD7;
        }

        .exec-overview p, .exec-insights p {
            color: #495057;
            font-size: 13px;
            line-height: 1.4;
            margin: 0 0 12px 0;
        }

        /* Ultra-Compact Executive Summary */
        .exec-overview, .exec-insights, .exec-recommendations, .exec-actions {
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .exec-actions {
            border-bottom: none;
            margin-bottom: 0;
        }

        .exec-overview h4, .exec-insights h4, .exec-recommendations h4, .exec-actions h4 {
            color: #FFC220;
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 4px 0;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .exec-overview p, .exec-insights p {
            margin: 0 0 6px 0;
            font-size: 12px;
            line-height: 1.3;
        }

        .performance-snapshot {
            display: flex;
            gap: 8px;
            margin-top: 6px;
            padding: 8px;
            background: rgba(0, 115, 206, 0.03);
            border-radius: 6px;
            border: 1px solid rgba(0, 115, 206, 0.1);
        }

        .snapshot-item {
            text-align: center;
            padding: 8px 6px;
            border-radius: 4px;
            min-width: 70px;
            flex: 1;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .snapshot-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .snapshot-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .snapshot-item.exemplary {
            background: linear-gradient(145deg, #f0f8ff 0%, #e3f2fd 100%);
            border: 2px solid rgba(0, 115, 206, 0.3);
        }

        .snapshot-item.exemplary::before {
            background: linear-gradient(90deg, #0073CE, #004c87);
        }

        .snapshot-item.successful {
            background: linear-gradient(145deg, #f0faff 0%, #e1f5fe 100%);
            border: 2px solid rgba(0, 175, 215, 0.3);
        }

        .snapshot-item.successful::before {
            background: linear-gradient(90deg, #00AFD7, #0073CE);
        }

        .snapshot-item.opportunity {
            background: linear-gradient(145deg, #fffcf0 0%, #fff8e1 100%);
            border: 2px solid rgba(255, 194, 32, 0.3);
        }

        .snapshot-item.opportunity::before {
            background: linear-gradient(90deg, #FFC220, #e6a800);
        }

        .snapshot-number {
            display: block;
            font-size: 20px;
            font-weight: 700;
            color: #0073CE;
            margin-bottom: 2px;
        }

        .snapshot-label {
            display: block;
            font-size: 10px;
            color: #495057;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .rec-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-grow: 1;
        }

        .rec-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #00AFD7;
            flex: 1;
        }

        .rec-priority {
            font-size: 10px;
            color: #00AFD7;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .rec-title {
            font-weight: 600;
            color: #212529;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .rec-desc {
            font-size: 11px;
            color: #495057;
            line-height: 1.3;
        }

        .action-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
        }

        .action-item {
            padding: 8px;
            background: #f8f9fa;
            border-left: 3px solid #FFC220;
            border-radius: 4px;
            font-size: 11px;
            line-height: 1.3;
            color: #495057;
        }

        /* Unified Design System - Team Roster */
        .team-roster {
            margin-bottom: 24px;
        }

        .roster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
        }

        .roster-grid .employee-card {
            background: white;
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e6ed;
            transition: all 0.2s ease;
        }

        .roster-grid .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 115, 206, 0.15);
            border-color: #0073CE;
        }

        .roster-grid .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f3f6;
        }

        .roster-grid .employee-name {
            font-weight: 600;
            color: #11224B;
            font-size: 15px;
            line-height: 1.3;
        }

        .roster-grid .employee-status {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .roster-grid .employee-rating {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .roster-grid .employee-rating.exemplary {
            background: #28a745;
            color: white;
        }

        .roster-grid .employee-rating.successful {
            background: #0073CE;
            color: white;
        }

        .roster-grid .employee-rating.opportunity {
            background: #FFC220;
            color: #2c3e50;
        }

        .roster-grid .employee-rating.not-rated {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #e0e6ed;
        }

        .roster-grid .employee-highlights {
            margin-top: 16px;
        }

        .roster-grid .employee-highlights h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .roster-grid .employee-highlights p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
            color: #495057;
        }

        .roster-grid .development-areas {
            margin-top: 16px;
            padding: 16px;
            background: #fff8e1;
            border-radius: 6px;
            border-left: 4px solid #FFC220;
            border: 1px solid #ffe082;
        }

        .roster-grid .development-areas h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #f57c00;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .roster-grid .development-areas p {
            margin: 0;
            font-size: 13px;
            line-height: 1.5;
            color: #ef6c00;
        }

        /* Unified Design System - Global Consistency */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e6ed;
        }

        .section-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .section-header .section-icon {
            font-size: 20px;
            color: #0073CE;
        }

        /* Standardize all chart containers */
        .chart-section {
            background: white;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e6ed;
        }

        /* Standardize metric cards */
        .metric-card {
            background: white;
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e6ed;
            text-align: center;
            transition: all 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 115, 206, 0.15);
            border-color: #0073CE;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #0073CE;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 14px;
            color: #6c757d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Unified button styles */
        .analytics-btn {
            background: linear-gradient(135deg, #0073CE 0%, #004c87 100%);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 115, 206, 0.2);
        }

        .analytics-btn:hover {
            background: linear-gradient(135deg, #005ba3 0%, #003d6b 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 115, 206, 0.3);
        }

        /* Enhanced Performance Patterns Styles */
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .pattern-card {
            background: white;
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e6ed;
            transition: all 0.2s ease;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .pattern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 115, 206, 0.15);
        }

        .pattern-card.chart {
            border-left: 4px solid #0073CE;
        }

        .pattern-card.strength {
            border-left: 4px solid #28a745;
            background: linear-gradient(135deg, #f8fff8 0%, #ffffff 100%);
        }

        .pattern-card.warning {
            border-left: 4px solid #FFC220;
            background: linear-gradient(135deg, #fffbf0 0%, #ffffff 100%);
        }

        .pattern-card.info {
            border-left: 4px solid #17a2b8;
        }

        .pattern-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .pattern-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .pattern-icon {
            font-size: 18px;
        }

        .pattern-description {
            color: #495057;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .pattern-data {
            color: #6c757d;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: auto;
        }

        /* Mini Chart Styles */
        .mini-chart {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #f0f3f6;
        }

        .chart-bar {
            display: flex;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background: #f8f9fa;
            margin-bottom: 12px;
        }

        .bar-segment {
            height: 100%;
            transition: all 0.3s ease;
        }

        .bar-segment.exemplary {
            background: #28a745;
        }

        .bar-segment.successful {
            background: #0073CE;
        }

        .bar-segment.opportunity {
            background: #FFC220;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #6c757d;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-color.exemplary {
            background: #28a745;
        }

        .legend-color.successful {
            background: #0073CE;
        }

        .legend-color.opportunity {
            background: #FFC220;
        }

        /* Rating Distribution Bars (from original section) */
        .rating-distribution {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 20px 0;
            min-height: 120px;
        }

        .rating-bar {
            text-align: center;
            min-width: 80px;
        }

        .rating-bar-fill {
            background: #f0f0f0;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            border-radius: 4px;
            min-height: 20px;
            transition: all 0.3s ease;
        }

        .rating-bar-fill.exemplary {
            background: #28a745;
        }

        .rating-bar-fill.successful {
            background: #0073CE;
        }

        .rating-bar-fill.opportunity {
            background: #FFC220;
            color: #2c3e50;
        }

        .rating-label {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .rating-percentage {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .rating-visualization {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #f0f3f6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <!-- Sam's Club Logo -->
            <img src="sams-club-logo.png" alt="Sam's Club" class="logo">
            
            <div class="header-text">
                <h1>Calibration Discussion Prep Tool</h1>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar (hidden in evaluation mode, shown in reviewer dashboard) -->
        <div class="sidebar" id="mainSidebar" style="display: none;">
        </div>

        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <!-- Progress Indicator (only shown in evaluation mode) -->
            <div class="progress-indicator" id="progressIndicator">
                <div class="progress-header">
                    <div class="progress-title">Evaluation Progress</div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
                <div class="progress-current-step" id="progressCurrentStep">Step 1 of 7: Basic Information & Overall Rating</div>
            </div>
            <!-- Horizontal Step Navigation (only shown in evaluation mode) -->
            <div class="horizontal-step-nav" id="stepNavigation">
                <div class="step-navigation">
                    <div class="step active" onclick="goToStep(0)" title="Basic Information & Rating">1</div>
                    <div class="step" onclick="goToStep(1)" title="Key Priorities">2</div>
                    <div class="step" onclick="goToStep(2)" title="Collaboration & Influence">3</div>
                    <div class="step" onclick="goToStep(3)" title="Growth & Development">4</div>
                    <div class="step" onclick="goToStep(4)" title="Looking Ahead">5</div>
                    <div class="step" onclick="goToStep(5)" title="Comprehensive Summary">6</div>
                </div>
            </div>
            <!-- Content Card -->
            <div class="content-card">
            <!-- Step 0: Basic Information -->
            <div class="slide active" id="slide-0">
                <h2>Basic Information & Overall Rating</h2>
                <p class="description">Enter basic information and select the overall performance rating</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="employeeName">Employee Name:</label>
                        <input type="text" id="employeeName" placeholder="Enter employee name">
                    </div>
                    <div class="form-group">
                        <label for="reviewerName">Manager Name:</label>
                        <input type="text" id="reviewerName" placeholder="Enter manager name">
                    </div>
                </div>

                <div class="form-group">
                    <label for="reviewPeriod">Fiscal Year:</label>
                    <select id="reviewPeriod">
                        <option value="FY26">FY26</option>
                        <option value="FY25">FY25</option>
                        <option value="FY24">FY24</option>
                        <option value="FY23">FY23</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Overall Performance Rating:</label>
                    <div class="rating-buttons">
                        <div class="rating-btn" onclick="selectRating(this, 'exemplary')">
                            <strong>Exemplary</strong>
                            <small>Performance consistently exceeds the requirements of the role</small>
                        </div>
                        <div class="rating-btn selected" onclick="selectRating(this, 'successful')">
                            <strong>Successful</strong>
                            <small>Performance consistently meets the requirements of the role</small>
                        </div>
                        <div class="rating-btn" onclick="selectRating(this, 'opportunity')">
                            <strong>Opportunity</strong>
                            <small>Performance consistently failed to meet the requirements of the role</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Key Priorities -->
            <div class="slide" id="slide-1">
                <h2>Key Priorities</h2>
                <p class="description">What were the associate's primary goals this year, and what two or three specific results did they deliver that show measurable progress against those goals and clear impact on business outcomes?</p>

                <div class="suggestions">
                    <h4>Smart Content Suggestions</h4>
                    <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Primary goals included [specific goal], achieving [X% increase/improvement] in [metric] which directly contributed to [business outcome]...')">
                        "Primary goals included [specific goal], achieving [X% increase/improvement] in [metric] which directly contributed to [business outcome]..."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Delivered measurable results: [Result 1] resulted in $X revenue/cost savings, [Result 2] improved [process/metric] by X%, and [Result 3] enhanced [business area] leading to...')">
                        "Delivered measurable results: [Result 1] resulted in $X revenue/cost savings, [Result 2] improved [process/metric] by X%, and [Result 3] enhanced [business area] leading to..."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Key accomplishments with quantifiable impact: Successfully [action] resulting in [specific metric improvement], completed [project] ahead of schedule generating [business value], and achieved [goal] with [measurable outcome]...')">
                        "Key accomplishments with quantifiable impact: Successfully [action] resulting in [specific metric improvement], completed [project] ahead of schedule generating [business value], and achieved [goal] with [measurable outcome]..."
                    </div>
                </div>

                <div class="form-group">
                    <label for="keyPriorities">Feedback:</label>
                    <textarea id="keyPriorities" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('keyPriorities')"></textarea>
                </div>
            </div>

            <!-- Step 2: Collaboration -->
            <div class="slide" id="slide-2">
                <h2>Collaboration & Influence</h2>
                <p class="description">What two or three specific ways did the associate partner across teams to deliver results this year, and where could their partnership and collaboration have been stronger?</p>

                <div class="suggestions">
                    <h4>Smart Content Suggestions</h4>
                    <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Three specific partnership examples: (1) Collaborated with [team] to deliver [outcome], (2) Partnered with [department] resulting in [specific result], (3) Worked cross-functionally with [teams] achieving [measurable impact]. Areas for growth: Could strengthen collaboration by...')">
                        "Three specific partnership examples: (1) Collaborated with [team] to deliver [outcome], (2) Partnered with [department] resulting in [specific result], (3) Worked cross-functionally with [teams] achieving [measurable impact]. Areas for growth: Could strengthen collaboration by..."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Key partnerships this year included: [specific example 1 with outcome], [specific example 2 with result], and [specific example 3 with impact]. Going forward, partnership effectiveness could improve through...')">
                        "Key partnerships this year included: [specific example 1 with outcome], [specific example 2 with result], and [specific example 3 with impact]. Going forward, partnership effectiveness could improve through..."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Successfully partnered across teams by: [specific way 1], [specific way 2], and [specific way 3], each delivering [measurable results]. Opportunities for stronger collaboration exist in...')">
                        "Successfully partnered across teams by: [specific way 1], [specific way 2], and [specific way 3], each delivering [measurable results]. Opportunities for stronger collaboration exist in..."
                    </div>
                </div>

                <div class="form-group">
                    <label for="collaboration">Feedback:</label>
                    <textarea id="collaboration" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('collaboration')"></textarea>
                </div>
            </div>

            <!-- Step 3: Growth & Development -->
            <div class="slide" id="slide-3">
                <h2>Growth & Development</h2>
                <p class="description">What are the two or three most critical development areas for the associate next year, and what targeted experiences such as training, expanded scope, new responsibilities, or stretch work would best accelerate their growth?</p>

                <div class="suggestions">
                    <h4>Smart Content Suggestions</h4>
                    <div class="suggestion-item" onclick="addSuggestion('growth', 'Critical development priorities: (1) [Skill/area] - recommend [specific training/experience], (2) [Leadership capability] - suggest [stretch assignment/expanded scope], (3) [Technical/functional area] - propose [new responsibility/project]. These targeted experiences would accelerate growth by...')">
                        "Critical development priorities: (1) [Skill/area] - recommend [specific training/experience], (2) [Leadership capability] - suggest [stretch assignment/expanded scope], (3) [Technical/functional area] - propose [new responsibility/project]. These targeted experiences would accelerate growth by..."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('growth', 'Key growth areas for next year: [development area 1], [development area 2], and [development area 3]. Recommended development approaches include: [specific training program], [expanded role/scope opportunity], and [stretch project/new responsibility] to build these capabilities.')">
                        "Key growth areas for next year: [development area 1], [development area 2], and [development area 3]. Recommended development approaches include: [specific training program], [expanded role/scope opportunity], and [stretch project/new responsibility] to build these capabilities."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('growth', 'Priority development focus: [area 1] through [targeted experience], [area 2] via [specific opportunity], [area 3] using [stretch assignment]. These development experiences align with career progression and would strengthen [specific outcomes/capabilities].')">
                        "Priority development focus: [area 1] through [targeted experience], [area 2] via [specific opportunity], [area 3] using [stretch assignment]. These development experiences align with career progression and would strengthen [specific outcomes/capabilities]."
                    </div>
                </div>

                <div class="form-group">
                    <label for="growth">Feedback:</label>
                    <textarea id="growth" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('growth')"></textarea>
                </div>
            </div>

            <!-- Step 4: Looking Ahead -->
            <div class="slide" id="slide-4">
                <h2>Looking Ahead</h2>
                <p class="description">Compared to others at this level, what clearly differentiates this associate, what assumptions influenced your rating, and what measurable progress do you expect to see in the next six months along with the specific actions you will take to support their development?</p>

                <div class="suggestions">
                    <h4>Smart Content Suggestions</h4>
                    <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Differentiation: Compared to peers, [associate name] stands out in [specific areas]. Rating assumptions: Based on [evidence/observations]. Expected progress (6 months): [measurable goal 1], [measurable goal 2]. My support actions: [specific action 1], [specific action 2], [specific action 3].')">
                        "Differentiation: Compared to peers, [associate name] stands out in [specific areas]. Rating assumptions: Based on [evidence/observations]. Expected progress (6 months): [measurable goal 1], [measurable goal 2]. My support actions: [specific action 1], [specific action 2], [specific action 3]."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Peer comparison: [Associate name] differentiates through [unique strengths/capabilities]. Rating rationale: [key assumptions and evidence]. 6-month expectations: Achieve [specific metric/outcome], demonstrate [observable behavior], complete [measurable milestone]. Manager commitment: I will [support action], provide [resource/opportunity], and [developmental intervention].')">
                        "Peer comparison: [Associate name] differentiates through [unique strengths/capabilities]. Rating rationale: [key assumptions and evidence]. 6-month expectations: Achieve [specific metric/outcome], demonstrate [observable behavior], complete [measurable milestone]. Manager commitment: I will [support action], provide [resource/opportunity], and [developmental intervention]."
                    </div>
                    <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Distinguishing factors: [Associate] excels beyond peer level in [area 1] and [area 2] due to [evidence]. Rating influenced by [assumptions/observations]. Measurable 6-month targets: [quantifiable goal], [behavioral indicator], [milestone achievement]. Development support plan: [manager action 1], [resource provision], [coaching/feedback commitment].')">
                        "Distinguishing factors: [Associate] excels beyond peer level in [area 1] and [area 2] due to [evidence]. Rating influenced by [assumptions/observations]. Measurable 6-month targets: [quantifiable goal], [behavioral indicator], [milestone achievement]. Development support plan: [manager action 1], [resource provision], [coaching/feedback commitment]."
                    </div>
                </div>

                <div class="form-group">
                    <label for="lookingAhead">Feedback:</label>
                    <textarea id="lookingAhead" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('lookingAhead')"></textarea>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-outline" id="prevBtn" onclick="previousStep()" disabled>Previous</button>
                <div class="step-info" id="stepInfo">Step 1 of 6</div>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 6;
        let currentReviewer = null;
        let currentEmployee = null;
        let reviewerData = {};
        let autoAdvancementInProgress = false;

        // Initialize reviewer system
        function initializeReviewerSystem() {
            // Load reviewer data from localStorage
            const savedData = localStorage.getItem('talentEvaluationData');
            if (savedData) {
                reviewerData = JSON.parse(savedData);
            }

            // Check if reviewer is logged in
            const urlParams = new URLSearchParams(window.location.search);
            const reviewerId = urlParams.get('reviewer');
            
            if (reviewerId && reviewerData[reviewerId]) {
                currentReviewer = reviewerId;
                loadReviewerDashboard();
            } else {
                showReviewerLogin();
            }
        }

        // Force dashboard reload function
        function forceDashboardReload() {
            if (currentReviewer && reviewerData[currentReviewer]) {
                loadReviewerDashboard();
            } else {
                showReviewerLogin();
            }
        }

        // Debug function to check current state
        function checkSystemState() {
            console.log('Current Reviewer:', currentReviewer);
            console.log('Reviewer Data:', reviewerData);
            console.log('Container HTML:', document.querySelector('.container')?.innerHTML.substring(0, 200) + '...');
            return { currentReviewer, reviewerData, containerExists: !!document.querySelector('.container') };
        }

        // Emergency reload function accessible from browser console
        window.emergencyReload = function() {
            console.log('Emergency reload triggered');
            if (currentReviewer) {
                loadReviewerDashboard();
                console.log('Dashboard reloaded');
            } else {
                showReviewerLogin();
                console.log('Showing login');
            }
        };

        function showReviewerLogin() {
            document.querySelector('.container').innerHTML = `
                <!-- Landing Page Sidebar -->
                <div class="sidebar" style="display: flex; align-items: center; justify-content: center;">
                    <div style="text-align: center; color: white; opacity: 0.7;">
                        <div style="font-size: 48px; margin-bottom: 16px;">👥</div>
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Team Performance</div>
                        <div style="font-size: 14px; line-height: 1.4;">Objective evaluation and calibration discussions</div>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="main-content" style="display: flex; align-items: center; justify-content: center; padding: 40px;">
                    <div class="login-card">
                        <div class="form-group">
                            <div class="reviewer-search-container">
                                <input type="text" id="reviewerSearch" placeholder="Type to search managers..." 
                                       oninput="searchReviewers()" onfocus="showReviewerDropdown()" 
                                       onkeypress="if(event.key==='Enter') selectFirstReviewer()"
                                       autocomplete="off">
                                <div class="reviewer-dropdown" id="reviewerDropdown" style="display: none;">
                                    <div class="dropdown-loading">Loading organization data...</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="accessBtn" onclick="loginSelectedReviewer()" disabled>Access Dashboard</button>
                        
                        <div class="demo-reviewers">
                            <h4>Demos:</h4>
                            <button class="btn btn-outline" onclick="loginAsDemo('sarah.johnson', 'Sarah Johnson')">Sarah Johnson</button>
                            <button class="btn btn-outline" onclick="loginAsDemo('mike.chen', 'Mike Chen')">Mike Chen</button>
                            <button class="btn btn-outline" onclick="loginAsDemo('lisa.williams', 'Lisa Williams')">Lisa Williams</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loginReviewer() {
            const reviewerName = document.getElementById('reviewerName').value.trim();
            
            if (!reviewerName) {
                alert('Please enter your full name');
                return;
            }
            
            // Auto-generate reviewer ID from name (e.g., "Sarah Johnson" -> "sarah.johnson")
            const reviewerId = reviewerName.toLowerCase().replace(/\s+/g, '.').replace(/[^a-z0-9.]/g, '');
            
            currentReviewer = reviewerId;
            
            // Initialize reviewer data if doesn't exist
            if (!reviewerData[reviewerId]) {
                reviewerData[reviewerId] = {
                    name: reviewerName,
                    employees: {},
                    createdDate: new Date().toISOString()
                };
            }
            
            // Update URL and load dashboard
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('reviewer', reviewerId);
            window.history.pushState({}, '', newUrl);
            
            loadReviewerDashboard();
        }

        function loginAsDemo(reviewerId, reviewerName) {
            currentReviewer = reviewerId;
            
            // Create demo data if doesn't exist
            if (!reviewerData[reviewerId]) {
                reviewerData[reviewerId] = {
                    name: reviewerName,
                    employees: generateDemoEmployees(reviewerId),
                    createdDate: new Date().toISOString()
                };
                saveReviewerData();
            }
            
            // Update URL and load dashboard
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('reviewer', reviewerId);
            window.history.pushState({}, '', newUrl);
            
            loadReviewerDashboard();
        }

        function generateDemoEmployees(reviewerId) {
            const demoSets = {
                'sarah.johnson': [
                    { id: 'emp001', name: 'Jennifer Martinez', position: 'Marketing Specialist', status: 'completed' },
                    { id: 'emp002', name: 'David Thompson', position: 'Brand Manager', status: 'in-progress' },
                    { id: 'emp003', name: 'Amanda Chen', position: 'Digital Marketing Analyst', status: 'not-started' },
                    { id: 'emp004', name: 'Robert Garcia', position: 'Marketing Coordinator', status: 'completed' }
                ],
                'mike.chen': [
                    { id: 'emp005', name: 'Emily Rodriguez', position: 'Senior Marketing Manager', status: 'completed' },
                    { id: 'emp006', name: 'James Wilson', position: 'Product Marketing Lead', status: 'in-progress' },
                    { id: 'emp007', name: 'Michelle Kim', position: 'Marketing Operations Manager', status: 'completed' },
                    { id: 'emp008', name: 'Christopher Lee', position: 'Content Marketing Manager', status: 'not-started' },
                    { id: 'emp009', name: 'Ashley Davis', position: 'Campaign Manager', status: 'in-progress' }
                ],
                'lisa.williams': [
                    { id: 'emp010', name: 'Michael Brown', position: 'Marketing Director', status: 'completed' },
                    { id: 'emp011', name: 'Jessica Anderson', position: 'Brand Director', status: 'completed' },
                    { id: 'emp012', name: 'Thomas Miller', position: 'Digital Marketing Director', status: 'in-progress' }
                ]
            };
            
            const employees = {};
            (demoSets[reviewerId] || []).forEach(emp => {
                employees[emp.id] = {
                    ...emp,
                    evaluationData: generateSampleEvaluation(emp), // Always populate with sample data for demo
                    lastUpdated: new Date().toISOString()
                };
            });
            
            return employees;
        }

        function generateSampleEvaluation(employee) {
            // Create diverse, high-quality examples based on employee name/position
            const evaluationExamples = {
                'Jennifer Martinez': {
                    employeeName: 'Jennifer Martinez',
                    reviewerName: 'Sarah Johnson',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Develop integrated social media strategy with 25% engagement increase target, (2) Lead Q3 back-to-school campaign execution, and (3) Establish influencer partnership program. Delivered exceptional results: (1) Achieved 34% social engagement increase through data-driven content optimization and A/B testing, exceeding target by 36%, (2) Q3 campaign generated $3.2M revenue (15% above target) with 92% on-time delivery across all channels, (3) Launched influencer program with 12 strategic partnerships yielding 2.8M impressions and 47% higher conversion rates than traditional advertising.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Creative and Analytics teams to develop award-winning social campaign, resulting in 67% increase in brand sentiment and industry recognition, (2) Partnered with Store Operations on in-store digital integration, achieving seamless omnichannel experience and 23% lift in store traffic, (3) Worked cross-functionally with Legal and Compliance teams to establish influencer guidelines, creating scalable framework adopted company-wide. Areas for growth: Could enhance collaboration by establishing regular stakeholder check-ins during campaign development and creating standardized communication templates for complex projects.',
                    growth: 'Critical development priorities for next year: (1) Executive presence and C-suite communication - recommend senior leadership forum participation and board presentation opportunities because Jennifer needs to build confidence in articulating strategic vision to senior audiences, which will be essential for VP-level advancement, (2) Advanced marketing technology strategy - suggest MarTech certification and enterprise platform training to develop technical depth that would enable her to lead digital transformation initiatives and make informed technology investment decisions, (3) Cross-functional business acumen - propose rotation through analytics and finance teams because strengthening quantitative business analysis skills would enhance her strategic recommendations and prepare her for P&L responsibility. These targeted experiences would accelerate her growth by building the executive communication confidence, technical credibility, and business foundation needed for senior marketing leadership roles.',
                    lookingAhead: 'Differentiation: Compared to peers at this level, Jennifer distinguishes herself through systematic creative problem-solving combined with strong business acumen - she consistently translates innovative ideas into measurable business outcomes while maintaining quality execution. Her approach to stakeholder management is more proactive and structured than typical for this role. Rating assumptions: This exemplary rating is influenced by her demonstrated ability to exceed complex objectives while building cross-functional relationships, her initiative in developing scalable processes, and consistent feedback indicating she operates above her current level. Expected progress (6 months): Successfully complete advanced MarTech certification, lead two major cross-functional initiatives with measurable business outcomes, and deliver quarterly strategic recommendations to executive leadership. Areas for continued growth: Building confidence in senior executive communication and developing deeper financial analysis capabilities. My support actions: Provide bi-weekly strategic coaching sessions focused on executive presence, secure enrollment in advanced business communication program, assign lead role on high-visibility omnichannel project, and facilitate monthly mentoring meetings with VP-level marketing leaders for strategic development.'
                },
                'Robert Garcia': {
                    employeeName: 'Robert Garcia',
                    reviewerName: 'Sarah Johnson',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Streamline campaign production workflows to improve efficiency by 20%, (2) Coordinate cross-channel marketing activities for holiday season, and (3) Implement new project management tools and processes. Delivered solid results: (1) Achieved 28% improvement in workflow efficiency through process mapping and automation, reducing average campaign turnaround from 14 to 10 days, (2) Successfully coordinated 8 integrated holiday campaigns with 96% on-time delivery and $2.1M combined revenue impact, (3) Implemented Asana project management system with 94% team adoption and 35% improvement in project visibility and accountability.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Creative and Media Planning teams to establish standardized campaign briefing process, resulting in 40% reduction in revision cycles and improved creative quality, (2) Partnered with Digital Marketing team on automated workflow integration, achieving seamless handoffs and 25% faster campaign launches, (3) Worked with Training and Development to create project management best practices documentation, now used as standard onboarding material. Areas for growth: Could strengthen collaboration by taking more initiative in stakeholder communications and developing skills to facilitate difficult conversations between teams with competing priorities.',
                    growth: 'Critical development priorities for next year: (1) Leadership communication and stakeholder influence - recommend advanced project leadership training and conflict resolution workshops because Robert tends to avoid difficult conversations, which limits his ability to drive change when teams have competing priorities; building these skills would prepare him for specialist-level responsibilities, (2) Strategic marketing perspective - suggest rotation through brand strategy team and participation in campaign planning because his current focus on execution excellence needs to be balanced with broader strategic understanding to advance beyond coordination roles, (3) Data-driven decision making capabilities - propose training in marketing analytics and dashboard creation since developing quantitative analysis skills would enhance his process improvement recommendations and support his natural systematic thinking approach. These development experiences would accelerate his growth by building the confidence, strategic perspective, and analytical capabilities needed to transition from coordinator to specialist and eventually senior marketing roles.',
                    lookingAhead: 'Differentiation: Compared to peers at this coordinator level, Robert demonstrates exceptional systematic thinking and operational excellence - he approaches process improvement with unusual methodical discipline and achieves consistently higher efficiency gains than others in similar roles. His reliability in execution and attention to quality details sets him apart from typical coordinators. Rating assumptions: This successful rating reflects his strong operational contributions while recognizing development opportunities in leadership communication and strategic thinking that are necessary for advancement. His process improvement capabilities exceed role expectations, but growth in stakeholder influence and strategic perspective are needed for promotion readiness. Expected progress (6 months): Successfully complete advanced project management certification with practical campaign application, demonstrate improved confidence in stakeholder communication through 360 feedback scores, and lead one major process optimization initiative with documented efficiency improvements. Areas for continued development: Building comfort with difficult conversations and expanding strategic marketing knowledge beyond operational execution. My support actions: Provide monthly coaching sessions focused on leadership communication and influence skills, secure budget for external project management certification program, assign lead responsibility for Q1 workflow optimization project, and arrange regular participation in strategic planning meetings to broaden marketing perspective.'
                },
                'Emily Rodriguez': {
                    employeeName: 'Emily Rodriguez',
                    reviewerName: 'Mike Chen',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Drive digital transformation strategy with 30% increase in digital engagement, (2) Lead team restructuring to support omnichannel marketing approach, and (3) Establish marketing automation platform and workflows. Delivered outstanding results: (1) Achieved 45% increase in digital engagement through integrated customer journey mapping and personalization strategy, significantly exceeding targets, (2) Successfully restructured team of 12 with zero attrition, improved collaboration scores by 38%, and established clear role definitions supporting omnichannel objectives, (3) Implemented comprehensive marketing automation platform driving 52% improvement in lead nurturing efficiency and $4.7M incremental revenue attribution.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with IT and Customer Experience teams to integrate customer data platforms, resulting in unified 360-degree customer view and 31% improvement in campaign personalization effectiveness, (2) Partnered with Sales Leadership on lead handoff optimization, achieving 43% increase in marketing qualified leads conversion and improved sales-marketing alignment, (3) Worked cross-functionally with Finance and Operations teams on marketing ROI measurement framework, establishing standardized attribution modeling adopted across all marketing channels. Areas for growth: Could enhance collaboration by developing more structured change management communication for large initiatives and creating formal mentorship programs for knowledge transfer to junior team members.',
                    growth: 'Critical development priorities for next year: (1) Executive presence and C-suite communication - recommend participation in senior executive forums and external board positions because Emily needs to build confidence in articulating complex transformation strategies to diverse senior audiences, which is essential for VP and eventual CMO advancement, (2) P&L accountability and financial management - suggest rotation through general management role or business unit leadership because developing direct profit and loss responsibility would provide the business acumen needed for senior executive roles and complement her operational transformation expertise, (3) Industry thought leadership and external influence - propose keynote speaking opportunities and industry association leadership roles to build external credibility that would enhance her ability to drive strategic partnerships and attract top talent. These experiences would accelerate her growth by building the executive gravitas, business leadership foundation, and industry influence required for C-suite marketing leadership positions.',
                    lookingAhead: 'Emily demonstrates exceptional potential for Chief Marketing Officer advancement within 18-24 months based on her proven transformation leadership and strategic execution capabilities. I recommend accelerating her development through formal CMO succession planning with the Executive Team, which would provide the strategic visibility and leadership preparation essential for C-suite transition. Her innovative approach to digital transformation positions the organization to compete effectively in the evolving marketing landscape. To support this advancement trajectory, she should gain P&L accountability through a business unit leadership role and increase board exposure to build the comprehensive business leadership foundation required for CMO responsibilities. While her transformation expertise is exceptional, building direct financial accountability would provide the business acumen needed to complement her operational strengths and position her as a complete C-suite candidate. Expected progress: Successfully complete P&L leadership role with measurable business outcomes, establish external industry leadership presence through board appointments, and demonstrate executive communication effectiveness in C-suite interactions. My support commitment: Secure executive sponsorship for succession planning discussions, facilitate P&L leadership opportunities, and provide executive coaching to build C-suite readiness.'
                },
                'Michelle Kim': {
                    employeeName: 'Michelle Kim',
                    reviewerName: 'Mike Chen',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Optimize marketing operations processes to reduce campaign production time by 15%, (2) Implement comprehensive marketing performance measurement framework, and (3) Establish vendor management and procurement optimization program. Delivered strong results: (1) Achieved 22% reduction in campaign production time through workflow automation and resource optimization, exceeding target and improving team capacity, (2) Successfully implemented marketing dashboard system providing real-time performance insights across all channels, improving decision-making speed by 35%, (3) Established vendor management program generating $380K annual savings while improving service quality scores by 28%.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Finance and Procurement teams to establish marketing spend governance framework, resulting in improved budget compliance and 12% cost optimization without sacrificing quality, (2) Partnered with Technology and Analytics teams on marketing data integration project, achieving single source of truth for performance measurement and 40% faster reporting cycles, (3) Worked cross-functionally with Creative and Agency Management to optimize external partner workflows, improving creative approval cycles by 30% and enhancing creative quality consistency. Areas for growth: Could strengthen collaboration by taking more proactive role in strategic planning discussions and developing skills to translate operational improvements into strategic business impact for leadership communications.',
                    growth: 'Critical development priorities for next year: (1) Strategic business partnership and executive consulting skills - recommend training in business consulting methodologies and strategic analysis frameworks because Michelle needs to develop the ability to translate operational improvements into strategic business impact for senior leadership communications, which is essential for advancement to director and VP operations roles, (2) Marketing technology leadership and transformation management - suggest advanced MarTech certifications and change management training because building expertise in leading large-scale technology implementations would position her as a transformation leader and complement her operational excellence, (3) Team leadership and people development capabilities - propose formal management training and executive coaching skills development to build the leadership foundation needed for managing larger teams and developing talent at scale. These experiences would accelerate her growth by building the strategic thinking, transformation leadership, and people management capabilities required for senior operations leadership positions.',
                    lookingAhead: 'Michelle is well-positioned for advancement to Marketing Operations Director within the next 12-18 months based on her exceptional systematic process improvement capabilities and strong cross-functional relationship building skills. I recommend expanding her scope to include strategic business analysis and technology transformation leadership, which would prepare her for director-level responsibilities. Her proven ability to optimize complex operations while maintaining stakeholder relationships positions her to lead larger transformation initiatives. To support this advancement, she should gain experience in strategic business planning and executive communication to complement her operational expertise. While her process improvement skills are exceptional, developing strategic thinking capabilities would provide the leadership foundation needed for director roles. Expected progress: Successfully lead major technology implementation with measurable business impact, demonstrate strategic analysis capabilities through executive presentation, and develop junior talent through formal mentorship program. My support commitment: Provide strategic thinking coaching, secure assignment to cross-functional business planning initiative, and create executive visibility opportunities to build director readiness.'
                },
                'Michael Brown': {
                    employeeName: 'Michael Brown',
                    reviewerName: 'Lisa Williams',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Lead comprehensive brand repositioning strategy with measurable brand equity improvement, (2) Drive digital-first marketing transformation across all channels, and (3) Establish data-driven marketing culture with advanced analytics capabilities. Delivered exceptional results: (1) Successfully launched brand repositioning campaign resulting in 28% improvement in brand favorability scores and 19% increase in consideration metrics, generating estimated $12M incremental brand value, (2) Transformed marketing approach to digital-first strategy achieving 67% increase in digital channel effectiveness and 41% improvement in customer acquisition cost efficiency, (3) Established comprehensive marketing analytics capabilities including predictive modeling, resulting in 34% improvement in campaign targeting accuracy and $8.3M documented ROI improvement.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Executive Leadership and Board members on brand strategy approval and implementation, securing unanimous support and $15M investment commitment for multi-year brand transformation, (2) Partnered with Technology, Data Science, and Customer Experience teams on integrated customer platform development, creating industry-leading personalization capabilities and 45% improvement in customer lifetime value, (3) Worked cross-functionally with Sales, Operations, and Finance leadership to align brand positioning with business strategy, achieving consistent messaging across all touchpoints and 23% improvement in sales conversion alignment. Areas for growth: Could enhance collaboration by developing more structured knowledge transfer programs for best practices sharing across organization and establishing formal cross-industry partnership opportunities for continued innovation.',
                    growth: 'Critical development priorities for next year: (1) Global marketing leadership and international expansion expertise - recommend international assignment or global marketing strategy role because Michael needs to build worldwide perspective and cultural adaptation skills, which are essential for CMO roles in our increasingly global marketplace, (2) Advanced business leadership and P&L accountability - suggest general manager rotation or business unit leadership role with full operational responsibility because developing direct profit and loss management would provide the comprehensive business acumen needed to complement his exceptional marketing transformation expertise, (3) Industry thought leadership and external influence - propose board positions, industry association leadership, and keynote speaking engagements to build external credibility that would enhance his ability to attract top talent and drive strategic partnerships at the C-suite level. These experiences would accelerate his growth by building the global business perspective, comprehensive operational management skills, and industry influence essential for CMO and eventual executive leadership advancement.',
                    lookingAhead: 'Michael demonstrates exceptional potential for Chief Marketing Officer advancement within 12-18 months based on his proven enterprise-wide transformation leadership and measurable business impact delivery. I strongly recommend accelerating his development through formal CMO succession planning and international business leadership assignment, which would provide the global perspective and comprehensive business acumen essential for C-suite responsibilities. His innovative approach to digital transformation and analytics positions the organization as an industry leader. To support this advancement trajectory, he should gain P&L accountability through a general management role and establish external industry influence through board appointments and thought leadership platforms. While his marketing transformation expertise is exceptional, building direct operational management experience would provide the complete business leadership foundation required for CMO success. Expected progress: Successfully complete international assignment or global strategy leadership role with measurable market expansion results, demonstrate P&L management capabilities through business unit leadership, and establish industry thought leadership through publications and speaking engagements. My support commitment: Secure executive sponsorship for CMO succession planning discussions, facilitate international business leadership opportunities, and provide C-suite coaching to accelerate executive readiness.'
                },
                'Jessica Anderson': {
                    employeeName: 'Jessica Anderson',
                    reviewerName: 'Lisa Williams',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Revitalize brand portfolio strategy with focus on premium positioning, (2) Launch sustainable marketing initiatives aligned with corporate responsibility goals, and (3) Establish brand partnership ecosystem to expand market reach. Delivered strong results: (1) Successfully repositioned three key brands toward premium segments, achieving 16% average price improvement and 12% volume growth despite premium positioning, generating $5.8M incremental margin, (2) Launched comprehensive sustainable marketing program including carbon-neutral campaigns and eco-friendly packaging, achieving 89% positive consumer response and 24% improvement in brand sustainability scores, (3) Established strategic brand partnerships with 8 complementary brands, creating co-marketing opportunities that generated 2.3M new customer exposures and $3.1M attributed revenue.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Product Development and Sustainability teams to integrate environmental considerations into brand messaging, resulting in authentic sustainability positioning and 31% improvement in millennial consumer brand preference, (2) Partnered with Sales and Retail Operations teams on premium brand merchandising strategy, achieving optimal shelf positioning and 27% improvement in premium product sell-through rates, (3) Worked cross-functionally with Legal, Finance, and External Relations teams on brand partnership negotiations, establishing scalable partnership framework and securing favorable terms generating ongoing revenue opportunities. Areas for growth: Could strengthen collaboration by developing more proactive competitive intelligence sharing across teams and establishing formal brand mentorship program to develop junior brand management talent throughout the organization.',
                    growth: 'Critical development priorities for next year: (1) Digital brand management and e-commerce integration - recommend advanced digital marketing certification and direct-to-consumer strategy development experience because Jessica needs to build expertise in digital-first brand strategies, which are essential for modern brand leadership and consumer engagement in an increasingly digital marketplace, (2) International brand expansion and cultural adaptation - suggest global marketing assignment or international brand launch project because developing cross-cultural brand management skills would position her for senior brand leadership roles in our global expansion strategy, (3) Advanced brand analytics and consumer insights capabilities - propose training in advanced market research methodologies and predictive analytics because building data-driven decision-making skills would enhance her creative brand intuition with quantitative validation needed for director-level responsibilities. These experiences would accelerate her growth by building the digital expertise, global perspective, and analytical capabilities critical for senior brand leadership advancement.',
                    lookingAhead: 'Jessica is well-positioned for advancement to Senior Brand Director within 18-24 months based on her exceptional ability to balance brand authenticity with business performance and her innovative approach to sustainable marketing. I recommend expanding her scope to include digital brand leadership and international market development, which would prepare her for senior brand management responsibilities. Her successful premium positioning achievements while maintaining volume growth demonstrate rare strategic thinking capabilities. To support this advancement, she should gain experience in digital-first brand strategies and global market expansion to complement her strong traditional brand management skills. While her creative and authentic brand approach is exceptional, developing digital expertise and international perspective would provide the comprehensive skill set needed for senior director roles. Expected progress: Successfully complete digital brand management certification with practical e-commerce project application, lead international brand expansion feasibility study with strategic recommendations, and establish formal brand mentorship program with documented talent development outcomes. My support commitment: Provide specialized digital brand strategy coaching, secure international project assignment opportunities, and facilitate advanced analytics training to build data-driven decision-making capabilities.'
                },
                'David Thompson': {
                    employeeName: 'David Thompson',
                    reviewerName: 'Sarah Johnson',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Revitalize declining product brand with 20% market share recovery target, (2) Launch comprehensive competitive analysis framework, and (3) Establish cross-category brand portfolio optimization strategy. Delivered exceptional results: (1) Achieved 32% market share recovery through innovative repositioning and targeted consumer segmentation, exceeding target by 60% and generating $8.7M incremental revenue, (2) Developed comprehensive competitive intelligence system providing real-time market insights, improving strategic decision-making speed by 45%, (3) Created portfolio optimization model resulting in 18% improvement in overall brand portfolio profitability and strategic resource allocation across 12 product categories.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Research and Consumer Insights teams to develop breakthrough brand positioning strategy, resulting in highest consumer preference scores in category and 41% improvement in brand consideration metrics, (2) Partnered with Sales and Trade Marketing teams on retailer-specific brand strategies, achieving premium shelf positioning across all major channels and 26% improvement in velocity, (3) Worked cross-functionally with Supply Chain and Operations teams on product innovation pipeline, creating streamlined development process and 35% faster time-to-market for new products. Areas for growth: Could enhance collaboration by establishing formal knowledge sharing sessions across brand teams and developing structured mentorship approach for junior brand managers.',
                    growth: 'Critical development priorities for next year: (1) Global brand management and international expansion - recommend international assignment or global brand strategy role because David needs to build worldwide perspective and cross-cultural consumer insights, which are essential for senior brand leadership in our global marketplace expansion, (2) Advanced financial modeling and P&L management - suggest finance training and direct profit and loss accountability because developing comprehensive business leadership skills would complement his exceptional brand strategy expertise and position him for general management advancement, (3) Innovation and product development leadership - propose rotation through R&D and product management teams because building end-to-end product lifecycle expertise would enhance his brand positioning capabilities with deeper innovation understanding needed for VP-level responsibilities. These experiences would accelerate his growth by building the international business acumen, financial leadership skills, and innovation expertise critical for senior brand leadership and potential VP positions.',
                    lookingAhead: 'David demonstrates exceptional potential for Brand Director advancement within 12-18 months based on his proven ability to combine analytical rigor with creative strategic thinking to deliver breakthrough business results. I recommend accelerating his development through international brand leadership assignment and P&L accountability, which would provide the global perspective and business management skills essential for senior brand leadership. His innovative approach to brand turnarounds and competitive intelligence positions the organization for sustained market leadership. To support this advancement trajectory, he should gain direct financial management experience and innovation ecosystem exposure to complement his exceptional brand strategy expertise. While his analytical and creative brand capabilities are outstanding, building P&L management and international experience would provide the comprehensive leadership foundation required for Brand Director success. Expected progress: Successfully complete international market expansion project with strategic recommendations, demonstrate P&L management capabilities through business unit oversight, and establish innovation partnerships with measurable product pipeline acceleration. My support commitment: Secure international assignment opportunities, facilitate P&L management experience, and provide strategic coaching to build senior leadership readiness.'
                },
                'Amanda Chen': {
                    employeeName: 'Amanda Chen',
                    reviewerName: 'Sarah Johnson',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Establish comprehensive digital analytics and reporting framework with 25% improvement in data accuracy, (2) Lead social media optimization strategy across all brand channels, and (3) Implement marketing automation tools to improve campaign efficiency by 30%. Delivered strong results: (1) Achieved 38% improvement in data accuracy through advanced analytics platform implementation and standardized reporting protocols, exceeding target while establishing company-wide data governance standards, (2) Optimized social media strategy resulting in 43% increase in engagement rates and 28% improvement in social commerce conversion, generating $2.4M attributed revenue, (3) Implemented comprehensive marketing automation platform achieving 47% improvement in campaign efficiency and 35% reduction in manual processes.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with IT and Data Science teams to integrate marketing technology stack, resulting in unified customer data platform and 52% improvement in campaign personalization effectiveness, (2) Partnered with Creative and Content teams to establish data-driven content optimization process, achieving 31% improvement in content engagement and more strategic creative development, (3) Worked cross-functionally with Sales and Customer Service teams on lead scoring and nurturing optimization, improving marketing qualified lead conversion by 29% and sales-marketing alignment. Areas for growth: Could strengthen collaboration by proactively sharing analytical insights across broader marketing organization and developing presentation skills for executive-level data storytelling.',
                    growth: 'Critical development priorities for next year: (1) Advanced data science and predictive analytics capabilities - recommend specialized training in machine learning applications and statistical analysis certification because Amanda needs to build cutting-edge analytical skills that would position her as a strategic analytics leader and differentiate her expertise in the evolving marketing technology landscape, (2) Strategic marketing planning and business impact analysis - suggest participation in annual planning process and strategic project leadership because developing big-picture thinking would complement her exceptional technical abilities and prepare her for senior manager roles with broader business responsibility, (3) Team leadership and cross-functional influence - propose formal leadership development program and project management certification because building people leadership skills would enable her to scale her analytical expertise through team development and cross-functional collaboration. These experiences would accelerate her growth by building the advanced technical expertise, strategic business thinking, and leadership capabilities necessary for senior analyst and management advancement.',
                    lookingAhead: 'Amanda is well-positioned for advancement to Senior Marketing Analyst or Analytics Manager within 12-18 months based on her exceptional technical problem-solving abilities and systematic optimization approach. I recommend expanding her scope to include strategic business analysis and team leadership responsibilities, which would leverage her analytical strengths while building the management skills needed for advancement. Her innovative automation implementations and data accuracy improvements position the organization for more sophisticated marketing analytics capabilities. To support this advancement, she should gain experience in strategic planning and executive communication to complement her strong technical expertise. While her analytical and optimization skills are exceptional, developing strategic thinking and people leadership capabilities would provide the well-rounded skill set needed for management roles. Expected progress: Successfully complete advanced analytics certification with practical predictive modeling application, lead strategic analysis initiative with executive presentation to senior leadership, and mentor junior analysts with documented professional development outcomes. My support commitment: Provide strategic communication coaching and executive presence development, secure advanced analytics training opportunities, and facilitate team leadership experiences through cross-functional project management assignments.'
                },
                'James Wilson': {
                    employeeName: 'James Wilson',
                    reviewerName: 'Mike Chen',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Launch integrated product marketing strategy for three new product categories with 15% market penetration targets, (2) Establish competitive positioning framework and go-to-market excellence, and (3) Develop comprehensive sales enablement program improving win rates by 20%. Delivered solid results: (1) Successfully launched three product categories achieving 19% average market penetration, exceeding targets through innovative positioning and targeted channel strategies, generating $6.2M first-year revenue, (2) Created comprehensive competitive analysis framework and positioning strategies resulting in 34% improvement in win rates against key competitors, (3) Developed sales enablement program including training materials and competitive battlecards, achieving 27% improvement in sales team effectiveness and faster deal closure cycles.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Product Development and Engineering teams to translate technical capabilities into compelling market positioning, resulting in differentiated value propositions and 42% improvement in customer interest metrics, (2) Partnered with Sales Leadership and Channel Management teams on go-to-market strategy execution, achieving coordinated launch across all channels and 91% on-time delivery, (3) Worked cross-functionally with Marketing Communications and Creative teams to develop integrated campaign strategies, ensuring consistent messaging and 38% improvement in campaign effectiveness. Areas for growth: Could enhance collaboration by establishing more proactive stakeholder communication rhythms and developing skills in facilitating cross-functional strategic planning sessions.',
                    growth: 'Critical development priorities: (1) Advanced product strategy and roadmap planning - recommend rotation through product management team and strategic planning experience, (2) Market research and consumer insights expertise - suggest advanced training in market analysis methodologies and customer research techniques, (3) Leadership presence and executive communication - propose participation in leadership development program and cross-functional project leadership roles. These experiences would accelerate growth by building strategic product thinking, market analysis expertise essential for senior product marketing roles, and leadership capabilities necessary for director-level positions.',
                    lookingAhead: 'Differentiation: Compared to peers, James demonstrates strong ability to translate complex product capabilities into clear market value, consistently achieving launch success through systematic planning and execution. Rating assumptions: Based on 19% market penetration achievement (exceeding 15% targets), competitive win rate improvements above benchmark, and successful sales enablement with measurable impact. Expected progress (6 months): Complete advanced product strategy certification with practical application on major product roadmap initiative, lead comprehensive market analysis project with strategic recommendations, and establish thought leadership through industry presentations or publications. My support actions: Provide strategic mentoring focused on product strategy and market analysis, secure product management rotation or strategic planning assignment, facilitate advanced market research training and certification, and create opportunities for executive presentation and strategic planning participation.'
                },
                'Christopher Lee': {
                    employeeName: 'Christopher Lee',
                    reviewerName: 'Mike Chen',
                    reviewPeriod: 'FY26',
                    overallRating: 'successful',
                    keyPriorities: 'Primary goals this year were: (1) Develop comprehensive content marketing strategy increasing organic engagement by 30%, (2) Establish thought leadership program positioning company experts as industry authorities, and (3) Create scalable content production processes improving efficiency by 25%. Delivered strong results: (1) Achieved 42% increase in organic engagement through strategic content optimization and audience segmentation, exceeding targets while improving content quality scores, (2) Successfully launched thought leadership program featuring C-suite and senior experts, generating 156 media mentions and establishing recognized industry presence, (3) Implemented scalable content production workflows achieving 33% efficiency improvement and 40% increase in content output without compromising quality.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Subject Matter Experts and Executive Leadership to develop thought leadership content strategy, resulting in authentic expert positioning and 67% increase in industry recognition, (2) Partnered with Social Media and Digital Marketing teams to optimize content distribution, achieving 51% improvement in content reach and 38% better cross-channel engagement, (3) Worked cross-functionally with Sales and Customer Success teams to align content with customer journey stages, improving lead nurturing effectiveness by 29% and sales conversation quality. Areas for growth: Could strengthen collaboration by establishing more systematic content feedback loops with sales teams and developing skills in translating business objectives into compelling storytelling frameworks.',
                    growth: 'Critical development priorities: (1) Strategic brand storytelling and narrative development - recommend advanced storytelling workshops and brand strategy training, (2) Digital marketing integration and omnichannel content strategy - suggest certification in marketing automation and customer journey optimization, (3) Team leadership and creative direction capabilities - propose content team management experience and creative leadership development. These experiences would accelerate growth by building strategic narrative capabilities, integrated marketing expertise essential for content director roles, and leadership skills necessary for managing creative teams and agencies.',
                    lookingAhead: 'Differentiation: Compared to peers, Christopher excels in creating authentic, engaging content that drives measurable business results while building genuine thought leadership and industry recognition. Rating assumptions: Based on 42% engagement growth (exceeding 30% target), successful thought leadership program with quantifiable media impact, and process improvements delivering significant efficiency gains. Expected progress (6 months): Complete advanced content strategy certification with omnichannel integration project, establish content team mentorship program with junior developer progression, and lead strategic narrative development initiative for major company positioning effort. My support actions: Provide creative leadership coaching and advanced storytelling training, facilitate content strategy certification and digital marketing integration experience, assign content team leadership role on major campaign, and create opportunities for strategic brand narrative development and executive content consultation.'
                },
                'Ashley Davis': {
                    employeeName: 'Ashley Davis',
                    reviewerName: 'Mike Chen',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Lead multi-channel campaign optimization strategy with 25% improvement in campaign ROI targets, (2) Establish advanced campaign attribution and measurement framework, and (3) Drive marketing automation sophistication achieving 40% improvement in lead nurturing effectiveness. Delivered outstanding results: (1) Achieved 37% improvement in campaign ROI through advanced targeting, creative optimization, and channel integration strategies, significantly exceeding targets while maintaining quality standards, (2) Implemented comprehensive attribution modeling providing accurate multi-touch attribution across all channels, improving marketing investment decisions and budget optimization by 43%, (3) Advanced marketing automation capabilities resulting in 56% improvement in lead nurturing effectiveness and 48% increase in marketing qualified lead conversion rates.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with Analytics and Data Science teams to develop predictive campaign modeling, resulting in 34% improvement in campaign targeting accuracy and more strategic media investment allocation, (2) Partnered with Creative and Brand teams to establish data-driven creative optimization process, achieving 41% improvement in creative effectiveness while maintaining brand consistency and message quality, (3) Worked cross-functionally with Sales Operations and CRM teams on lead management optimization, creating seamless handoff processes and 52% improvement in sales-marketing alignment effectiveness. Areas for growth: Could enhance collaboration by developing formal campaign best practices documentation for knowledge transfer and establishing structured mentorship programs for junior campaign management talent.',
                    growth: 'Critical development priorities: (1) Advanced marketing technology leadership and MarTech stack optimization - recommend certification in enterprise marketing platforms and technology strategy development, (2) Strategic marketing planning and budget management - suggest participation in marketing planning process and P&L responsibility for campaign budgets, (3) Team leadership and cross-functional project management - propose formal management training and large-scale campaign leadership experience. These experiences would accelerate growth by building marketing technology expertise, strategic financial management skills essential for senior marketing roles, and leadership capabilities necessary for managing marketing teams and complex initiatives.',
                    lookingAhead: 'Differentiation: Compared to peers, Ashley demonstrates exceptional ability to optimize complex multi-channel campaigns while implementing systematic measurement and attribution frameworks that drive strategic decision-making. Rating assumptions: Based on 37% ROI improvement (exceeding 25% target), successful attribution implementation with documented decision-making impact, and automation sophistication generating significant conversion improvements. Expected progress (6 months): Complete advanced MarTech leadership certification with technology strategy recommendations, assume P&L responsibility for major campaign portfolio with budget management accountability, and establish campaign excellence mentorship program with measurable team development outcomes. My support actions: Provide advanced marketing technology coaching and strategic budget management training, secure MarTech certification and enterprise platform experience, assign P&L responsibility for high-visibility campaign portfolio, and facilitate team leadership development through formal management training and cross-functional project leadership opportunities.'
                },
                'Thomas Miller': {
                    employeeName: 'Thomas Miller',
                    reviewerName: 'Lisa Williams',
                    reviewPeriod: 'FY26',
                    overallRating: 'exemplary',
                    keyPriorities: 'Primary goals this year were: (1) Drive comprehensive digital transformation strategy across all marketing functions with measurable efficiency and effectiveness improvements, (2) Lead marketing technology integration and optimization initiative, and (3) Establish data-driven marketing culture with advanced analytics and automation capabilities. Delivered exceptional results: (1) Successfully transformed marketing operations achieving 45% improvement in digital marketing effectiveness and 38% increase in operational efficiency through systematic digitization and process optimization, (2) Led enterprise-wide marketing technology integration creating unified customer experience platform and 52% improvement in cross-channel campaign coordination, (3) Established advanced analytics capabilities including predictive modeling and real-time optimization, resulting in 41% improvement in marketing ROI and strategic decision-making acceleration.',
                    collaboration: 'Three specific partnership examples: (1) Collaborated with IT, Data Engineering, and Customer Experience teams to architect integrated marketing technology ecosystem, resulting in unified customer data platform and 47% improvement in personalization effectiveness, (2) Partnered with Finance and Operations leadership on marketing investment optimization framework, achieving data-driven budget allocation and 34% improvement in marketing spend efficiency, (3) Worked cross-functionally with Sales, Customer Service, and Product teams to align digital customer journey, creating seamless omnichannel experience and 29% improvement in customer lifetime value. Areas for growth: Could enhance collaboration by establishing formal digital transformation knowledge transfer programs and developing structured change management communication for large-scale technology implementations.',
                    growth: 'Critical development priorities: (1) Executive leadership and organizational change management - recommend senior executive development program and large-scale transformation leadership experience, (2) Advanced business strategy and digital innovation - suggest rotation through corporate strategy or chief digital officer shadowing assignment, (3) Industry thought leadership and external influence - propose board positions, technology advisory roles, and speaking engagements to build external recognition. These experiences would accelerate growth by building senior executive presence, strategic business transformation expertise essential for C-suite roles, and industry influence necessary for chief marketing officer and chief digital officer positions.',
                    lookingAhead: 'Differentiation: Compared to peers, Thomas demonstrates exceptional ability to lead enterprise-wide digital transformation while delivering measurable business results, combining visionary technology strategy with disciplined execution and change management. Rating assumptions: Based on 45% digital effectiveness improvement (significantly exceeding industry benchmarks), successful technology integration with documented ROI impact, and analytics sophistication generating competitive advantage. Expected progress (6 months): Complete senior executive leadership program with transformation case study presentation, assume expanded responsibility for digital innovation across business units, and establish industry thought leadership through technology publications and conference presentations. My support actions: Provide executive coaching with digital transformation consultant, facilitate senior leadership development and C-suite exposure opportunities, sponsor participation in industry technology boards and innovation forums, and create opportunities for cross-business unit digital strategy leadership and external thought leadership development.'
                }
            };

            // Return personalized evaluation or fall back to default
            return evaluationExamples[employee.name] || {
                employeeName: employee ? employee.name : 'Sample Employee',
                reviewerName: 'Sample Reviewer',
                reviewPeriod: 'FY26',
                overallRating: 'successful',
                keyPriorities: 'Primary goals this year were: (1) Increase member acquisition by 12%, (2) Launch digital rewards program, and (3) Improve customer satisfaction scores above 4.2. Delivered measurable results: (1) Achieved 15.3% member acquisition growth through targeted social campaigns, exceeding goal by 28%, (2) Successfully launched rewards program with 89% member adoption in first month, generating $1.8M incremental revenue, (3) Improved satisfaction scores from 3.9 to 4.4 through personalized communication strategy, representing 12.8% improvement and clear business impact on retention metrics.',
                collaboration: 'Three specific partnership examples: (1) Collaborated with IT and Operations teams to deliver rewards program launch, resulting in zero technical issues and 48-hour faster deployment than planned, (2) Partnered with Finance department on budget optimization, achieving 18% cost reduction while maintaining campaign quality, (3) Worked cross-functionally with Customer Service and Analytics teams on satisfaction initiative, achieving unified data tracking and 22% faster issue resolution. Areas for growth: Could strengthen collaboration by proactively engaging stakeholders earlier in planning phases and providing more detailed project timelines to partners.',
                growth: 'Critical development priorities: (1) Strategic thinking skills - recommend executive leadership program and rotation through corporate strategy team, (2) Advanced analytics capabilities - suggest enrollment in data science certification and partnership with Analytics CoE on major project, (3) Change management expertise - propose leading digital transformation initiative for assigned market. These targeted experiences would accelerate growth by building enterprise-level perspective, quantitative decision-making skills, and ability to drive organization-wide initiatives essential for senior marketing roles.',
                lookingAhead: 'Differentiation: Compared to peers, Sarah consistently delivers above-target results with measurable business impact while building strong cross-functional partnerships. Rating assumptions: Based on 15.3% acquisition growth (vs 8% peer average), successful program launch with zero issues, and proactive stakeholder collaboration evidenced in 360 feedback. Expected progress (6 months): Achieve 95% completion of leadership program modules, complete analytics certification with capstone project, and successfully lead Q1 digital transformation pilot with measurable adoption metrics. My support actions: Provide monthly coaching sessions on strategic thinking, secure budget for external training programs, assign high-visibility transformation project, and facilitate quarterly skip-level meetings with VP Marketing for exposure and feedback.'
            };
        }

        function goToStep(step) {
            // Record navigation action for undo/redo (if step is actually changing)
            if (currentStep !== step && typeof recordAction !== 'undefined') {
                recordAction({
                    type: 'step_navigation',
                    oldStep: currentStep,
                    newStep: step,
                    description: `Navigate to step ${step + 1}`
                });
            }
            
            // Hide all slides
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });

            // Show target slide
            document.getElementById(`slide-${step}`).classList.add('active');

            // Update progress steps (both horizontal navigation and any other step elements)
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                if (index === step) {
                    stepEl.classList.add('active');
                } else if (index < step) {
                    stepEl.classList.add('completed');
                }
            });

            // Update current step
            currentStep = step;

            // Auto-generate summary when navigating to slide 6 (step 5)
            if (step === 5) {
                console.log('Navigating to summary slide - generating comprehensive summary');
                generateComprehensiveSummary();
            }

            // Update navigation
            updateNavigation();
            
            // Update progress indicator
            updateProgressIndicator();
        }

        function previousStep() {
            if (currentStep > 0) {
                goToStep(currentStep - 1);
            }
        }

        function nextStep() {
            if (currentStep < totalSteps - 1) {
                goToStep(currentStep + 1);
            } else {
                // Complete evaluation
                alert('Evaluation completed! Summary functionality can be added next.');
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const stepInfo = document.getElementById('stepInfo');

            prevBtn.disabled = (currentStep === 0);
            nextBtn.textContent = (currentStep === totalSteps - 1) ? 'Complete Evaluation' : 'Next';
            stepInfo.textContent = `Step ${currentStep + 1} of ${totalSteps}`;
        }

        function updateProgressIndicator() {
            const progressPercentage = document.getElementById('progressPercentage');
            const progressBarFill = document.getElementById('progressBarFill');
            const progressCurrentStep = document.getElementById('progressCurrentStep');
            
            if (!progressPercentage) return; // Not in evaluation mode
            
            const stepNames = [
                'Basic Information & Overall Rating',
                'Key Priorities',
                'Collaboration & Influence',
                'Growth & Development',
                'Looking Ahead',
                'Comprehensive Summary'
            ];
            
            // Calculate completion percentage
            const completionPercent = Math.round(((currentStep + 1) / totalSteps) * 100);
            
            // Update progress elements
            progressPercentage.textContent = `${completionPercent}%`;
            progressBarFill.style.width = `${completionPercent}%`;
            progressCurrentStep.textContent = `Step ${currentStep + 1} of ${totalSteps}: ${stepNames[currentStep] || 'Unknown Step'}`;
        }

        function selectRating(element, rating) {
            // Get current rating for undo functionality
            const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
            const oldRating = employee?.evaluationData?.overallRating || null;
            
            // Record action for undo/redo (if rating is actually changing)
            if (oldRating !== rating) {
                recordAction({
                    type: 'rating_change',
                    oldRating: oldRating,
                    newRating: rating,
                    description: `Change rating to ${rating}`
                });
            }
            
            // Remove selected class from all rating buttons
            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked button
            element.classList.add('selected');
            
            // Direct status change for completed evaluations
            if (employee && employee.status === 'completed') {
                const currentRating = employee.evaluationData?.overallRating;
                if (currentRating && currentRating !== rating) {
                    // DIRECTLY change status to in-progress
                    employee.status = 'in-progress';
                    employee.statusChangeReason = 'Overall rating modified';
                    employee.lastUpdated = new Date().toISOString();
                    
                    // Update the rating in evaluation data
                    employee.evaluationData.overallRating = rating;
                    
                    // Save immediately
                    saveReviewerData();
                    
                    // Update status display
                    updateStatusDisplay();
                    
                    // Auto-regenerate comprehensive summary if on that step
                    if (currentStep === 6) {
                        setTimeout(() => {
                            generateComprehensiveSummary();
                        }, 200);
                    }
                    
                    return; // Exit early, no need for auto-save
                }
            }
            
            // For non-completed evaluations, just save normally
            setTimeout(saveEmployeeEvaluation, 100);
        }

        function addSuggestion(fieldId, text) {
            const textarea = document.getElementById(fieldId);
            if (textarea.value.trim()) {
                textarea.value += ' ' + text;
            } else {
                textarea.value = text;
            }
            textarea.focus();
            
            // Mark that this content came from a suggestion (for more realistic analysis)
            textarea.setAttribute('data-has-suggestions', 'true');
            
            // Trigger analysis after suggestion is added
            setTimeout(() => {
                analyzeFeedback(fieldId);
            }, 100);
        }

        // Initialize AI Writing Coach for all textareas
        function initializeAIWritingCoach() {
            console.log('Initializing AI Writing Coach...');
            const textFields = ['keyPriorities', 'collaboration', 'growth', 'lookingAhead'];
            
            textFields.forEach(fieldId => {
                const textarea = document.getElementById(fieldId);
                const coach = document.getElementById(`coach-${fieldId}`);
                
                console.log(`Checking ${fieldId}: textarea=${!!textarea}, coach=${!!coach}`);
                
                if (textarea) {
                    // Remove existing event listeners to avoid duplicates
                    textarea.onkeyup = null;
                    textarea.oninput = null;
                    
                    // Ensure onkeyup event is attached
                    textarea.onkeyup = function() {
                        analyzeFeedback(fieldId);
                    };
                    
                    // Also trigger on input for better responsiveness
                    textarea.oninput = function() {
                        analyzeFeedback(fieldId);
                    };
                    
                    // Trigger analysis if content already exists
                    if (textarea.value.trim().length > 0) {
                        console.log(`Triggering analysis for ${fieldId} with existing content`);
                        setTimeout(() => analyzeFeedback(fieldId), 100);
                    }
                } else {
                    console.warn(`Missing textarea: ${fieldId}`);
                }
                
                if (!coach) {
                    console.warn(`Missing coach container: coach-${fieldId}`);
                }
            });
        }

        // Bias Detection and AI Writing Coach
        function analyzeFeedback(fieldId) {
            const textarea = document.getElementById(fieldId);
            if (!textarea) {
                console.log(`AI Coach: No textarea found for ${fieldId}`);
                return;
            }
            
            const text = textarea.value.trim();
            const coach = document.getElementById(`coach-${fieldId}`);
            if (!coach) {
                console.log(`AI Coach: No coach container found for coach-${fieldId}`);
                return;
            }
            
            // Show AI Writing Coach immediately when user starts typing
            if (text.length < 3) {
                coach.style.display = 'none';
                return;
            }
            
            console.log(`AI Coach: Analyzing ${fieldId} with ${text.length} characters`);
            coach.style.display = 'block';
            
            // Extra debugging for slide 3
            if (fieldId === 'growth') {
                console.log('Growth slide coach should now be visible');
                console.log('Coach element:', coach);
                console.log('Coach display style:', coach.style.display);
            }
            
            coach.style.display = 'block';
            
            // Calculate metrics based on section type
            const objectivity = calculateObjectivity(text, fieldId);
            const specificity = calculateSpecificity(text, fieldId);
            const completeness = calculateCompleteness(text, fieldId);
            
            // Update metrics display
            updateMetric(`objectivity-${fieldId}`, objectivity);
            updateMetric(`specificity-${fieldId}`, specificity);
            updateMetric(`completeness-${fieldId}`, completeness);
            
            // Detect bias patterns specific to section
            const biasAlerts = detectBias(text, fieldId);
            displayBiasAlerts(`alerts-${fieldId}`, biasAlerts);
        }
        
        function calculateObjectivity(text, fieldId) {
            const textarea = document.getElementById(fieldId);
            const hasSuggestions = textarea && textarea.getAttribute('data-has-suggestions') === 'true';
            
            // Different objectivity standards for different question types
            const isEvaluativeSection = fieldId === 'growth' || fieldId === 'lookingAhead';
            
            if (isEvaluativeSection) {
                // For evaluative sections (Growth & Looking Ahead): professional judgment objectivity
                return calculateEvaluativeObjectivity(text, fieldId, hasSuggestions);
            } else {
                // For performance sections (Key Priorities & Collaboration): data-driven objectivity
                return calculatePerformanceObjectivity(text, fieldId, hasSuggestions);
            }
        }
        
        function calculateEvaluativeObjectivity(text, fieldId, hasSuggestions) {
            // Professional judgment indicators for evaluative content
            const reasoningIndicators = ['because', 'since', 'due to', 'given that', 'in order to', 'so that', 'which would', 'this would', 'to build', 'to develop', 'to enhance', 'to strengthen'];
            const specificityIndicators = ['specific', 'particular', 'focused on', 'targeted', 'specialized in', 'concentrated on', 'dedicated to'];
            const assessmentLanguage = ['recommend', 'suggest', 'propose', 'should', 'needs to', 'would benefit from', 'critical for', 'essential for', 'important for'];
            const balancedIndicators = ['while', 'however', 'although', 'but also', 'on the other hand', 'additionally', 'furthermore', 'nonetheless'];
            
            const words = text.toLowerCase().split(/\W+/);
            const phrases = text.toLowerCase();
            
            // Count professional judgment indicators
            let reasoningCount = 0;
            reasoningIndicators.forEach(indicator => {
                if (phrases.includes(indicator)) reasoningCount++;
            });
            
            let specificityCount = 0;
            specificityIndicators.forEach(indicator => {
                if (phrases.includes(indicator)) specificityCount++;
            });
            
            let assessmentCount = 0;
            assessmentLanguage.forEach(indicator => {
                if (phrases.includes(indicator)) assessmentCount++;
            });
            
            let balanceCount = 0;
            balancedIndicators.forEach(indicator => {
                if (phrases.includes(indicator)) balanceCount++;
            });
            
            // Count subjective words that are inappropriate for professional evaluation
            const inappropriateSubjective = ['amazing', 'awesome', 'terrible', 'horrible', 'fantastic', 'awful'];
            const inappropriateCount = words.filter(word => inappropriateSubjective.includes(word)).length;
            
            // Count vague assessment language
            const vagueAssessment = ['good', 'bad', 'nice', 'okay', 'fine', 'decent', 'alright'];
            const vagueCount = words.filter(word => vagueAssessment.includes(word)).length;
            
            // Calculate base score for professional judgment
            let objectivityScore = 50; // Start with moderate baseline
            
            // Add points for good professional judgment elements
            objectivityScore += (reasoningCount * 10); // Reasoning is critical
            objectivityScore += (specificityCount * 8);
            objectivityScore += (assessmentCount * 6);
            objectivityScore += (balanceCount * 5);
            
            // Subtract points for issues
            objectivityScore -= (inappropriateCount * 15);
            objectivityScore -= (vagueCount * 8);
            
            // Bonus for detailed professional reasoning
            if (text.length > 150 && reasoningCount >= 2 && assessmentCount >= 1) {
                objectivityScore += 10;
            }
            
            // Penalty for suggestion-only content
            if (hasSuggestions && text.length < 100) {
                objectivityScore -= 15;
            }
            
            // Cap and floor the score appropriately for evaluative content
            return Math.min(90, Math.max(35, objectivityScore));
        }
        
        function calculatePerformanceObjectivity(text, fieldId, hasSuggestions) {
            // Data-driven objectivity for performance sections
            const subjectiveWords = ['good', 'bad', 'great', 'poor', 'nice', 'awesome', 'terrible', 'amazing', 'horrible', 'fantastic', 'awful', 'disappointing', 'impressive', 'wonderful', 'brilliant', 'mediocre', 'excellent', 'outstanding', 'exceptional', 'superb'];
            
            const objectiveIndicators = {
                keyPriorities: ['achieved target of', 'completed by deadline', 'delivered on time', 'met milestone', 'exceeded target', 'on schedule', 'within budget', 'project completed', 'goal reached', 'objective met'],
                collaboration: ['collaborated with [specific team]', 'facilitated X meetings', 'coordinated project with', 'resolved conflict between', 'improved team efficiency by', 'established partnership with']
            };
            
            const words = text.toLowerCase().split(/\W+/);
            const phrases = text.toLowerCase();
            
            // Count subjective words
            const subjectiveCount = words.filter(word => subjectiveWords.includes(word)).length;
            
            // Count vague phrases
            const vagueIndicators = ['did well', 'performed good', 'worked hard', 'tried their best', 'made an effort', 'showed improvement', 'was successful'];
            let vagueCount = 0;
            vagueIndicators.forEach(phrase => {
                if (phrases.includes(phrase)) vagueCount++;
            });
            
            // Count objective indicators
            let objectiveCount = 0;
            if (objectiveIndicators[fieldId]) {
                objectiveIndicators[fieldId].forEach(indicator => {
                    if (phrases.includes(indicator.toLowerCase())) objectiveCount++;
                });
            }
            
            // Count specific numbers, dates, percentages
            const numberMatches = text.match(/\d+%|\$\d+|\d+\.\d+|\d{1,2}\/\d{1,2}\/\d{2,4}/g);
            if (numberMatches) objectiveCount += numberMatches.length;
            
            // Add general objective performance words
            const generalObjective = ['implemented', 'managed', 'led', 'created', 'designed', 'analyzed', 'measured', 'tracked', 'documented'];
            objectiveCount += words.filter(word => generalObjective.includes(word)).length;
            
            // Calculate score
            const totalWords = subjectiveCount + objectiveCount + vagueCount;
            if (totalWords === 0) return 45;
            
            let objectivityScore = Math.round((objectiveCount / totalWords) * 100);
            
            // Apply penalties
            if (subjectiveCount > objectiveCount) objectivityScore = Math.max(20, objectivityScore - 15);
            if (vagueCount > 2) objectivityScore = Math.max(30, objectivityScore - 10);
            if (hasSuggestions && objectiveCount === 0) objectivityScore = Math.max(35, objectivityScore);
            
            return Math.min(85, Math.max(20, objectivityScore));
        }
        
        function calculateSpecificity(text, fieldId) {
            const textarea = document.getElementById(fieldId);
            const hasSuggestions = textarea && textarea.getAttribute('data-has-suggestions') === 'true';
            
            // Look for ACTUAL specific details, not just keywords
            const specificityIndicators = {
                keyPriorities: ['specific project name', 'Q[1-4] 20XX', 'by [specific date]', '[X]% target', '$[amount]', 'within [timeframe]', '[specific metric] improved'],
                resultsImpact: ['increased revenue by [X]%', 'saved $[amount]', 'improved [metric] from X to Y', 'ROI of [X]%', 'generated $[amount]', '[specific KPI] reached [number]'],
                collaboration: ['worked with [specific team/person]', '[X] stakeholders', '[specific department]', 'facilitated [X] meetings', 'resolved [specific] conflict'],
                growth: ['completed [specific] certification', '[course name]', 'learned [specific technology]', 'improved [skill] by [measure]', '[training program name]'],
                lookingAhead: ['needs training in [specific skill]', '[specific role] preparation', 'development in [area]', '[specific] stretch assignment', 'skill gap: [specific area]']
            };
            
            // Vague phrases that reduce specificity
            const vagueIndicators = ['did well', 'performed good', 'worked hard', 'tried their best', 'made an effort', 'showed improvement', 'was successful', 'did a good job', 'performed as expected', 'handled responsibilities', 'contributed to', 'participated in', 'involved in', 'supported the team', 'helped with', 'assisted', 'various projects', 'multiple initiatives', 'several tasks', 'different activities'];
            
            let specificCount = 0;
            let vagueCount = 0;
            
            const lowerText = text.toLowerCase();
            
            // Count actual numbers, percentages, dates, dollar amounts
            const numberMatches = text.match(/\d+%|\$\d+,?\d*|\d+\.\d+%?|\d{1,2}\/\d{1,2}\/\d{2,4}|\b\d+\s*(million|thousand|k|%)\b/gi);
            if (numberMatches) {
                specificCount += numberMatches.length * 2; // Weight numbers highly
            }
            
            // Count specific names, dates, timeframes
            const nameMatches = text.match(/[A-Z][a-z]+ [A-Z][a-z]+|Q[1-4] 20\d{2}|[A-Z][a-z]+ 20\d{2}|Project [A-Z][a-z]+/g);
            if (nameMatches) {
                specificCount += nameMatches.length;
            }
            
            // Look for "from X to Y" patterns
            const improvementPatterns = text.match(/from \d+.* to \d+|increased.*by \d+|decreased.*by \d+|improved.*from.*to/gi);
            if (improvementPatterns) {
                specificCount += improvementPatterns.length * 2;
            }
            
            // Count vague phrases (penalize these)
            vagueIndicators.forEach(phrase => {
                if (lowerText.includes(phrase)) vagueCount++;
            });
            
            // Check for incomplete suggestions (ends with "...")
            const incompleteCount = (text.match(/\.\.\./g) || []).length;
            
            // Penalty for mostly suggestion-based content without completion
            let penalty = 0;
            if (hasSuggestions) {
                if (incompleteCount > 0) penalty += 15; // Incomplete suggestions
                if (text.length < 80) penalty += 10; // Too short for specificity
                if (specificCount === 0) penalty += 20; // No specific details added
            }
            
            // Calculate base score
            const totalElements = specificCount + vagueCount + 1;
            let specificityScore = Math.round((specificCount / totalElements) * 100);
            
            // Apply penalties
            specificityScore = Math.max(15, specificityScore - penalty);
            
            // Penalize high vague count
            if (vagueCount > specificCount) {
                specificityScore = Math.max(25, specificityScore - 15);
            }
            
            // Section-specific adjustments
            if (fieldId === 'lookingAhead') {
                // Looking Ahead should focus on specific development areas
                if (text.includes('development') && specificCount === 0) {
                    specificityScore = Math.max(30, specificityScore - 10);
                }
            }
            
            // Cap the maximum to be more realistic
            return Math.min(80, Math.max(20, specificityScore));
        }
        
        function calculateCompleteness(text, fieldId) {
            const words = text.split(/\W+/).filter(word => word.length > 0);
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            // Section-specific completeness requirements
            const requiredElements = {
                keyPriorities: ['goals', 'objectives', 'deliverables', 'timeline', 'scope', 'priorities'],
                resultsImpact: ['outcome', 'result', 'impact', 'metric', 'measurement', 'business value', 'achievement'],
                collaboration: ['partnership', 'teamwork', 'communication', 'stakeholder', 'cross-functional', 'relationship'],
                growth: ['skill', 'development', 'learning', 'improvement', 'competency', 'capability', 'knowledge'],
                lookingAhead: ['opportunity', 'development', 'growth area', 'next steps', 'future', 'recommendation', 'plan']
            };
            
            let score = 0;
            
            // Word count scoring (adjusted per section)
            const minWords = fieldId === 'lookingAhead' ? 40 : 30; // Looking ahead needs more detail
            if (words.length >= minWords + 20) score += 35;
            else if (words.length >= minWords) score += 25;
            else if (words.length >= minWords - 10) score += 15;
            else score += 5;
            
            // Sentence structure scoring
            const minSentences = 3;
            if (sentences.length >= minSentences + 2) score += 25;
            else if (sentences.length >= minSentences) score += 20;
            else if (sentences.length >= 2) score += 15;
            else score += 5;
            
            // Section-specific content elements
            if (requiredElements[fieldId]) {
                const elementCount = requiredElements[fieldId].filter(element => 
                    text.toLowerCase().includes(element)
                ).length;
                
                if (elementCount >= 3) score += 25;
                else if (elementCount >= 2) score += 20;
                else if (elementCount >= 1) score += 15;
                else score += 5;
            }
            
            // Evidence and examples
            const evidenceIndicators = ['for example', 'specifically', 'such as', 'including', 'demonstrated by', 'evidenced by', 'shown through'];
            const evidenceCount = evidenceIndicators.filter(indicator => text.toLowerCase().includes(indicator)).length;
            
            if (evidenceCount >= 2) score += 15;
            else if (evidenceCount >= 1) score += 10;
            else score += 5;
            
            return Math.min(100, score);
        }
        
        function detectBias(text, fieldId) {
            const alerts = [];
            const lowerText = text.toLowerCase();
            
            // Advanced bias analysis - evaluate content substance and reasoning patterns
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
            const substantiveAnalysis = analyzeContentSubstance(text, sentences, fieldId);
            
            // Check for surface-level compliance vs. substantive content
            if (substantiveAnalysis.hasKeywords && !substantiveAnalysis.hasSubstance) {
                alerts.push('<strong>Surface Compliance:</strong> Contains expected keywords but lacks substantive analysis. Provide deeper context and specific reasoning.');
            }
            
            // Section-specific bias detection with enhanced objectivity, specificity, and completeness
            if (fieldId === 'keyPriorities') {
                // Key Priorities focuses on: primary goals + specific results + measurable progress + business impact
                const hasGoals = text.match(/goals?|priorities|objectives?|targets?|deliverables?|responsibilities/i);
                const hasResults = text.match(/results?|delivered|achieved|completed|accomplished|outcomes?|finished/i);
                const hasMetrics = text.match(/\d+%|\$[\d,]+|\d+\.\d+|increased|decreased|improved|reduced|exceeded|delivered|\d+\s*(million|thousand|k\b)|baseline|target|benchmark/i);
                const hasBusiness = text.match(/revenue|cost|efficiency|customer|market|business|ROI|impact|profit|sales|growth|savings|productivity/i);
                const hasSpecificity = text.match(/specifically|exactly|precisely|by.*\d+|from.*to|within.*timeframe|Q[1-4]|month|quarter/i);
                const hasContext = text.match(/because|due to|in order to|to address|resulted from|stemmed from|aimed at/i);
                
                // Completeness checks
                if (!hasGoals) {
                    alerts.push('<strong>Missing Goals Context:</strong> Question asks for "primary goals" - clearly state what their main priorities/objectives were for the year.');
                }
                
                if (!hasResults) {
                    alerts.push('<strong>Results Not Specified:</strong> Question asks for "specific results delivered" - describe concrete outcomes and accomplishments.');
                }
                
                if (!hasMetrics) {
                    alerts.push('<strong>No Measurable Progress:</strong> Question requires "measurable progress" - include numbers, percentages, or quantifiable improvements.');
                }
                
                if (!hasBusiness) {
                    alerts.push('<strong>Business Impact Missing:</strong> Question asks for "clear impact on business outcomes" - connect results to business value, revenue, efficiency, etc.');
                }
                
                // Objectivity and specificity checks
                if (hasMetrics && !hasBusiness) {
                    alerts.push('<strong>Metrics Without Business Connection:</strong> Numbers provided but missing explanation of business impact. How did these results affect the company?');
                }
                
                if (!hasSpecificity && hasResults) {
                    alerts.push('<strong>Vague Results:</strong> Results mentioned but lack specificity. Include timelines, exact amounts, or precise outcomes.');
                }
                
                if (!hasContext && hasGoals) {
                    alerts.push('<strong>Missing Goal Context:</strong> Goals stated but missing why they were priorities. Explain business rationale or strategic importance.');
                }
                
                // Check for subjective language vs objective facts
                const subjectiveWords = text.match(/amazing|excellent|outstanding|fantastic|incredible|awesome|great|good|nice/gi);
                if (subjectiveWords && subjectiveWords.length >= 2) {
                    alerts.push('<strong>Subjective Language:</strong> Replace opinion words with objective facts, data, and measurable outcomes.');
                }
            }
            
            
            if (fieldId === 'collaboration') {
                // Collaboration focuses on: specific ways partnered + cross-team delivery + areas for stronger collaboration
                const hasSpecificWays = text.match(/partnered with|collaborated with|worked with|teamed with|facilitated|coordinated|led joint/i);
                const hasResults = text.match(/delivered|results?|outcomes?|achieved|completed|successful|resolved|improved/i);
                const hasGrowth = text.match(/stronger|improve|better|enhance|develop|could|should|opportunity|challenge|struggle/i);
                const hasMultipleExamples = (text.match(/\(1\)|first|second|third|one|two|three|\d\)|•|-\s/gi) || []).length >= 2;
                const hasSpecificTeams = text.match(/marketing|sales|IT|finance|operations|product|engineering|HR|legal|design/i);
                const hasMethodology = text.match(/meetings|workshops|stakeholder|communication|process|framework|methodology/i);
                const hasChallenges = text.match(/challenge|difficult|conflict|disagreement|obstacle|barrier|tension|issue/i);
                
                // Completeness checks
                if (!hasSpecificWays) {
                    alerts.push('<strong>Missing Partnership Details:</strong> Question asks for "specific ways" they partnered - describe concrete collaboration methods and approaches.');
                }
                
                if (!hasMultipleExamples) {
                    alerts.push('<strong>Insufficient Examples:</strong> Question asks for "two or three specific ways" - provide multiple distinct collaboration examples.');
                }
                
                if (!hasResults) {
                    alerts.push('<strong>No Delivery Outcomes:</strong> Question asks for partnerships "to deliver results" - connect collaboration to specific outcomes achieved.');
                }
                
                if (!hasGrowth) {
                    alerts.push('<strong>Missing Growth Areas:</strong> Question asks "where could their partnership and collaboration have been stronger" - identify specific improvement opportunities.');
                }
                
                // Specificity and objectivity checks
                if (!hasSpecificTeams && hasSpecificWays) {
                    alerts.push('<strong>Vague Team References:</strong> Specify which teams/departments they collaborated with (e.g., Marketing, IT, Sales) rather than generic "cross-functional teams."');
                }
                
                if (!hasMethodology && hasSpecificWays) {
                    alerts.push('🔧 <strong>Missing Collaboration Methods:</strong> Describe HOW they collaborated (meetings, workshops, shared processes) not just that they did.');
                }
                
                if (!hasChallenges && sentences.length > 2) {
                    alerts.push('<strong>Unrealistically Positive:</strong> Real collaboration involves challenges. Include balanced feedback on obstacles navigated or areas for improvement.');
                }
                
                // Check for vague communication language
                const vagueComm = text.match(/great communicator|excellent people skills|good with people|strong interpersonal/i);
                if (vagueComm) {
                    alerts.push('💬 <strong>Communication Clichés:</strong> Replace vague phrases like "great communicator" with specific examples of communication challenges solved or methods used.');
                }
                
                // Check for attribution accuracy
                const soloCredit = text.match(/single-handedly|solely|entirely|all by|only person/i);
                if (soloCredit) {
                    alerts.push('<strong>Collaboration vs Solo Credit:</strong> In collaboration section, ensure credit is appropriately shared with team members and partners.');
                }
            }
            
            if (fieldId === 'growth') {
                // Growth & Development focuses on: critical development areas + targeted experiences + growth acceleration (FUTURE-LOOKING)
                const hasCriticalAreas = text.match(/critical|key|most important|priority|development areas?|growth areas?|skills?|capabilities?/i);
                const hasTargetedExperiences = text.match(/training|expanded scope|new responsibilities|stretch work|experience|project|assignment|rotation|certification|coaching|mentoring/i);
                const hasAcceleration = text.match(/accelerate|best.*growth|would.*develop|strengthen|build|enhance|improve/i);
                const hasMultiplePriorities = (text.match(/\(1\)|first|second|third|one|two|three|\d\)|•/gi) || []).length >= 2;
                const hasNextYear = text.match(/next year|coming year|future|going forward|development plan/i);
                
                if (!hasCriticalAreas) {
                    alerts.push('<strong>Development Areas Not Identified:</strong> Question asks for "most critical development areas" - identify specific skills, capabilities, or competencies to develop next year.');
                }
                
                if (!hasTargetedExperiences) {
                    alerts.push('<strong>Missing Development Experiences:</strong> Question asks for "targeted experiences such as training, expanded scope, new responsibilities, or stretch work" - specify concrete development opportunities.');
                }
                
                if (!hasAcceleration) {
                    alerts.push('<strong>Growth Acceleration Missing:</strong> Question asks what would "best accelerate their growth" - explain how the suggested experiences will drive their development forward.');
                }
                
                if (!hasMultiplePriorities) {
                    alerts.push('<strong>Insufficient Development Areas:</strong> Question asks for "two or three most critical" areas - provide multiple distinct development priorities for next year.');
                }
                
                // Check for backward-looking content (should be forward-looking)
                const hasBackwardLanguage = text.match(/has grown|developed|learned|completed|achieved|demonstrated/i);
                const hasForwardLanguage = text.match(/should|needs to|recommend|suggest|propose|would benefit|next year|going forward/i);
                
                if (hasBackwardLanguage && !hasForwardLanguage) {
                    alerts.push('🔮 <strong>Past vs Future Focus:</strong> This question is about future development needs. Focus on what they need to develop next year, not past accomplishments.');
                }
                
                // Objectivity for development recommendations (reasoned professional judgment)
                const unreasonedDevelopment = !text.match(/because|to|in order to|would help|will build|strengthens?|addresses?|supports?/i) && text.length > 50;
                if (unreasonedDevelopment) {
                    alerts.push('<strong>Unsupported Recommendations:</strong> Explain WHY these development areas are priorities and HOW the suggested experiences will address them.');
                }
                
                // Check for development rationale specificity
                const vagueRationale = text.match(/needs to grow|could be better|should improve|general development/i);
                if (vagueRationale) {
                    alerts.push('<strong>Vague Development Rationale:</strong> Replace general improvement language with specific capabilities, competencies, or skills that need development.');
                }
            }
            
            if (fieldId === 'lookingAhead') {
                // Looking Ahead focuses on: peer differentiation + rating assumptions + measurable progress + support actions
                const hasDifferentiation = text.match(/differentiat|compar|peers?|others?|stands out|excels|unique|distinguishes|separates/i);
                const hasAssumptions = text.match(/assumption|based on|influenced by|evidence|reason|because|due to|given that/i);
                const hasMeasurable = text.match(/progress|expect|six months?|\d+%|measurable|goal|target|by.*date|within.*timeframe|Q[1-4]/i);
                const hasSupportActions = text.match(/support|actions?|will|provide|help|facilitate|commit to|plan to|schedule/i);
                const hasSpecificEvidence = text.match(/demonstrated|shown by|evidenced|proven|track record|performance data|metrics|results/i);
                const hasConcreteSupport = text.match(/meeting|training|coaching|resources|budget|time|project|assignment|mentoring/i);
                const hasTimeframes = text.match(/by.*\d+|within.*weeks?|next.*months?|Q[1-4]|timeline|schedule|deadline/i);
                
                if (!hasDifferentiation) {
                    alerts.push('<strong>Missing Peer Comparison:</strong> Question asks "what clearly differentiates this associate" compared to others - provide specific comparative strengths.');
                }
                
                if (!hasAssumptions) {
                    alerts.push('<strong>Rating Assumptions Missing:</strong> Question asks "what assumptions influenced your rating" - explain the evidence and reasoning behind your evaluation.');
                }
                
                if (!hasMeasurable) {
                    alerts.push('� <strong>No Measurable Progress Expected:</strong> Question asks for "measurable progress...in the next six months" - specify concrete, trackable outcomes.');
                }
                
                if (!hasMeasurable) {
                    alerts.push('<strong>No Measurable Progress Expected:</strong> Question asks for "measurable progress...in the next six months" - specify concrete, trackable outcomes.');
                }
                
                if (!hasSupportActions) {
                    alerts.push('<strong>Support Actions Not Specified:</strong> Question asks for "specific actions you will take to support their development" - detail your commitments as their manager.');
                }
                
                // Enhanced objectivity and specificity checks for Looking Ahead
                if (!hasSpecificEvidence && hasAssumptions) {
                    alerts.push('<strong>Vague Assumptions:</strong> Rating assumptions mentioned but lack clear reasoning. Explain what specific observations, patterns, or capabilities influenced your evaluation.');
                }
                
                if (!hasConcreteSupport && hasSupportActions) {
                    alerts.push('<strong>Generic Support Actions:</strong> Support mentioned but not specific. Detail exact resources, meetings, training, or opportunities you will provide.');
                }
                
                if (!hasTimeframes && hasMeasurable) {
                    alerts.push('<strong>Missing Timelines:</strong> Measurable progress mentioned but lacks specific timeframes. Include when progress will be measured or achieved.');
                }
                
                // Check for comparison specificity (different standard - qualitative assessment vs quantitative data)
                const vagueComparison = text.match(/better than others|above average|top performer|one of the best/i);
                if (vagueComparison) {
                    alerts.push('<strong>Vague Peer Comparison:</strong> Replace general comparisons with specific capabilities, working style, or unique strengths that distinguish this person from peers.');
                }
                
                // Check for action commitment vs suggestion
                const suggestions = text.match(/could|might|should|may|possibly/i);
                const commitments = text.match(/will|commit to|plan to|schedule|allocate|provide/i);
                if (suggestions && !commitments) {
                    alerts.push('<strong>Weak Commitment Language:</strong> Replace tentative language (could, might) with firm commitments about support actions you will take.');
                }
                
                // Objectivity for evaluative questions (different from data-driven objectivity)
                const subjectiveEvaluative = text.match(/amazing|incredible|fantastic|perfect|flawless/gi);
                if (subjectiveEvaluative && subjectiveEvaluative.length >= 2) {
                    alerts.push('<strong>Overly Subjective Evaluation:</strong> Use professional assessment language. Focus on specific capabilities and reasoned judgments rather than emotional descriptors.');
                }
                
                // Check for balanced assessment (critical for fair evaluation)
                const onlyPositive = !text.match(/improve|develop|challenge|opportunity|growth|next level|strengthen/i) && text.length > 100;
                if (onlyPositive) {
                    alerts.push('<strong>One-Sided Assessment:</strong> Include development opportunities or areas for continued growth to provide balanced evaluation.');
                }
            }
            
            // Universal bias checks with advanced pattern analysis
            
            // Sophisticated Easy Rater Detection
            const easyRaterAnalysis = detectEasyRaterPatterns(text, sentences);
            if (easyRaterAnalysis.isEasyRating) {
                alerts.push(`<strong>Easy Rater Pattern:</strong> ${easyRaterAnalysis.reason}`);
            }
            
            // Logical consistency check
            const consistencyAnalysis = analyzeLogicalConsistency(text, sentences, fieldId);
            if (consistencyAnalysis.hasInconsistency) {
                alerts.push(`<strong>Logical Inconsistency:</strong> ${consistencyAnalysis.issue}`);
            }
            
            // Enhanced Specificity Detection
            const vagueWords = ['good', 'nice', 'fine', 'okay', 'decent', 'alright', 'satisfactory', 'great', 'awesome', 'excellent'];
            const vagueCount = vagueWords.filter(word => lowerText.includes(word)).length;
            
            if (vagueCount >= 2) {
                alerts.push('<strong>Vague Language:</strong> Replace general terms with specific behaviors, outcomes, or measurable examples.');
            }
            
            // Objectivity: Numbers without Context Detection
            const numbersWithoutContext = text.match(/\d+%|\$[\d,]+|\d+\.\d+/) && !text.match(/compared to|versus|target|baseline|benchmark|industry average|peer average/i);
            if (numbersWithoutContext && sentences.length > 1) {
                alerts.push('<strong>Numbers Need Context:</strong> Metrics provided but missing comparison benchmarks. Include targets, peer averages, or previous performance.');
            }
            
            // Enhanced Gender/Demographic Bias Detection
            const biasTerms = ['aggressive', 'bossy', 'emotional', 'nurturing', 'soft-spoken', 'cultural fit', 'natural leader', 'assertive', 'abrasive', 'ambitious'];
            const biasFound = biasTerms.some(term => lowerText.includes(term));
            
            if (biasFound) {
                alerts.push('<strong>Potential Bias Language:</strong> Review for unconscious bias. Focus on specific behaviors and measurable outcomes instead of personality traits.');
            }
            
            // Recency Bias Detection (Enhanced)
            const recentWords = ['recently', 'last week', 'yesterday', 'just completed', 'latest', 'this month', 'just finished', 'currently'];
            const recentCount = recentWords.filter(word => lowerText.includes(word)).length;
            
            if (recentCount >= 2) {
                alerts.push('📅 <strong>Recency Bias:</strong> Ensure feedback represents the entire review period, not just recent events.');
            }
            
            // Attribution Accuracy (Completeness)
            const soloCredit = text.match(/single-handedly|solely responsible|all by myself|entirely due to me|only person who/i);
            if (soloCredit) {
                alerts.push('<strong>Attribution Check:</strong> Verify if accomplishments involved team effort. Ensure appropriate credit sharing.');
            }
            
            // Consistency: Conflicting Ratings
            const positiveWords = ['exceptional', 'outstanding', 'exceeded', 'excellent', 'superior'];
            const negativeWords = ['needs improvement', 'below expectations', 'struggled', 'failed', 'inadequate'];
            const hasPositive = positiveWords.some(word => lowerText.includes(word));
            const hasNegative = negativeWords.some(word => lowerText.includes(word));
            
            if (hasPositive && hasNegative && sentences.length > 2) {
                alerts.push('<strong>Rating Consistency:</strong> Contains both highly positive and negative language. Ensure overall rating aligns with detailed feedback.');
            }
            
            return alerts;
        }
        
        function updateMetric(metricId, value) {
            const metric = document.getElementById(metricId);
            const valueSpan = metric.querySelector('.metric-value');
            
            valueSpan.textContent = `${value}%`;
            
            // Update styling based on value
            metric.classList.remove('good', 'warning', 'poor');
            if (value >= 70) {
                metric.classList.add('good');
            } else if (value >= 40) {
                metric.classList.add('warning');
            } else {
                metric.classList.add('poor');
            }
        }
        
        function displayBiasAlerts(alertsId, alerts) {
            const alertsContainer = document.getElementById(alertsId);
            
            if (alerts.length === 0) {
                alertsContainer.innerHTML = '<div class="bias-alert" style="color: #28a745;"><strong>No bias patterns detected. Great objective feedback!</strong></div>';
            } else {
                alertsContainer.innerHTML = alerts.map(alert => `<div class="bias-alert">${alert}</div>`).join('');
            }
        }

        // Advanced Bias Analysis Functions
        
        function analyzeContentSubstance(text, sentences, fieldId) {
            const lowerText = text.toLowerCase();
            
            // Check if text has expected keywords but lacks substance
            const expectedKeywords = {
                keyPriorities: ['goal', 'priority', 'objective', 'target', 'deliverable'],
                resultsImpact: ['result', 'impact', 'outcome', 'achievement', 'delivered'],
                collaboration: ['team', 'partner', 'stakeholder', 'cross-functional'],
                growth: ['develop', 'learn', 'skill', 'training', 'improve'],
                lookingAhead: ['opportunity', 'development', 'next', 'future', 'recommend']
            };
            
            const relevantKeywords = expectedKeywords[fieldId] || [];
            const keywordCount = relevantKeywords.filter(keyword => lowerText.includes(keyword)).length;
            
            // Check for substance indicators
            const substanceIndicators = [
                'because', 'therefore', 'however', 'specifically', 'for example', 
                'demonstrated by', 'evidenced through', 'resulting in', 'which led to',
                'by doing', 'through', 'via', 'when', 'during', 'after'
            ];
            
            const substanceCount = substanceIndicators.filter(indicator => lowerText.includes(indicator)).length;
            const avgWordsPerSentence = text.split(/\s+/).length / Math.max(sentences.length, 1);
            
            return {
                hasKeywords: keywordCount >= 1,
                hasSubstance: substanceCount >= 1 || avgWordsPerSentence > 15,
                substanceRatio: substanceCount / Math.max(sentences.length, 1)
            };
        }
        
        function analyzeGoalContext(text, sentences) {
            const lowerText = text.toLowerCase();
            
            const contextIndicators = [
                'role requires', 'expected to', 'responsible for', 'accountable for',
                'business objective', 'strategic goal', 'department target', 'company priority'
            ];
            
            const qualitativeDescriptors = [
                'complex', 'challenging', 'critical', 'high-priority', 'time-sensitive',
                'cross-departmental', 'customer-facing', 'revenue-generating'
            ];
            
            return {
                meaningful: contextIndicators.some(indicator => lowerText.includes(indicator)),
                qualitative: qualitativeDescriptors.some(descriptor => lowerText.includes(descriptor))
            };
        }
        
        function analyzeImpactSubstance(text, sentences) {
            const lowerText = text.toLowerCase();
            
            // Check for causal connection words
            const causalWords = ['by', 'through', 'because', 'resulted in', 'led to', 'caused', 'enabled', 'contributed to'];
            const hasCausalConnection = causalWords.some(word => lowerText.includes(word));
            
            // Check for contextual meaning
            const contextWords = ['compared to', 'versus', 'target was', 'baseline', 'previous year', 'industry average', 'benchmark'];
            const hasContextualMeaning = contextWords.some(word => lowerText.includes(word));
            
            // Check for qualitative impact
            const qualitativeImpact = ['customer satisfaction', 'team morale', 'process efficiency', 'brand reputation', 'market position'];
            const hasQualitativeImpact = qualitativeImpact.some(impact => lowerText.includes(impact));
            
            // Check for attribution inflation
            const inflationWords = ['single-handedly', 'solely responsible', 'entirely due to', 'completely transformed'];
            const inflatedClaims = inflationWords.some(word => lowerText.includes(word));
            
            return {
                causalConnection: hasCausalConnection,
                contextualMeaning: hasContextualMeaning,
                qualitativeImpact: hasQualitativeImpact,
                inflatedClaims: inflatedClaims
            };
        }
        
        function analyzeCollaborationSubstance(text, sentences) {
            const lowerText = text.toLowerCase();
            
            const keyWords = ['team', 'collaboration', 'partnership', 'cross-functional'];
            const hasKeywords = keyWords.some(word => lowerText.includes(word));
            
            // Check for specific examples
            const specificExamples = ['project', 'initiative', 'meeting', 'presentation', 'conflict resolution', 'facilitated'];
            const hasSpecificExamples = specificExamples.some(example => lowerText.includes(example));
            
            // Check for teamwork inflation
            const inflationTerms = ['natural born leader', 'everyone loves', 'perfect team player', 'never any conflicts'];
            const inflatedTeamwork = inflationTerms.some(term => lowerText.includes(term));
            
            // Check for vague communication
            const vagueTerms = ['great communicator', 'excellent people skills', 'good with people', 'strong interpersonal'];
            const vagueCommunication = vagueTerms.some(term => lowerText.includes(term)) && !hasSpecificExamples;
            
            return {
                hasKeywords,
                hasSpecificExamples,
                inflatedTeamwork,
                vagueCommunication
            };
        }
        

        
        function analyzeFutureSubstance(text, sentences) {
            const lowerText = text.toLowerCase();
            
            const recommendationWords = ['recommend', 'suggest', 'should', 'could', 'next steps'];
            const hasRecommendations = recommendationWords.some(word => lowerText.includes(word));
            
            // Check for reasoning
            const reasoningWords = ['because', 'since', 'given that', 'in order to', 'to improve', 'to enhance'];
            const hasReasoning = reasoningWords.some(word => lowerText.includes(word));
            
            // Check for generic development
            const genericTerms = ['leadership skills', 'communication', 'time management', 'general improvement'];
            const specificTerms = ['Excel proficiency', 'Python programming', 'customer segmentation analysis'];
            const genericDevelopment = genericTerms.some(term => lowerText.includes(term)) && 
                                     !specificTerms.some(term => lowerText.includes(term));
            
            // Check if avoiding difficult conversations
            const avoidanceWords = ['continue current path', 'keep up the good work', 'more of the same'];
            const avoidsDifficultConversation = avoidanceWords.some(word => lowerText.includes(word));
            
            // Check for unrealistic timeline
            const urgentWords = ['immediately', 'by next month', 'within weeks', 'right away'];
            const unrealisticTimeline = urgentWords.some(word => lowerText.includes(word));
            
            return {
                hasRecommendations,
                hasReasoning,
                genericDevelopment,
                avoidsDifficultConversation,
                unrealisticTimeline
            };
        }
        
        function detectEasyRaterPatterns(text, sentences) {
            const lowerText = text.toLowerCase();
            
            // Pattern 1: High praise without evidence
            const praiseWords = ['excellent', 'outstanding', 'amazing', 'fantastic', 'brilliant', 'perfect'];
            const evidenceWords = ['because', 'demonstrated', 'achieved', 'delivered', 'resulted in'];
            const hasPraise = praiseWords.some(word => lowerText.includes(word));
            const hasEvidence = evidenceWords.some(word => lowerText.includes(word)) || text.match(/\d+%|\$\d+/);
            
            if (hasPraise && !hasEvidence && sentences.length >= 2) {
                return {
                    isEasyRating: true,
                    reason: 'High praise without supporting evidence or specific examples.'
                };
            }
            
            // Pattern 2: All positive, no growth areas
            const negativeWords = ['challenge', 'difficulty', 'improve', 'develop', 'opportunity', 'could', 'should'];
            const hasBalancedFeedback = negativeWords.some(word => lowerText.includes(word));
            
            if (sentences.length >= 3 && !hasBalancedFeedback && hasPraise) {
                return {
                    isEasyRating: true,
                    reason: 'Only positive feedback with no growth opportunities or challenges mentioned.'
                };
            }
            
            // Pattern 3: Repetitive praise
            const uniquePraiseCount = new Set(praiseWords.filter(word => lowerText.includes(word))).size;
            const totalPraiseCount = praiseWords.filter(word => lowerText.includes(word)).length;
            
            if (totalPraiseCount >= 3 && uniquePraiseCount <= 2) {
                return {
                    isEasyRating: true,
                    reason: 'Repetitive positive language without varied, specific feedback.'
                };
            }
            
            return { isEasyRating: false };
        }
        
        function analyzeLogicalConsistency(text, sentences, fieldId) {
            const lowerText = text.toLowerCase();
            
            // Check for contradictory statements
            if (lowerText.includes('excellent') && lowerText.includes('needs improvement')) {
                return {
                    hasInconsistency: true,
                    issue: 'Contains both excellent performance and improvement needs without clear context.'
                };
            }
            
            // Check for unsupported superlatives
            const superlatives = ['always', 'never', 'every time', 'constantly', 'all', 'none'];
            const hasSuperlatives = superlatives.some(word => lowerText.includes(word));
            const hasExceptions = lowerText.includes('except') || lowerText.includes('however') || lowerText.includes('sometimes');
            
            if (hasSuperlatives && !hasExceptions && sentences.length >= 2) {
                return {
                    hasInconsistency: true,
                    issue: 'Uses absolute terms (always/never) without acknowledging exceptions or context.'
                };
            }
            
            return { hasInconsistency: false };
        }

        function loadReviewerDashboard() {
            const reviewer = reviewerData[currentReviewer];
            const allEmployees = Object.values(reviewer.employees || {});
            const employees = allEmployees.filter(emp => !emp.archived);
            const archivedEmployees = allEmployees.filter(emp => emp.archived);
            
            document.querySelector('.container').innerHTML = `
                <div class="sidebar">
                    <div class="reviewer-info">
                        <h3>Welcome, ${reviewer.name}</h3>
                        <button class="btn btn-outline btn-small" onclick="logoutReviewer()">Logout</button>
                    </div>
                    
                    <div class="employee-list">
                        <!-- Unified Employee Search/Select -->
                        <div class="search-section">
                            <div class="employee-search-container">
                                <input type="text" id="employeeSearch" placeholder="Search Associate Name..." 
                                       oninput="searchEmployees()" onfocus="showEmployeeDropdown()" 
                                       onkeypress="if(event.key==='Enter') selectFirstEmployee()"
                                       autocomplete="off" class="employee-search-input">
                                <div class="employee-dropdown" id="employeeDropdown" style="display: none;">
                                    <div class="dropdown-loading">Loading team members...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="employee-actions-panel" id="employee-actions-panel" style="display: none;">
                            <div class="smart-actions-list">
                                <div class="smart-action-item" onclick="startSelectedEmployeeEvaluation()">Start Evaluation</div>
                                <div class="smart-action-item" onclick="downloadSelectedEmployeePDF()">Download PDF</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-add-employee" onclick="addNewEmployee()">
                            + Add New Employee
                        </button>
                    </div>
                    
                    ${archivedEmployees.length > 0 ? `
                    <div class="archived-employees">
                        <h4>Archived Team Members (${archivedEmployees.length})</h4>
                        <div class="archived-toggle" onclick="toggleArchivedEmployees()" id="archived-toggle">
                            <span>▼ Show Archived</span>
                        </div>
                        <div class="archived-list" id="archived-list" style="display: none;">
                            ${archivedEmployees.map(emp => `
                                <div class="employee-item archived">
                                    <div class="employee-content" onclick="startEvaluation('${emp.id}')">
                                        <div class="employee-name">${emp.name}</div>
                                        <div class="employee-status archived-status">
                                            📁 Archived ${emp.archivedDate ? '(' + new Date(emp.archivedDate).toLocaleDateString() + ')' : ''}
                                        </div>
                                    </div>
                                    <div class="employee-actions">
                                        <button class="btn btn-download ${emp.evaluationData && Object.keys(emp.evaluationData).length > 0 ? '' : 'disabled'}" 
                                                onclick="downloadIndividualEvaluationPDF('${emp.id}', event)" 
                                                title="Download Evaluation PDF" 
                                                ${emp.evaluationData && Object.keys(emp.evaluationData).length > 0 ? '' : 'disabled'}>📄</button>
                                        <button class="btn btn-restore" onclick="restoreEmployee('${emp.id}', event)" title="Restore to Active Team">Restore</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="team-summary">
                        <h4>Team Summary</h4>
                        <div class="summary-stats">
                            <div class="stat">
                                <span class="stat-number">${employees.filter(e => e.status === 'completed').length}</span>
                                <span class="stat-label">Completed</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number">${employees.filter(e => e.status === 'in-progress').length}</span>
                                <span class="stat-label">In Progress</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number">${employees.filter(e => e.status === 'not-started').length}</span>
                                <span class="stat-label">Not Started</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="content-card">
                        <div class="dashboard-welcome">
                            <div class="quick-actions">
                                <h3>Quick Actions</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" onclick="showAnalyticsInsights()">Analytics & Insights</button>
                                    <button class="btn btn-primary" onclick="exportEvaluations()">Export All Evaluations (PDF)</button>
                                </div>
                            </div>
                            
                            <div class="recent-activity">
                                <h3>Recent Activity</h3>
                                <div class="activity-list">
                                    ${employees.filter(e => e.status !== 'not-started')
                                        .sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated))
                                        .slice(0, 5)
                                        .map(emp => `
                                            <div class="activity-item">
                                                <div class="activity-main">
                                                    <div class="activity-name">${emp.name}</div>
                                                    <div class="activity-action">Evaluation ${emp.status === 'completed' ? 'completed' : 'updated'}</div>
                                                </div>
                                                <div class="activity-date">${new Date(emp.lastUpdated).toLocaleDateString()}</div>
                                            </div>
                                        `).join('') || '<div class="activity-item"><div class="activity-main"><div class="activity-name">No recent activity</div></div></div>'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function startEvaluation(employeeId) {
            currentEmployee = employeeId;
            const employee = reviewerData[currentReviewer].employees[employeeId];
            
            // Load the evaluation form
            loadEvaluationForm(employee);
        }

        function loadEvaluationForm(employee) {
            // Update the entire container to show evaluation mode
            document.querySelector('.container').innerHTML = `
                <div class="sidebar">
                    <div class="reviewer-info">
                        <h3>Welcome, ${reviewerData[currentReviewer].name}</h3>
                        <button class="btn btn-outline btn-small" onclick="logoutReviewer()">Logout</button>
                    </div>
                    
                    <!-- Current Employee Info -->
                    <div class="current-employee-info">
                        <h4>Current Evaluation</h4>
                        <div class="employee-card">
                            <div class="employee-name">${employee.name}</div>
                            <div class="employee-position">${employee.position}</div>
                            <div class="employee-status status-${employee.status}">
                                ${employee.status === 'completed' ? '✓ Complete' : 
                                  employee.status === 'in-progress' ? '⏱ In Progress' : '○ Not Started'}
                            </div>
                        </div>
                        <button class="btn btn-outline btn-small" onclick="loadReviewerDashboard()" style="margin-top: 10px; width: 100%;">
                            ← Back to Team List
                        </button>
                    </div>
                    
                    <!-- Undo/Redo Controls -->
                    <div class="undo-redo-controls">
                        <h5>Actions</h5>
                        <div class="undo-redo-buttons">
                            <button class="undo-redo-btn" id="undoBtn" onclick="undo()" disabled title="Nothing to undo">
                                <span class="btn-icon">↶</span>
                                <span class="btn-text">Undo</span>
                            </button>
                            <button class="undo-redo-btn" id="redoBtn" onclick="redo()" disabled title="Nothing to redo">
                                <span class="btn-icon">↷</span>
                                <span class="btn-text">Redo</span>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="completeEvalBtn" onclick="completeEvaluationFromSidebar()" 
                                style="width: 100%; margin-top: 15px;" 
                                title="Complete and submit this evaluation">
                            Complete Evaluation
                        </button>
                        <div class="undo-redo-note">
                            Undo/redo text changes, ratings, and navigation
                        </div>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <h4>Progress</h4>
                        <div class="step active" onclick="goToStep(0)" title="Basic Information & Rating">
                            <span class="step-number">1</span>
                            <span class="step-title">Basic Info</span>
                        </div>
                        <div class="step" onclick="goToStep(1)" title="Key Priorities">
                            <span class="step-number">2</span>
                            <span class="step-title">Key Priorities</span>
                        </div>
                        <div class="step" onclick="goToStep(2)" title="Collaboration & Influence">
                            <span class="step-number">3</span>
                            <span class="step-title">Collaboration</span>
                        </div>
                        <div class="step" onclick="goToStep(3)" title="Growth & Development">
                            <span class="step-number">4</span>
                            <span class="step-title">Growth</span>
                        </div>
                        <div class="step" onclick="goToStep(4)" title="Looking Ahead">
                            <span class="step-number">5</span>
                            <span class="step-title">Looking Ahead</span>
                        </div>
                        <div class="step" onclick="goToStep(5)" title="Comprehensive Summary">
                            <span class="step-number">6</span>
                            <span class="step-title">Summary</span>
                        </div>
                    </div>
                </div>
                
                <div class="main-content">
                    <!-- Progress Indicator -->
                    <div class="progress-indicator" id="progressIndicator">
                        <div class="progress-header">
                            <div class="progress-title">Evaluation Progress</div>
                            <div class="progress-percentage" id="progressPercentage">14%</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBarFill" style="width: 14%"></div>
                        </div>
                        <div class="progress-current-step" id="progressCurrentStep">Step 1 of 7: Basic Information & Overall Rating</div>
                    </div>
                    <!-- Horizontal Step Navigation -->
                    <div class="horizontal-step-nav">
                        <div class="step-navigation">
                            <div class="step active" onclick="goToStep(0)" title="Basic Information & Rating">1</div>
                            <div class="step" onclick="goToStep(1)" title="Key Priorities">2</div>
                            <div class="step" onclick="goToStep(2)" title="Collaboration & Influence">3</div>
                            <div class="step" onclick="goToStep(3)" title="Growth & Development">4</div>
                            <div class="step" onclick="goToStep(4)" title="Looking Ahead">5</div>
                            <div class="step" onclick="goToStep(5)" title="Comprehensive Summary">6</div>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <div class="evaluation-header">
                            <button class="btn btn-outline btn-back" onclick="loadReviewerDashboard()">← Back to Dashboard</button>
                            <div class="employee-info">
                                <h2>${employee.name} | ${employee.position}</h2>
                                <p class="employee-status-line">Status: <span class="status-${employee.status}">${employee.status.replace('-', ' ').toUpperCase()}</span></p>
                            </div>
                        </div>
                        
                        <!-- Insert existing evaluation form content here -->
                        ${getEvaluationFormContent(employee)}
                        
                        <!-- Navigation -->
                        <div class="navigation">
                            <button class="btn btn-outline" id="prevBtn" onclick="previousStep()" disabled>Previous</button>
                            <div class="step-info" id="stepInfo">Step 1 of 6</div>
                            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Reset to first step
            currentStep = 0;
            updateNavigation();
            updateProgressIndicator();
            
            // Load existing data if available
            loadEmployeeData(employee);
            
            // Initialize AI Writing Coach for all textareas (with delay to ensure DOM is ready)
            setTimeout(() => {
                initializeAIWritingCoach();
            }, 200);
            
            // Setup auto-save after employee data is fully loaded
            setTimeout(setupAutoSave, 500);
        }

        function goToStep(step) {
            // Validate step range
            if (step < 0 || step >= totalSteps) {
                console.error(`Invalid step: ${step}. Valid range is 0 to ${totalSteps - 1}`);
                return;
            }
            
            // Hide all slides
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });

            // Show target slide
            const targetSlide = document.getElementById(`slide-${step}`);
            if (targetSlide) {
                targetSlide.classList.add('active');
            }

            // Update progress steps (both progress-indicator and horizontal navigation)
            document.querySelectorAll('.progress-indicator .step, .step-navigation .step').forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                if (index === step) {
                    stepEl.classList.add('active');
                } else if (index < step) {
                    stepEl.classList.add('completed');
                }
            });

            // Update current step
            currentStep = step;

            // Auto-generate comprehensive summary when navigating to Step 6 (slide-5, index 5)
            if (step === 5) {
                console.log('Navigating to summary slide - generating comprehensive summary');
                setTimeout(() => {
                    generateComprehensiveSummary();
                }, 200);
            }

            // Update navigation
            updateNavigation();
            
            // Save current progress
            setTimeout(saveEmployeeEvaluation, 100);
        }

        function previousStep() {
            if (currentStep > 0) {
                goToStep(currentStep - 1);
            }
        }

        function nextStep() {
            if (currentStep < totalSteps - 1) {
                goToStep(currentStep + 1);
            } else {
                // Complete evaluation - only way to set status to 'completed'
                const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
                if (employee) {
                    saveEmployeeEvaluation();
                    employee.status = 'completed';
                    employee.statusChangeReason = 'Evaluation completed by reviewer';
                    employee.completedDate = new Date().toISOString();
                    saveReviewerData();
                    updateStatusDisplay();
                }
                console.log('Evaluation completed! Returning to dashboard.');
                // Small delay to ensure status display updates before returning to dashboard
                setTimeout(() => {
                    loadReviewerDashboard();
                }, 100);
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const stepInfo = document.getElementById('stepInfo');

            if (prevBtn) prevBtn.disabled = (currentStep === 0);
            if (nextBtn) nextBtn.textContent = (currentStep === totalSteps - 1) ? 'Complete Evaluation' : 'Next';
            if (stepInfo) stepInfo.textContent = `Step ${currentStep + 1} of ${totalSteps}`;
        }

        function completeEvaluationFromSidebar() {
            // Validate that evaluation can be completed
            if (!currentEmployee || !reviewerData[currentReviewer]?.employees[currentEmployee]) {
                alert('No employee evaluation is currently loaded.');
                return;
            }

            const employee = reviewerData[currentReviewer].employees[currentEmployee];
            
            // Check if already completed
            if (employee.status === 'completed') {
                if (confirm('This evaluation is already completed. Do you want to return to the dashboard?')) {
                    loadReviewerDashboard();
                }
                return;
            }
            
            // Check if evaluation has required data (at minimum a rating should be selected)
            const evaluationData = employee.evaluationData || {};
            if (!evaluationData.overallRating) {
                const confirmMessage = `No overall rating has been selected for ${employee.name}.\n\nAre you sure you want to complete this evaluation without a rating?`;
                if (!confirm(confirmMessage)) {
                    return;
                }
            }

            // Confirm completion
            const stepText = currentStep < totalSteps - 1 ? ` (currently on step ${currentStep + 1} of ${totalSteps})` : '';
            const confirmCompleteMessage = `Complete evaluation for ${employee.name}${stepText}?\n\nThis will mark the evaluation as finished and return you to the dashboard.`;
            
            if (!confirm(confirmCompleteMessage)) {
                return;
            }

            // Complete the evaluation - same logic as nextStep() when on final step
            saveEmployeeEvaluation();
            employee.status = 'completed';
            employee.statusChangeReason = 'Evaluation completed by reviewer via sidebar';
            employee.completedDate = new Date().toISOString();
            saveReviewerData();
            updateStatusDisplay();

            console.log('Evaluation completed via sidebar! Returning to dashboard.');
            // Small delay to ensure status display updates before returning to dashboard
            setTimeout(() => {
                loadReviewerDashboard();
            }, 100);
        }

        function selectRating(element, rating) {
            // Remove selected class from all rating buttons
            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked button
            element.classList.add('selected');
            
            // Save the selection
            setTimeout(saveEmployeeEvaluation, 100);
        }

        function addSuggestion(fieldId, text) {
            const textarea = document.getElementById(fieldId);
            if (textarea) {
                if (textarea.value.trim()) {
                    textarea.value += ' ' + text;
                } else {
                    textarea.value = text;
                }
                textarea.focus();
                
                // Trigger analysis and auto-save
                analyzeFeedback(fieldId);
                setTimeout(saveEmployeeEvaluation, 500);
            }
        }

        function saveReviewerData() {
            localStorage.setItem('talentEvaluationData', JSON.stringify(reviewerData));
        }

        function saveEmployeeEvaluation() {
            // Don't save while loading employee data
            if (window.loadingEmployeeData) return;
            
            if (!currentReviewer || !currentEmployee) return;
            
            const employee = reviewerData[currentReviewer].employees[currentEmployee];
            if (!employee) return;
            
            const previousStatus = employee.status;
            const previousData = employee.evaluationData || {};
            
            // Save current form data - manager name is always from logged-in user
            const evaluationData = {
                employeeName: document.getElementById('employeeName')?.value || employee.name,
                reviewerName: reviewerData[currentReviewer].name, // Always use logged-in manager name
                reviewPeriod: document.getElementById('reviewPeriod')?.value || 'FY26',
                overallRating: document.querySelector('.rating-btn.selected')?.getAttribute('data-rating') || 'successful',
                keyPriorities: document.getElementById('keyPriorities')?.value || '',
                collaboration: document.getElementById('collaboration')?.value || '',
                growth: document.getElementById('growth')?.value || '',
                lookingAhead: document.getElementById('lookingAhead')?.value || ''
            };
            
            // Check if data has changed from previously completed evaluation
            const dataChanged = previousStatus === 'completed' && (
                previousData.employeeName !== evaluationData.employeeName ||
                previousData.reviewPeriod !== evaluationData.reviewPeriod ||
                previousData.overallRating !== evaluationData.overallRating ||
                previousData.keyPriorities !== evaluationData.keyPriorities ||
                previousData.collaboration !== evaluationData.collaboration ||
                previousData.growth !== evaluationData.growth ||
                previousData.lookingAhead !== evaluationData.lookingAhead
            );
            
            // Update employee data
            employee.evaluationData = evaluationData;
            employee.lastUpdated = new Date().toISOString();
            
            // Update status based on completion and changes
            const completedFields = Object.values(evaluationData).filter(val => val && val.trim()).length;
            
            if (dataChanged) {
                // If completed evaluation was modified, change to in-progress
                employee.status = 'in-progress';
                employee.statusChangeReason = 'Modified after completion';
            } else if (employee.status !== 'completed' && completedFields > 2) {
                // Only auto-set to in-progress, never auto-complete
                employee.status = 'in-progress';
            }
            // Note: Status only goes to 'completed' via Complete Evaluation button
            
            saveReviewerData();
            
            // Update status display in the evaluation form header
            updateStatusDisplay();
            
            // Auto-regenerate comprehensive summary if on that step (step 5 = slide-5 = 6th slide)
            if (currentStep === 5) {
                console.log('Data changed while on summary slide - regenerating summary');
                setTimeout(() => {
                    generateComprehensiveSummary();
                }, 200);
            }
        }

        function updateStatusDisplay() {
            const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
            if (!employee) return;

            // Update the status indicator in the evaluation form header
            const statusElement = document.querySelector('.employee-info p span[class^="status-"]');
            if (statusElement) {
                // Remove old status class
                statusElement.className = statusElement.className.replace(/status-\S+/g, '');
                // Add new status class
                statusElement.classList.add(`status-${employee.status}`);
                // Update status text
                statusElement.textContent = employee.status.replace('-', ' ').toUpperCase();
            }

            // Also update the sidebar employee list status (for when returning to dashboard)
            updateSidebarEmployeeStatus(employee);
        }

        function updateSidebarEmployeeStatus(employee) {
            // This will update the status when the user returns to the dashboard
            // The actual visual update happens when loadReviewerDashboard() is called
            // But we can also update it immediately if the sidebar exists
            
            const employeeItems = document.querySelectorAll('.employee-item');
            employeeItems.forEach(item => {
                if (item.getAttribute('onclick')?.includes(currentEmployee)) {
                    // Update the status class on the employee item
                    item.className = `employee-item ${employee.status}`;
                    
                    // Update the status text and icon
                    const statusElement = item.querySelector('.employee-status');
                    if (statusElement) {
                        statusElement.className = `employee-status status-${employee.status}`;
                        statusElement.textContent = employee.status === 'completed' ? '✓ Complete' : 
                                                 employee.status === 'in-progress' ? '⏱ In Progress' : '○ Not Started';
                    }
                }
            });
        }

        function logoutReviewer() {
            currentReviewer = null;
            currentEmployee = null;
            
            // Remove reviewer param from URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('reviewer');
            window.history.pushState({}, '', newUrl);
            
            showReviewerLogin();
        }

        function getEvaluationFormContent(employee) {
            const evalData = employee.evaluationData || {};
            
            return `
                <!-- Step 0: Basic Information -->
                <div class="slide active" id="slide-0">
                    <p class="description">Enter basic information and select the overall performance rating</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="employeeName">Employee Name:</label>
                            <input type="text" id="employeeName" placeholder="Enter employee name" value="${evalData.employeeName || employee.name}">
                        </div>
                        <div class="form-group">
                            <label for="reviewerName">Manager Name: <small style="color: #28a745; font-weight: normal;">(Auto-populated)</small></label>
                            <input type="text" id="reviewerName" placeholder="Enter manager name" value="${reviewerData[currentReviewer].name}" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="reviewPeriod">Fiscal Year:</label>
                        <select id="reviewPeriod">
                            <option value="FY26" ${evalData.reviewPeriod === 'FY26' ? 'selected' : ''}>FY26</option>
                            <option value="FY25" ${evalData.reviewPeriod === 'FY25' ? 'selected' : ''}>FY25</option>
                            <option value="FY24" ${evalData.reviewPeriod === 'FY24' ? 'selected' : ''}>FY24</option>
                            <option value="FY23" ${evalData.reviewPeriod === 'FY23' ? 'selected' : ''}>FY23</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Overall Performance Rating:</label>
                        <div class="rating-buttons">
                            <div class="rating-btn ${evalData.overallRating === 'exemplary' ? 'selected' : ''}" onclick="selectRating(this, 'exemplary')" data-rating="exemplary">
                                <strong>Exemplary</strong>
                                <small>Performance consistently exceeds the requirements of the role</small>
                            </div>
                            <div class="rating-btn ${evalData.overallRating === 'successful' || !evalData.overallRating ? 'selected' : ''}" onclick="selectRating(this, 'successful')" data-rating="successful">
                                <strong>Successful</strong>
                                <small>Performance consistently meets the requirements of the role</small>
                            </div>
                            <div class="rating-btn ${evalData.overallRating === 'opportunity' ? 'selected' : ''}" onclick="selectRating(this, 'opportunity')" data-rating="opportunity">
                                <strong>Opportunity</strong>
                                <small>Performance consistently failed to meet the requirements of the role</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Key Priorities -->
                <div class="slide" id="slide-1">
                    <p class="description">What were the associate's primary goals this year, and what two or three specific results did they deliver that show measurable progress against those goals and clear impact on business outcomes?</p>

                    <div class="suggestions">
                        <h4>Smart Content Suggestions</h4>
                        <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Primary goals included [specific goal], achieving [X% increase/improvement] in [metric] which directly contributed to [business outcome]...')">
                            "Primary goals included [specific goal], achieving [X% increase/improvement] in [metric] which directly contributed to [business outcome]..."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Delivered measurable results: [Result 1] resulted in $X revenue/cost savings, [Result 2] improved [process/metric] by X%, and [Result 3] enhanced [business area] leading to...')">
                            "Delivered measurable results: [Result 1] resulted in $X revenue/cost savings, [Result 2] improved [process/metric] by X%, and [Result 3] enhanced [business area] leading to..."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('keyPriorities', 'Key accomplishments with quantifiable impact: Successfully [action] resulting in [specific metric improvement], completed [project] ahead of schedule generating [business value], and achieved [goal] with [measurable outcome]...')">
                            "Key accomplishments with quantifiable impact: Successfully [action] resulting in [specific metric improvement], completed [project] ahead of schedule generating [business value], and achieved [goal] with [measurable outcome]..."
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="keyPriorities">Feedback:</label>
                        <textarea id="keyPriorities" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('keyPriorities')">Primary goals this year were: (1) Increase member acquisition by 12%, (2) Launch digital rewards program, and (3) Improve customer satisfaction scores above 4.2. Delivered measurable results: (1) Achieved 15.3% member acquisition growth through targeted social campaigns, exceeding goal by 28%, (2) Successfully launched rewards program with 89% member adoption in first month, generating $1.8M incremental revenue, (3) Improved satisfaction scores from 3.9 to 4.4 through personalized communication strategy, representing 12.8% improvement and clear business impact on retention metrics.</textarea>
                    </div>

                    <!-- AI Writing Coach -->
                    <div class="writing-coach" id="coach-keyPriorities" style="display: none;">
                        <div class="coach-header">
                            <span style="font-size: 20px;">🤖</span>
                            <h4>AI Writing Coach</h4>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric" id="objectivity-keyPriorities">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Objectivity</div>
                            </div>
                            <div class="metric" id="specificity-keyPriorities">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Specificity</div>
                            </div>
                            <div class="metric" id="completeness-keyPriorities">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Completeness</div>
                            </div>
                        </div>
                        <div class="bias-alerts" id="alerts-keyPriorities"></div>
                    </div>
                </div>

                <!-- Step 2: Collaboration -->
                <div class="slide" id="slide-2">
                    <p class="description">What two or three specific ways did the associate partner across teams to deliver results this year, and where could their partnership and collaboration have been stronger?</p>

                    <div class="suggestions">
                        <h4>Smart Content Suggestions</h4>
                        <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Three specific partnership examples: (1) Collaborated with [team] to deliver [outcome], (2) Partnered with [department] resulting in [specific result], (3) Worked cross-functionally with [teams] achieving [measurable impact]. Areas for growth: Could strengthen collaboration by...')">
                            "Three specific partnership examples: (1) Collaborated with [team] to deliver [outcome], (2) Partnered with [department] resulting in [specific result], (3) Worked cross-functionally with [teams] achieving [measurable impact]. Areas for growth: Could strengthen collaboration by..."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Key partnerships this year included: [specific example 1 with outcome], [specific example 2 with result], and [specific example 3 with impact]. Going forward, partnership effectiveness could improve through...')">
                            "Key partnerships this year included: [specific example 1 with outcome], [specific example 2 with result], and [specific example 3 with impact]. Going forward, partnership effectiveness could improve through..."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('collaboration', 'Successfully partnered across teams by: [specific way 1], [specific way 2], and [specific way 3], each delivering [measurable results]. Opportunities for stronger collaboration exist in...')">
                            "Successfully partnered across teams by: [specific way 1], [specific way 2], and [specific way 3], each delivering [measurable results]. Opportunities for stronger collaboration exist in..."
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="collaboration">Feedback:</label>
                        <textarea id="collaboration" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('collaboration')">Three specific partnership examples: (1) Collaborated with IT and Operations teams to deliver rewards program launch, resulting in zero technical issues and 48-hour faster deployment than planned, (2) Partnered with Finance department on budget optimization, achieving 18% cost reduction while maintaining campaign quality, (3) Worked cross-functionally with Customer Service and Analytics teams on satisfaction initiative, achieving unified data tracking and 22% faster issue resolution. Areas for growth: Could strengthen collaboration by proactively engaging stakeholders earlier in planning phases and providing more detailed project timelines to partners.</textarea>
                    </div>

                    <!-- AI Writing Coach -->
                    <div class="writing-coach" id="coach-collaboration" style="display: none;">
                        <div class="coach-header">
                            <span style="font-size: 20px;">🤖</span>
                            <h4>AI Writing Coach</h4>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric" id="objectivity-collaboration">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Objectivity</div>
                            </div>
                            <div class="metric" id="specificity-collaboration">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Specificity</div>
                            </div>
                            <div class="metric" id="completeness-collaboration">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Completeness</div>
                            </div>
                        </div>
                        <div class="bias-alerts" id="alerts-collaboration"></div>
                    </div>
                </div>

                <!-- Step 3: Growth & Development -->
                <div class="slide" id="slide-3">
                    <p class="description">What are the two or three most critical development areas for the associate next year, and what targeted experiences such as training, expanded scope, new responsibilities, or stretch work would best accelerate their growth?</p>

                    <div class="suggestions">
                        <h4>Smart Content Suggestions</h4>
                        <div class="suggestion-item" onclick="addSuggestion('growth', 'Critical development priorities: (1) [Skill/area] - recommend [specific training/experience], (2) [Leadership capability] - suggest [stretch assignment/expanded scope], (3) [Technical/functional area] - propose [new responsibility/project]. These targeted experiences would accelerate growth by...')">
                            "Critical development priorities: (1) [Skill/area] - recommend [specific training/experience], (2) [Leadership capability] - suggest [stretch assignment/expanded scope], (3) [Technical/functional area] - propose [new responsibility/project]. These targeted experiences would accelerate growth by..."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('growth', 'Key growth areas for next year: [development area 1], [development area 2], and [development area 3]. Recommended development approaches include: [specific training program], [expanded role/scope opportunity], and [stretch project/new responsibility] to build these capabilities.')">
                            "Key growth areas for next year: [development area 1], [development area 2], and [development area 3]. Recommended development approaches include: [specific training program], [expanded role/scope opportunity], and [stretch project/new responsibility] to build these capabilities."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('growth', 'Priority development focus: [area 1] through [targeted experience], [area 2] via [specific opportunity], [area 3] using [stretch assignment]. These development experiences align with career progression and would strengthen [specific outcomes/capabilities].')">
                            "Priority development focus: [area 1] through [targeted experience], [area 2] via [specific opportunity], [area 3] using [stretch assignment]. These development experiences align with career progression and would strengthen [specific outcomes/capabilities]."
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="growth">Feedback:</label>
                        <textarea id="growth" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('growth')">Critical development priorities: (1) Strategic thinking skills - recommend executive leadership program and rotation through corporate strategy team, (2) Advanced analytics capabilities - suggest enrollment in data science certification and partnership with Analytics CoE on major project, (3) Change management expertise - propose leading digital transformation initiative for assigned market. These targeted experiences would accelerate growth by building enterprise-level perspective, quantitative decision-making skills, and ability to drive organization-wide initiatives essential for senior marketing roles.</textarea>
                    </div>

                    <!-- AI Writing Coach -->
                    <div class="writing-coach" id="coach-growth" style="display: none;">
                        <div class="coach-header">
                            <span style="font-size: 20px;">🤖</span>
                            <h4>AI Writing Coach</h4>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric" id="objectivity-growth">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Objectivity</div>
                            </div>
                            <div class="metric" id="specificity-growth">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Specificity</div>
                            </div>
                            <div class="metric" id="completeness-growth">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Completeness</div>
                            </div>
                        </div>
                        <div class="bias-alerts" id="alerts-growth"></div>
                    </div>
                </div>

                <!-- Step 4: Looking Ahead -->
                <div class="slide" id="slide-4">
                    <p class="description">Compared to others at this level, what clearly differentiates this associate, what assumptions influenced your rating, and what measurable progress do you expect to see in the next six months along with the specific actions you will take to support their development?</p>

                    <div class="suggestions">
                        <h4>Smart Content Suggestions</h4>
                        <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Differentiation: Compared to peers, [associate name] stands out in [specific areas]. Rating assumptions: Based on [evidence/observations]. Expected progress (6 months): [measurable goal 1], [measurable goal 2]. My support actions: [specific action 1], [specific action 2], [specific action 3].')">
                            "Differentiation: Compared to peers, [associate name] stands out in [specific areas]. Rating assumptions: Based on [evidence/observations]. Expected progress (6 months): [measurable goal 1], [measurable goal 2]. My support actions: [specific action 1], [specific action 2], [specific action 3]."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Peer comparison: [Associate name] differentiates through [unique strengths/capabilities]. Rating rationale: [key assumptions and evidence]. 6-month expectations: Achieve [specific metric/outcome], demonstrate [observable behavior], complete [measurable milestone]. Manager commitment: I will [support action], provide [resource/opportunity], and [developmental intervention].')">
                            "Peer comparison: [Associate name] differentiates through [unique strengths/capabilities]. Rating rationale: [key assumptions and evidence]. 6-month expectations: Achieve [specific metric/outcome], demonstrate [observable behavior], complete [measurable milestone]. Manager commitment: I will [support action], provide [resource/opportunity], and [developmental intervention]."
                        </div>
                        <div class="suggestion-item" onclick="addSuggestion('lookingAhead', 'Distinguishing factors: [Associate] excels beyond peer level in [area 1] and [area 2] due to [evidence]. Rating influenced by [assumptions/observations]. Measurable 6-month targets: [quantifiable goal], [behavioral indicator], [milestone achievement]. Development support plan: [manager action 1], [resource provision], [coaching/feedback commitment].')">
                            "Distinguishing factors: [Associate] excels beyond peer level in [area 1] and [area 2] due to [evidence]. Rating influenced by [assumptions/observations]. Measurable 6-month targets: [quantifiable goal], [behavioral indicator], [milestone achievement]. Development support plan: [manager action 1], [resource provision], [coaching/feedback commitment]."
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="lookingAhead">Feedback:</label>
                        <textarea id="lookingAhead" rows="6" placeholder="Provide specific, objective feedback with examples and measurable outcomes..." onkeyup="analyzeFeedback('lookingAhead')">Differentiation: Compared to peers, Sarah consistently delivers above-target results with measurable business impact while building strong cross-functional partnerships. Rating assumptions: Based on 15.3% acquisition growth (vs 8% peer average), successful program launch with zero issues, and proactive stakeholder collaboration evidenced in 360 feedback. Expected progress (6 months): Achieve 95% completion of leadership program modules, complete analytics certification with capstone project, and successfully lead Q1 digital transformation pilot with measurable adoption metrics. My support actions: Provide monthly coaching sessions on strategic thinking, secure budget for external training programs, assign high-visibility transformation project, and facilitate quarterly skip-level meetings with VP Marketing for exposure and feedback.</textarea>
                    </div>

                    <!-- AI Writing Coach -->
                    <div class="writing-coach" id="coach-lookingAhead" style="display: none;">
                        <div class="coach-header">
                            <span style="font-size: 20px;">🤖</span>
                            <h4>AI Writing Coach</h4>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric" id="objectivity-lookingAhead">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Objectivity</div>
                            </div>
                            <div class="metric" id="specificity-lookingAhead">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Specificity</div>
                            </div>
                            <div class="metric" id="completeness-lookingAhead">
                                <span class="metric-value">0%</span>
                                <div class="metric-label">Completeness</div>
                            </div>
                        </div>
                        <div class="bias-alerts" id="alerts-lookingAhead"></div>
                    </div>
                </div>

                <!-- Step 5: Comprehensive Summary -->
                <div class="slide" id="slide-5">
                    <p class="description">Auto-generated comprehensive narrative for calibration meetings and performance discussions</p>

                    <div class="summary-container">
                        <div class="form-group">
                            <label for="comprehensiveSummary">Performance Summary for Calibration:</label>
                            <textarea id="comprehensiveSummary" rows="15" placeholder="Summary will be automatically generated when you navigate to this step..." readonly class="summary-textarea"></textarea>
                        </div>

                        <div class="summary-actions-simple">
                            <button class="btn btn-primary" onclick="copySummaryToClipboard()">Copy to Clipboard</button>
                            <button class="btn btn-outline" onclick="downloadSummaryAsPDF()">Download PDF</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadEmployeeData(employee) {
            const evalData = employee.evaluationData || {};
            
            // Temporarily disable auto-advancement while loading
            window.loadingEmployeeData = true;
            autoAdvancementInProgress = false; // Reset auto-advancement flag
            
            // Populate form fields with employee's actual data
            setTimeout(() => {
                // Basic Information
                const employeeNameField = document.getElementById('employeeName');
                const reviewerNameField = document.getElementById('reviewerName');
                const reviewPeriodField = document.getElementById('reviewPeriod');
                const overallRatingField = document.getElementById('overallRating');
                
                if (employeeNameField) {
                    employeeNameField.value = evalData.employeeName || employee.name || '';
                }
                if (reviewerNameField) {
                    reviewerNameField.value = evalData.reviewerName || currentReviewer || '';
                }
                if (reviewPeriodField) {
                    reviewPeriodField.value = evalData.reviewPeriod || '';
                }
                if (overallRatingField) {
                    overallRatingField.value = evalData.overallRating || '';
                }
                
                // Text areas
                const textFields = ['keyPriorities', 'collaboration', 'growth', 'lookingAhead'];
                textFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = evalData[fieldId] || '';
                        // Trigger analysis for existing content
                        if (field.value.trim()) {
                            analyzeFeedback(fieldId);
                        }
                    }
                });
                
                // Re-enable auto-advancement after loading is complete
                setTimeout(() => {
                    window.loadingEmployeeData = false;
                    console.log('Employee data loading complete - auto-advancement re-enabled');
                    
                    // Initialize undo/redo for text fields
                    if (typeof setupUndoRedoForTextFields !== 'undefined') {
                        setupUndoRedoForTextFields();
                    }
                }, 800);
            }, 100);
        }

        function addNewEmployee() {
            const employeeName = prompt('Enter employee name:');
            const employeePosition = prompt('Enter employee position:');
            
            if (!employeeName || !employeePosition) {
                alert('Please provide both name and position');
                return;
            }
            
            const employeeId = 'emp' + Date.now();
            const newEmployee = {
                id: employeeId,
                name: employeeName.trim(),
                position: employeePosition.trim(),
                status: 'not-started',
                evaluationData: {},
                lastUpdated: new Date().toISOString()
            };
            
            reviewerData[currentReviewer].employees[employeeId] = newEmployee;
            saveReviewerData();
            
            // Refresh the dashboard
            loadReviewerDashboard();
        }

        function deleteEmployee(employeeId, event) {
            // Stop event propagation to prevent starting evaluation
            event.stopPropagation();
            
            const employee = reviewerData[currentReviewer]?.employees[employeeId];
            if (!employee) return;
            
            // Confirm deletion
            const confirmDelete = confirm(
                `Are you sure you want to remove ${employee.name} from your team?\n\n` +
                `This will permanently delete their evaluation data and cannot be undone.`
            );
            
            if (!confirmDelete) return;
            
            // Delete the employee
            delete reviewerData[currentReviewer].employees[employeeId];
            saveReviewerData();
            
            // If we're currently editing this employee, return to dashboard
            if (currentEmployee === employeeId) {
                currentEmployee = null;
                loadReviewerDashboard();
                return;
            }
            
            // Refresh the dashboard to show updated list
            loadReviewerDashboard();
        }

        function archiveEmployee(employeeId, event) {
            // Stop event propagation to prevent starting evaluation
            event.stopPropagation();
            
            const employee = reviewerData[currentReviewer]?.employees[employeeId];
            if (!employee) return;
            
            // Confirm archiving
            const confirmArchive = confirm(
                `Archive ${employee.name}?\n\n` +
                `This will move them to archived team members. Their evaluation data will be preserved and they can be restored later if needed.`
            );
            
            if (!confirmArchive) return;
            
            // Archive the employee
            employee.archived = true;
            employee.archivedDate = new Date().toISOString();
            saveReviewerData();
            
            // If we're currently editing this employee, return to dashboard
            if (currentEmployee === employeeId) {
                currentEmployee = null;
                loadReviewerDashboard();
                return;
            }
            
            // Refresh the dashboard to show updated list
            loadReviewerDashboard();
        }

        function restoreEmployee(employeeId, event) {
            // Stop event propagation to prevent starting evaluation
            event.stopPropagation();
            
            const employee = reviewerData[currentReviewer]?.employees[employeeId];
            if (!employee) return;
            
            // Confirm restoration
            const confirmRestore = confirm(
                `Restore ${employee.name} to your active team?`
            );
            
            if (!confirmRestore) return;
            
            // Restore the employee
            delete employee.archived;
            delete employee.archivedDate;
            saveReviewerData();
            
            // Refresh the dashboard to show updated list
            loadReviewerDashboard();
        }



        // Undo/Redo Functionality
        let actionHistory = [];
        let historyIndex = -1;
        const MAX_HISTORY_SIZE = 50;

        function recordAction(action) {
            // Remove any actions after current index (when user has undone some actions)
            actionHistory = actionHistory.slice(0, historyIndex + 1);
            
            // Add new action
            actionHistory.push({
                ...action,
                timestamp: Date.now()
            });
            
            // Limit history size
            if (actionHistory.length > MAX_HISTORY_SIZE) {
                actionHistory = actionHistory.slice(-MAX_HISTORY_SIZE);
            }
            
            historyIndex = actionHistory.length - 1;
            updateUndoRedoUI();
        }

        function undo() {
            if (historyIndex >= 0) {
                const action = actionHistory[historyIndex];
                executeUndoAction(action);
                historyIndex--;
                updateUndoRedoUI();
            }
        }

        function redo() {
            if (historyIndex < actionHistory.length - 1) {
                historyIndex++;
                const action = actionHistory[historyIndex];
                executeRedoAction(action);
                updateUndoRedoUI();
            }
        }

        function executeUndoAction(action) {
            const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
            if (!employee) return;
            
            switch(action.type) {
                case 'text_change':
                    const field = document.getElementById(action.fieldId);
                    if (field) {
                        field.value = action.oldValue;
                        // Re-trigger analysis if we're in evaluation mode
                        if (typeof analyzeFeedback === 'function') {
                            analyzeFeedback(action.fieldId);
                        }
                    }
                    // Update stored data
                    if (employee.evaluationData) {
                        employee.evaluationData[action.fieldId] = action.oldValue;
                    }
                    break;
                    
                case 'rating_change':
                    const ratingBtns = document.querySelectorAll('.rating-btn');
                    ratingBtns.forEach(btn => {
                        btn.classList.remove('selected');
                        if (btn.dataset.rating === action.oldRating) {
                            btn.classList.add('selected');
                        }
                    });
                    if (employee.evaluationData) {
                        employee.evaluationData.overallRating = action.oldRating;
                    }
                    break;
                    
                case 'step_navigation':
                    goToStep(action.oldStep);
                    break;
            }
            
            // Auto-save the changes
            setTimeout(saveEmployeeEvaluation, 100);
        }

        function executeRedoAction(action) {
            const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
            if (!employee) return;
            
            switch(action.type) {
                case 'text_change':
                    const field = document.getElementById(action.fieldId);
                    if (field) {
                        field.value = action.newValue;
                        if (typeof analyzeFeedback === 'function') {
                            analyzeFeedback(action.fieldId);
                        }
                    }
                    if (employee.evaluationData) {
                        employee.evaluationData[action.fieldId] = action.newValue;
                    }
                    break;
                    
                case 'rating_change':
                    const ratingBtns = document.querySelectorAll('.rating-btn');
                    ratingBtns.forEach(btn => {
                        btn.classList.remove('selected');
                        if (btn.dataset.rating === action.newRating) {
                            btn.classList.add('selected');
                        }
                    });
                    if (employee.evaluationData) {
                        employee.evaluationData.overallRating = action.newRating;
                    }
                    break;
                    
                case 'step_navigation':
                    goToStep(action.newStep);
                    break;
            }
            
            // Auto-save the changes
            setTimeout(saveEmployeeEvaluation, 100);
        }

        function updateUndoRedoUI() {
            // Update undo button if it exists
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            
            if (undoBtn) {
                undoBtn.disabled = historyIndex < 0;
                undoBtn.title = historyIndex >= 0 ? 
                    `Undo: ${actionHistory[historyIndex]?.description || 'Last action'}` : 
                    'Nothing to undo';
            }
            
            if (redoBtn) {
                redoBtn.disabled = historyIndex >= actionHistory.length - 1;
                redoBtn.title = historyIndex < actionHistory.length - 1 ? 
                    `Redo: ${actionHistory[historyIndex + 1]?.description || 'Next action'}` : 
                    'Nothing to redo';
            }
        }



        // Enhanced text change tracking for undo/redo
        function setupUndoRedoForTextFields() {
            const textFields = document.querySelectorAll('input, textarea, select');
            
            textFields.forEach(field => {
                let oldValue = field.value;
                let changeTimeout;
                
                // Track changes with debouncing
                field.addEventListener('input', function(event) {
                    const newValue = field.value;
                    
                    // Clear previous timeout
                    clearTimeout(changeTimeout);
                    
                    // Set new timeout to record action after user stops typing
                    changeTimeout = setTimeout(() => {
                        if (oldValue !== newValue) {
                            recordAction({
                                type: 'text_change',
                                fieldId: field.id,
                                oldValue: oldValue,
                                newValue: newValue,
                                description: `Edit ${field.labels?.[0]?.textContent || field.id || 'field'}`
                            });
                            oldValue = newValue;
                        }
                    }, 1000); // 1 second delay after user stops typing
                });
                
                // Also record on blur (when user leaves the field)
                field.addEventListener('blur', function() {
                    clearTimeout(changeTimeout);
                    const newValue = field.value;
                    if (oldValue !== newValue) {
                        recordAction({
                            type: 'text_change',
                            fieldId: field.id,
                            oldValue: oldValue,
                            newValue: newValue,
                            description: `Edit ${field.labels?.[0]?.textContent || field.id || 'field'}`
                        });
                        oldValue = newValue;
                    }
                });
            });
        }



        // Dropdown-related functions (using new searchable dropdown)
        
        function handleEmployeeSelectionOld(employeeId) {
            selectedEmployeeId = employeeId;
            const actionsPanel = document.getElementById('employee-actions-panel');
            
            if (employeeId) {
                const employee = reviewerData[currentReviewer]?.employees[employeeId];
                if (employee) {
                    actionsPanel.style.display = 'block';
                    
                    // Update download functionality based on employee data
                    const hasEvalData = employee.evaluationData && Object.keys(employee.evaluationData).length > 0;
                    const downloadBtn = actionsPanel.querySelector('.smart-action-item:nth-child(2)'); // Download PDF item
                    if (downloadBtn) {
                        downloadBtn.style.opacity = hasEvalData ? '1' : '0.5';
                        downloadBtn.style.pointerEvents = hasEvalData ? 'auto' : 'none';
                    }
                }
            } else {
                actionsPanel.style.display = 'none';
            }
        }

        function startSelectedEmployeeEvaluation() {
            if (selectedEmployeeId) {
                startEvaluation(selectedEmployeeId);
            }
        }

        // Search Functions
        function filterEmployees() {
            const searchInput = document.getElementById('employeeSearch');
            const searchTerm = searchInput?.value.toLowerCase() || '';
            const dropdown = document.getElementById('employeeDropdown');
            const clearBtn = document.querySelector('.clear-search');
            
            if (!dropdown) return;
            
            // Show/hide clear button
            if (clearBtn) {
                clearBtn.style.display = searchTerm ? 'flex' : 'none';
            }
            
            const options = dropdown.querySelectorAll('option');
            let visibleCount = 0;
            
            options.forEach((option, index) => {
                if (index === 0) { // Skip the placeholder option
                    option.style.display = 'block';
                    return;
                }
                
                const name = option.getAttribute('data-name') || '';
                const matchesSearch = !searchTerm || name.includes(searchTerm);
                
                option.style.display = matchesSearch ? 'block' : 'none';
                if (matchesSearch) visibleCount++;
            });

            // Update the first option to show count only if searching
            if (options[0]) {
                if (searchTerm) {
                    options[0].textContent = visibleCount > 0 ? `Select an employee... (${visibleCount} found)` : 'No employees found';
                } else {
                    options[0].textContent = 'Select an employee...';
                }
            }
        }

        function clearSearch() {
            const searchInput = document.getElementById('employeeSearch');
            if (searchInput) {
                searchInput.value = '';
                filterEmployees();
                searchInput.focus();
            }
        }







        function downloadSelectedEmployeePDF() {
            if (selectedEmployeeId) {
                const employee = reviewerData[currentReviewer]?.employees[selectedEmployeeId];
                if (employee && employee.evaluationData && Object.keys(employee.evaluationData).length > 0) {
                    downloadIndividualEvaluationPDF(selectedEmployeeId);
                }
            }
        }

        function archiveSelectedEmployee() {
            if (selectedEmployeeId) {
                archiveEmployee(selectedEmployeeId, { stopPropagation: () => {} });
                selectedEmployeeId = null;
                document.getElementById('employee-actions-panel').style.display = 'none';
                document.querySelector('.employee-dropdown').value = '';
            }
        }

        function deleteSelectedEmployee() {
            if (selectedEmployeeId) {
                deleteEmployee(selectedEmployeeId, { stopPropagation: () => {} });
                selectedEmployeeId = null;
                document.getElementById('employee-actions-panel').style.display = 'none';
                document.querySelector('.employee-dropdown').value = '';
            }
        }

        function toggleArchivedEmployees() {
            const archivedList = document.getElementById('archived-list');
            const toggle = document.getElementById('archived-toggle');
            
            if (archivedList.style.display === 'none') {
                archivedList.style.display = 'block';
                toggle.innerHTML = '<span>▲ Hide Archived</span>';
            } else {
                archivedList.style.display = 'none';
                toggle.innerHTML = '<span>▼ Show Archived</span>';
            }
        }

        function viewTeamReport() {
            const reviewer = reviewerData[currentReviewer];
            const employees = Object.values(reviewer.employees || {});
            const activeEmployees = employees.filter(emp => !emp.archived);
            
            if (activeEmployees.length === 0) {
                alert('No active employees to report on.');
                return;
            }
            
            // Calculate analytics
            const totalEmployees = activeEmployees.length;
            const completedEvaluations = activeEmployees.filter(emp => emp.status === 'completed').length;
            const inProgressEvaluations = activeEmployees.filter(emp => emp.status === 'in-progress').length;
            const notStartedEvaluations = activeEmployees.filter(emp => emp.status === 'not-started').length;
            
            // Rating distribution (only count employees with actual ratings)
            const ratingsCount = { exemplary: 0, successful: 0, opportunity: 0, 'not-set': 0 };
            const employeesWithRatings = activeEmployees.filter(emp => emp.status === 'completed' && emp.evaluationData?.overallRating);
            const employeesWithoutRatings = activeEmployees.filter(emp => !emp.evaluationData?.overallRating || emp.status !== 'completed');
            
            employeesWithRatings.forEach(emp => {
                const rating = emp.evaluationData.overallRating;
                if (ratingsCount[rating] !== undefined) {
                    ratingsCount[rating]++;
                }
            });
            
            // Count employees without ratings separately
            ratingsCount['not-set'] = employeesWithoutRatings.length;
            
            // Recent activity
            const recentActivity = activeEmployees
                .filter(emp => emp.lastUpdated)
                .sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated))
                .slice(0, 10);
            
            const reportHTML = `
                <div class="team-report-overlay" onclick="closeTeamReport(event)">
                    <div class="team-report-modal" onclick="event.stopPropagation()">
                        <div class="report-header">
                            <h2>Team Performance Report</h2>
                            <p>Reviewer: ${reviewer.name} | ${new Date().toLocaleDateString()}</p>
                            <button class="close-btn" onclick="closeTeamReport()">&times;</button>
                        </div>
                        
                        <div class="report-content">
                            <div class="report-section">
                                <h3>Team Overview</h3>
                                <div class="metrics-grid">
                                    <div class="metric-card">
                                        <div class="metric-number">${totalEmployees}</div>
                                        <div class="metric-label">Total Team Members</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-number">${completedEvaluations}</div>
                                        <div class="metric-label">Completed Evaluations</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-number">${inProgressEvaluations}</div>
                                        <div class="metric-label">In Progress</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-number">${notStartedEvaluations}</div>
                                        <div class="metric-label">Not Started</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="report-section">
                                <h3>Overall Rating Distribution</h3>
                                <div class="rating-distribution">
                                    <div class="rating-bar">
                                        <div class="rating-label">Exemplary</div>
                                        <div class="rating-progress">
                                            <div class="rating-fill exemplary" style="width: ${totalEmployees > 0 ? (ratingsCount.exemplary / totalEmployees) * 100 : 0}%"></div>
                                        </div>
                                        <div class="rating-count">${ratingsCount.exemplary}</div>
                                    </div>
                                    <div class="rating-bar">
                                        <div class="rating-label">Successful</div>
                                        <div class="rating-progress">
                                            <div class="rating-fill successful" style="width: ${totalEmployees > 0 ? (ratingsCount.successful / totalEmployees) * 100 : 0}%"></div>
                                        </div>
                                        <div class="rating-count">${ratingsCount.successful}</div>
                                    </div>
                                    <div class="rating-bar">
                                        <div class="rating-label">Opportunity</div>
                                        <div class="rating-progress">
                                            <div class="rating-fill opportunity" style="width: ${totalEmployees > 0 ? (ratingsCount.opportunity / totalEmployees) * 100 : 0}%"></div>
                                        </div>
                                        <div class="rating-count">${ratingsCount.opportunity}</div>
                                    </div>
                                    <div class="rating-bar">
                                        <div class="rating-label">Not Rated</div>
                                        <div class="rating-progress">
                                            <div class="rating-fill not-rated" style="width: ${totalEmployees > 0 ? (ratingsCount['not-set'] / totalEmployees) * 100 : 0}%"></div>
                                        </div>
                                        <div class="rating-count">${ratingsCount['not-set']}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="report-section">
                                <h3>Team Member Status</h3>
                                <div class="employee-status-list">
                                    ${activeEmployees.map(emp => `
                                        <div class="employee-status-item">
                                            <div class="employee-info">
                                                <div class="employee-name">${emp.name}</div>
                                            </div>
                                            <div class="status-info">
                                                <div class="status-badge ${emp.status}">${emp.status.replace('-', ' ').toUpperCase()}</div>
                                                <div class="rating-badge ${emp.evaluationData?.overallRating || 'not-set'}">${emp.evaluationData?.overallRating || 'Not Rated'}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="report-actions">
                                <button class="btn btn-primary" onclick="downloadTeamReport()">Download Report</button>
                                <button class="btn btn-outline" onclick="exportEvaluations()">Export All (PDF)</button>
                                <button class="btn btn-outline" onclick="closeTeamReport()">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', reportHTML);
        }
        
        function closeTeamReport(event) {
            if (event && event.target !== event.currentTarget) return;
            const overlay = document.querySelector('.team-report-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        function downloadTeamReport() {
            const reviewer = reviewerData[currentReviewer];
            const employees = Object.values(reviewer.employees || {}).filter(emp => !emp.archived);
            
            // Create PDF using jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set up the document
            let yPos = 20;
            const pageWidth = doc.internal.pageSize.width;
            const marginX = 20;
            const contentWidth = pageWidth - (marginX * 2);
            
            // Enhanced professional header
            doc.setFillColor(17, 34, 75); // #11224B
            doc.rect(0, 0, pageWidth, 45, 'F');
            
            // Header gradient overlay
            doc.setFillColor(17, 39, 86); // #112756 
            doc.rect(0, 35, pageWidth, 10, 'F');
            
            // Sam's Club branding
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('SAM\'S CLUB', marginX, 15);
            
            // Main title
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('TEAM PERFORMANCE REPORT', marginX, 28);
            
            // Confidential marking
            doc.setFontSize(9);
            doc.setFont(undefined, 'italic');
            doc.text('CONFIDENTIAL - MANAGER USE ONLY', pageWidth - marginX, 15, { align: 'right' });
            
            // Report info section with professional styling
            yPos = 60;
            
            // Info background
            doc.setFillColor(248, 249, 250);
            doc.rect(marginX - 2, yPos - 5, contentWidth + 4, 25, 'F');
            
            doc.setTextColor(17, 34, 75); // Dashboard dark blue
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text(`Reviewer: ${reviewer.name.replace(/[^\x00-\x7F]/g, '')}`, marginX + 2, yPos + 5);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(102, 102, 102);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, marginX + 2, yPos + 15);
            doc.text(`Total Team Members: ${employees.length}`, marginX + 120, yPos + 15);
            yPos += 35;
            
            // Evaluation Status Section
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('EVALUATION STATUS SUMMARY', marginX, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            
            const completedCount = employees.filter(emp => emp.status === 'completed').length;
            const inProgressCount = employees.filter(emp => emp.status === 'in-progress').length;
            const notStartedCount = employees.filter(emp => emp.status === 'not-started').length;
            
            doc.text(`• Completed Evaluations: ${completedCount}`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• In Progress: ${inProgressCount}`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• Not Started: ${notStartedCount}`, marginX + 10, yPos);
            yPos += 15;
            
            // Rating Distribution (only count employees with actual ratings)
            const ratingsCount = { exemplary: 0, successful: 0, opportunity: 0, 'not-rated': 0 };
            const employeesWithRatings = employees.filter(emp => emp.status === 'completed' && emp.evaluationData?.overallRating);
            const employeesWithoutRatings = employees.filter(emp => !emp.evaluationData?.overallRating || emp.status !== 'completed');
            
            employeesWithRatings.forEach(emp => {
                const rating = emp.evaluationData.overallRating;
                if (ratingsCount[rating] !== undefined) {
                    ratingsCount[rating]++;
                }
            });
            
            // Count employees without ratings separately
            ratingsCount['not-rated'] = employeesWithoutRatings.length;
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('PERFORMANCE RATING DISTRIBUTION', marginX, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text(`• Exemplary: ${ratingsCount.exemplary}`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• Successful: ${ratingsCount.successful}`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• Opportunity: ${ratingsCount.opportunity}`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• Not Rated: ${ratingsCount['not-rated']}`, marginX + 10, yPos);
            yPos += 20;
            
            // Calibration Readiness Analysis
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('CALIBRATION READINESS ANALYSIS', marginX, yPos);
            yPos += 10;
            
            // Calculate readiness metrics
            const completedEvals = employees.filter(emp => emp.status === 'completed');
            const detailedEvals = completedEvals.filter(emp => {
                const data = emp.evaluationData;
                return data && data.keyPriorities && data.collaboration && 
                       data.growth && data.lookingAhead &&
                       data.keyPriorities.trim().length > 50 &&
                       data.collaboration.trim().length > 50;
            });
            
            const calibrationReady = detailedEvals.length;
            const needsMoreDetail = completedEvals.length - detailedEvals.length;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text(`• Ready for Calibration: ${calibrationReady} evaluations`, marginX + 10, yPos);
            yPos += 7;
            doc.text(`• Need More Detail: ${needsMoreDetail} evaluations`, marginX + 10, yPos);
            yPos += 7;
            
            // Framework compliance
            const frameworkCompliance = completedEvals.length > 0 ? 
                Math.round((detailedEvals.length / completedEvals.length) * 100) : 0;
            doc.text(`• Framework Compliance: ${frameworkCompliance}%`, marginX + 10, yPos);
            yPos += 15;
            
            // Enhanced evaluation criteria note
            doc.setFontSize(10);
            doc.setFont(undefined, 'italic');
            doc.text('Note: Enhanced evaluation framework includes detailed assessment of Key Priorities,', marginX, yPos);
            yPos += 5;
            doc.text('Results & Impact, Collaboration & Influence, Growth & Development, and Looking Ahead.', marginX, yPos);
            yPos += 15;
            
            // Team Members Table
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('TEAM MEMBERS DETAILS', marginX, yPos);
            yPos += 10;
            
            // Table header
            doc.setFillColor(240, 240, 240);
            doc.rect(marginX, yPos - 5, contentWidth, 12, 'F');
            
            doc.setFontSize(9);
            doc.setFont(undefined, 'bold');
            doc.text('Name', marginX + 3, yPos + 3);
            doc.text('Position', marginX + 50, yPos + 3);
            doc.text('Status', marginX + 100, yPos + 3);
            doc.text('Rating', marginX + 130, yPos + 3);
            doc.text('Cal. Ready', marginX + 160, yPos + 3);
            yPos += 12;
            
            // Table rows
            doc.setFont(undefined, 'normal');
            employees.forEach((emp, index) => {
                // Check if we need a new page
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Alternating row colors
                if (index % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(marginX, yPos - 3, contentWidth, 10, 'F');
                }
                
                const rating = emp.evaluationData?.overallRating || 'Not Rated';
                const status = emp.status.charAt(0).toUpperCase() + emp.status.slice(1).replace('-', ' ');
                
                // Check calibration readiness
                const data = emp.evaluationData;
                const isCalibrationReady = data && data.keyPriorities && data.collaboration && 
                                         data.growth && data.lookingAhead &&
                                         data.keyPriorities.trim().length > 50 &&
                                         data.collaboration.trim().length > 50 &&
                                         emp.status === 'completed';
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.text(emp.name.replace(/[^\x00-\x7F]/g, '').substring(0, 20), marginX + 3, yPos + 3);
                doc.text(emp.position.replace(/[^\x00-\x7F]/g, '').substring(0, 15), marginX + 50, yPos + 3);
                
                // Status with color coding
                if (emp.status === 'completed') doc.setTextColor(40, 167, 69);
                else if (emp.status === 'in-progress') doc.setTextColor(0, 175, 215);
                else doc.setTextColor(108, 117, 125);
                
                doc.text(status.substring(0, 10), marginX + 100, yPos + 3);
                
                // Rating with color coding
                if (rating === 'exemplary') doc.setTextColor(40, 167, 69);
                else if (rating === 'successful') doc.setTextColor(0, 175, 215);
                else if (rating === 'opportunity') doc.setTextColor(255, 193, 7);
                else doc.setTextColor(108, 117, 125);
                
                doc.text(rating.charAt(0).toUpperCase() + rating.slice(1).substring(0, 8), marginX + 130, yPos + 3);
                
                // Calibration readiness
                if (isCalibrationReady) doc.setTextColor(40, 167, 69);
                else doc.setTextColor(220, 53, 69);
                
                doc.text(isCalibrationReady ? 'Yes' : 'No', marginX + 160, yPos + 3);
                doc.setTextColor(0, 0, 0);
                
                yPos += 10;
            });
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`Sam's Club Calibration Discussion Prep Tool - Page ${i} of ${pageCount}`, marginX, doc.internal.pageSize.height - 10);
                doc.text(`Generated: ${new Date().toLocaleString()}`, pageWidth - 80, doc.internal.pageSize.height - 10);
            }
            
            // Download the PDF
            const fileName = `${reviewer.name.replace(/\s+/g, '_')}_Team_Report_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        // Help Tooltip Functions (Global scope for Analytics)


        // Help Button Functions
        function toggleHelp(helpId, event) {
            console.log('toggleHelp called for:', helpId);
            
            // Prevent the click event from bubbling up
            if (event) {
                event.stopPropagation();
                event.preventDefault();
                console.log('Event stopped for:', helpId);
            }
            
            // Close all other tooltips first
            document.querySelectorAll('.help-tooltip.show').forEach(tooltip => {
                if (tooltip.id !== helpId) {
                    tooltip.classList.remove('show');
                }
            });
            
            // Toggle the requested tooltip
            const tooltip = document.getElementById(helpId);
            if (tooltip) {
                const isShowing = tooltip.classList.contains('show');
                console.log('Tooltip', helpId, 'is currently showing:', isShowing);
                
                if (!isShowing) {
                    // Simple show - tooltip uses fixed CSS positioning
                    tooltip.classList.add('show');
                    console.log('Showing tooltip:', helpId);
                } else {
                    tooltip.classList.remove('show');
                    console.log('Hiding tooltip:', helpId);
                }
            } else {
                console.log('Tooltip not found:', helpId);
            }
        }

        function showTooltipBackdrop() {
            let backdrop = document.getElementById('tooltip-backdrop');
            if (!backdrop) {
                backdrop = document.createElement('div');
                backdrop.id = 'tooltip-backdrop';
                backdrop.className = 'tooltip-backdrop';
                backdrop.onclick = closeAllTooltips;
                document.body.appendChild(backdrop);
            }
            backdrop.classList.add('show');
        }

        function hideTooltipBackdrop() {
            const backdrop = document.getElementById('tooltip-backdrop');
            if (backdrop) {
                backdrop.classList.remove('show');
            }
        }

        function closeAllTooltips() {
            document.querySelectorAll('.help-tooltip.show').forEach(tooltip => {
                tooltip.classList.remove('show');
            });
        }

        function closeHelp(helpId) {
            const tooltip = document.getElementById(helpId);
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        }

        // Close tooltips when clicking anywhere (with debugging)
        document.addEventListener('click', function(event) {
            // Check if any tooltips are currently open
            const openTooltips = document.querySelectorAll('.help-tooltip.show');
            if (openTooltips.length === 0) return; // No tooltips open, nothing to do
            
            // Don't handle clicks inside the Analytics modal - let the Analytics modal handle them
            if (event.target.closest('.team-report-modal')) {
                console.log('Click inside Analytics modal - letting modal handle it');
                return;
            }
            
            console.log('Global click detected, tooltips open:', openTooltips.length);
            console.log('Clicked element:', event.target);
            console.log('Closest help-button:', event.target.closest('.help-button'));
            console.log('Closest help-close:', event.target.closest('.help-close'));
            
            // Close all tooltips unless clicking help or close buttons (those handle their own logic)
            if (!event.target.closest('.help-button') && 
                !event.target.closest('.help-close')) {
                console.log('Closing all tooltips');
                closeAllTooltips();
            } else {
                console.log('Not closing tooltips - clicked on help/close button');
            }
        });

        // Analytics & Insights Function
        function showAnalyticsInsights() {
            const reviewer = reviewerData[currentReviewer];
            const employees = Object.values(reviewer.employees || {});
            const activeEmployees = employees.filter(emp => !emp.archived);
            
            if (activeEmployees.length === 0) {
                alert('No evaluation data available for analysis. Please complete some evaluations first.');
                return;
            }
            
            const insights = generateInsights(activeEmployees);
            
            const analyticsHTML = `
                <div class="team-report-overlay" onclick="closeAnalytics(event)">
                    <div class="team-report-modal" onclick="handleAnalyticsModalClick(event)" style="max-width: 1200px;">
                        <div class="report-header">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <button class="btn btn-outline" onclick="closeAnalytics()" style="margin-right: 15px;">← Back to Dashboard</button>
                                <button class="close-btn" onclick="closeAnalytics()">&times;</button>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <div style="width: 32px; height: 32px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; padding: 3px; box-shadow: 0 2px 8px rgba(0, 115, 206, 0.2);">
                                    <img src="sams-club-logo.png" alt="Sam's Club Logo" style="width: 100%; height: 100%; object-fit: contain;">
                                </div>
                                <div>
                                    <h2 style="margin: 0; color: #00AFD7; font-size: 28px; font-weight: 700;">Analytics & Insights Dashboard</h2>
                                    <p style="margin: 2px 0 0 0; color: #495057; font-size: 14px;">AI-Powered Analysis for ${reviewer.name}'s Team | ${activeEmployees.length} Team Members</p>
                                </div>
                            </div>
                            <div style="height: 2px; background: linear-gradient(90deg, #00AFD7 0%, #FFC220 100%); border-radius: 2px; margin: 8px 0;"></div>
                        </div>
                        
                        <div class="analytics-container">
                            <!-- Executive Summary -->
                            <div class="insights-section">
                                <div class="section-header">
                                    <h3>Executive Summary</h3>
                                    <button class="help-button" onclick="toggleHelp('help-executive', event)" title="Learn more">?</button>
                                    <div class="help-tooltip" id="help-executive">
                                        <button class="help-close" onclick="closeHelp('help-executive')">&times;</button>
                                        <h4>Executive Summary</h4>
                                        <p>Comprehensive overview providing essential information for calibration discussions and team performance assessment.</p>
                                        <ul>
                                            <li><strong>Team Overview:</strong> Team size, completion rates, and rating distribution (Exemplary/Successful/Opportunity)</li>
                                            <li><strong>Key Insights:</strong> AI-generated analysis of overall team performance patterns and trends</li>
                                            <li><strong>Priority Recommendations:</strong> Top strategic actions ranked by importance for team development</li>
                                            <li><strong>Action Items:</strong> Specific, actionable next steps requiring manager attention</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="executive-summary">
                                    <div class="exec-overview">
                                        <h4>Team Performance Overview</h4>
                                        <p><strong>${reviewer.name}'s Team:</strong> ${activeEmployees.length} direct reports • ${insights.completedCount} evaluations completed (${Math.round((insights.completedCount / activeEmployees.length) * 100)}% completion rate)</p>
                                        
                                        <div class="performance-snapshot">
                                            <div class="snapshot-item exemplary">
                                                <span class="snapshot-number">${insights.ratingDistribution.exemplary.count}</span>
                                                <span class="snapshot-label">Exemplary</span>
                                            </div>
                                            <div class="snapshot-item successful">
                                                <span class="snapshot-number">${insights.ratingDistribution.successful.count}</span>
                                                <span class="snapshot-label">Successful</span>
                                            </div>
                                            <div class="snapshot-item opportunity">
                                                <span class="snapshot-number">${insights.ratingDistribution.opportunity.count}</span>
                                                <span class="snapshot-label">Opportunity</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="exec-insights">
                                        <h4>Key Findings</h4>
                                        <p>${insights.executiveSummary.keyInsight}</p>
                                    </div>

                                    <div class="exec-recommendations">
                                        <h4>Strategic Recommendations</h4>
                                        <div class="rec-grid">
                                            ${insights.recommendations.slice(0, 2).map((rec, index) => `
                                                <div class="rec-item priority-${index + 1}">
                                                    <div class="rec-priority">Priority ${index + 1}</div>
                                                    <div class="rec-title">${rec.title}</div>
                                                    <div class="rec-desc">${rec.description}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="exec-actions">
                                        <h4>Immediate Actions Required</h4>
                                        <div class="action-list">
                                            ${insights.executiveSummary.actionItems.slice(0, 3).map(item => `
                                                <div class="action-item">${item}</div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bias Detection Heatmap -->
                            <div class="insights-section">
                                <div class="section-header">
                                    <h3>Bias Detection Analysis</h3>
                                    <button class="help-button" onclick="toggleHelp('help-bias', event)" title="Learn more">?</button>
                                    <div class="help-tooltip" id="help-bias">
                                        <button class="help-close" onclick="closeHelp('help-bias')">&times;</button>
                                        <h4>Bias Detection Analysis</h4>
                                        <p>Algorithmic analysis identifying potential evaluation biases to ensure fair and objective assessments.</p>
                                        <ul>
                                            <li><strong>Risk Levels:</strong> High (red) = Critical attention needed, Medium (gold) = Monitor closely, Low (teal) = Acceptable levels</li>
                                            <li><strong>Bias Types:</strong> Easy/Hard rater tendencies, recency effects, halo bias, and inconsistent rating patterns</li>
                                            <li><strong>Instance Count:</strong> Number of detected bias occurrences across all team evaluations</li>
                                            <li><strong>Overall Score:</strong> Team-wide bias risk assessment (0-100, lower scores indicate more objective evaluations)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="bias-analysis-grid">
                                    ${insights.biasAnalysis.map(bias => `
                                        <div class="bias-card ${bias.level}">
                                            <div class="bias-type">${bias.type}</div>
                                            <div class="bias-count">${bias.count}</div>
                                            <div class="bias-level">${bias.level}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <p><strong>Overall Bias Score:</strong> ${insights.overallBiasScore}/100 (Lower is better)</p>
                            </div>
                            
                            <!-- Content Quality Trends -->
                            <div class="insights-section">
                                <div class="section-header">
                                    <h3>Content Quality Trends</h3>
                                    <button class="help-button" onclick="toggleHelp('help-quality', event)" title="Learn more">?</button>
                                    <div class="help-tooltip" id="help-quality">
                                        <button class="help-close" onclick="closeHelp('help-quality')">&times;</button>
                                        <h4>Content Quality Metrics</h4>
                                        <p>Quantitative analysis of evaluation content quality across three key dimensions.</p>
                                        <ul>
                                            <li><strong>Average Objectivity:</strong> Percentage of fact-based vs. subjective language across all evaluation sections</li>
                                            <li><strong>Average Specificity:</strong> Measurement of detail depth and concrete examples provided in evaluations</li>
                                            <li><strong>Completion Rate:</strong> Percentage of evaluation sections that are fully completed with substantive content</li>
                                            <li><strong>Trend Indicators:</strong> Visual arrows showing performance improvement (↑) or decline (↓) patterns</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="pattern-grid">
                                    <div class="pattern-card">
                                        <div class="pattern-title">Average Objectivity</div>
                                        <div class="pattern-description">Across all evaluation sections</div>
                                        <div class="pattern-data">
                                            <span class="insight-metric">${insights.contentQuality.avgObjectivity}%</span>
                                            ${insights.contentQuality.objectivityTrend}
                                        </div>
                                    </div>
                                    <div class="pattern-card">
                                        <div class="pattern-title">Average Specificity</div>
                                        <div class="pattern-description">Detail level in evaluations</div>
                                        <div class="pattern-data">
                                            <span class="insight-metric">${insights.contentQuality.avgSpecificity}%</span>
                                            ${insights.contentQuality.specificityTrend}
                                        </div>
                                    </div>
                                    <div class="pattern-card">
                                        <div class="pattern-title">Completion Rate</div>
                                        <div class="pattern-description">Fully completed sections</div>
                                        <div class="pattern-data">
                                            <span class="insight-metric">${insights.contentQuality.completionRate}%</span>
                                            ${insights.contentQuality.completionTrend}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Anomaly Detection -->
                            <div class="insights-section">
                                <div class="section-header">
                                    <h3>Anomaly Pattern Detection</h3>
                                    <button class="help-button" onclick="toggleHelp('help-anomaly', event)" title="Learn more">?</button>
                                    <div class="help-tooltip" id="help-anomaly">
                                        <button class="help-close" onclick="closeHelp('help-anomaly')">&times;</button>
                                        <h4>Anomaly Pattern Detection</h4>
                                        <p>Statistical analysis identifying unusual evaluation patterns that may require manager review or calibration.</p>
                                        <ul>
                                            <li><strong>Severity Classification:</strong> High (red) = Immediate review needed, Medium (gold) = Monitor, Low (teal) = Informational</li>
                                            <li><strong>Detected Patterns:</strong> Rating inconsistencies, outlier language patterns, completion anomalies, and statistical deviations</li>
                                            <li><strong>Impact Scope:</strong> Number of team members affected by each identified anomaly pattern</li>
                                            <li><strong>Risk Assessment:</strong> Overall team evaluation consistency score with recommended actions</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="anomaly-detection-grid">
                                    ${insights.anomalyDetection.map(anomaly => `
                                        <div class="anomaly-card ${anomaly.severity}">
                                            <div class="anomaly-header">
                                                <div class="anomaly-icon">${anomaly.icon}</div>
                                                <div class="anomaly-info">
                                                    <div class="anomaly-title">${anomaly.title}</div>
                                                    <div class="anomaly-severity">Severity: ${anomaly.severity.toUpperCase()}</div>
                                                </div>
                                            </div>
                                            <div class="anomaly-description">${anomaly.description}</div>
                                            <div class="anomaly-details">
                                                <div class="anomaly-count">Affected: ${anomaly.affectedCount} employees</div>
                                                <div class="anomaly-recommendation">${anomaly.recommendation}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="anomaly-summary">
                                    <strong>Anomaly Risk Score:</strong> ${insights.anomalyRiskScore}/100
                                    <div class="risk-indicator ${insights.anomalyRiskLevel}">
                                        Risk Level: ${insights.anomalyRiskLevel.toUpperCase()}
                                    </div>
                                </div>
                            </div>
                            

                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', analyticsHTML);
        }
        
        function handleAnalyticsModalClick(event) {
            // Prevent the click from bubbling up to close the analytics modal
            event.stopPropagation();
            
            // Check if any help tooltips are currently open
            const openTooltips = document.querySelectorAll('.help-tooltip.show');
            if (openTooltips.length === 0) return; // No tooltips open, nothing to do
            
            console.log('Click in Analytics modal detected, checking if should close tooltips');
            console.log('Clicked element:', event.target);
            console.log('Closest help-button:', event.target.closest('.help-button'));
            console.log('Closest help-close:', event.target.closest('.help-close'));
            console.log('Closest help-tooltip:', event.target.closest('.help-tooltip'));
            
            // Close all tooltips unless clicking help buttons, close buttons, or inside tooltips themselves
            const isHelpButton = event.target.closest('.help-button');
            const isHelpClose = event.target.closest('.help-close');
            const isInsideTooltip = event.target.closest('.help-tooltip');
            
            if (!isHelpButton && !isHelpClose && !isInsideTooltip) {
                console.log('Closing all tooltips from analytics modal click');
                closeAllTooltips();
            } else {
                console.log('Not closing tooltips - clicked on help element');
            }
        }
        
        function closeAnalytics(event) {
            if (event && event.target !== event.currentTarget) return;
            const overlay = document.querySelector('.team-report-overlay');
            if (overlay) {
                overlay.remove();
            }
            // Ensure the main dashboard is still visible
            if (currentReviewer && reviewerData[currentReviewer]) {
                // Force dashboard visibility if needed
                const container = document.querySelector('.container');
                if (container && (!container.innerHTML.includes('sidebar') || !container.innerHTML.includes('Direct Reports'))) {
                    loadReviewerDashboard();
                }
            }
        }
        
        function generateInsights(employees) {
            const completedEmployees = employees.filter(emp => emp.status === 'completed' && emp.evaluationData);
            
            // Rating Distribution Analysis (consistent with Team Report)
            const ratingDistribution = { 
                exemplary: {count: 0, percentage: 0}, 
                successful: {count: 0, percentage: 0}, 
                opportunity: {count: 0, percentage: 0}
            };
            
            // Only count employees with actual ratings (completed evaluations)
            const employeesWithRatings = employees.filter(emp => emp.status === 'completed' && emp.evaluationData?.overallRating);
            
            employeesWithRatings.forEach(emp => {
                const rating = emp.evaluationData.overallRating;
                if (rating && ratingDistribution[rating]) {
                    ratingDistribution[rating].count++;
                }
            });
            
            // Calculate percentages based on employees with ratings (not total employees)
            const totalWithRatings = employeesWithRatings.length || 1;
            Object.keys(ratingDistribution).forEach(rating => {
                ratingDistribution[rating].percentage = Math.round((ratingDistribution[rating].count / totalWithRatings) * 100);
            });
            
            // Performance Patterns Analysis
            const performancePatterns = [];
            
            // Rating Distribution Pattern with Enhanced Insights
            if (completedEmployees.length > 0) {
                const exemplaryPct = ratingDistribution.exemplary.percentage;
                const successfulPct = ratingDistribution.successful.percentage;
                const opportunityPct = ratingDistribution.opportunity.percentage;
                
                // Generate rating insight (moved from Rating Distribution Analysis)
                let ratingInsight = '';
                if (ratingDistribution.exemplary.percentage > 50) {
                    ratingInsight = 'High concentration of top performers - consider stretch assignments and leadership development.';
                } else if (ratingDistribution.opportunity.percentage > 30) {
                    ratingInsight = 'Significant development needs identified - focus on targeted improvement plans.';
                } else {
                    ratingInsight = 'Balanced performance distribution across the team.';
                }
                
                performancePatterns.push({
                    type: 'chart',
                    title: 'Rating Distribution Analysis',
                    description: ratingInsight,
                    data: `${ratingDistribution.exemplary.count} Exemplary • ${ratingDistribution.successful.count} Successful • ${ratingDistribution.opportunity.count} Opportunity`,
                    chart: {
                        exemplary: exemplaryPct,
                        successful: successfulPct,
                        opportunity: opportunityPct
                    },
                    showBars: false  // Use horizontal bar chart instead
                });
            }
            
            // Team Strengths Analysis
            const strengthsAnalysis = analyzeTeamStrengths(completedEmployees);
            if (strengthsAnalysis.topStrength) {
                performancePatterns.push({
                    type: 'strength',
                    title: 'Team Strength Area',
                    description: `Highest performing competency: ${strengthsAnalysis.topStrength.name}`,
                    data: `${strengthsAnalysis.topStrength.percentage}% of team excels in this area`
                });
            }
            
            // Performance Variance Pattern
            const variance = calculateRatingVariance(completedEmployees);
            const varianceType = variance > 0.5 ? 'high' : variance > 0.2 ? 'medium' : 'low';
            const varianceMessage = {
                high: 'Wide performance spread - focus on standardization',
                medium: 'Moderate performance variation - targeted coaching needed',
                low: 'Consistent performance levels across team'
            };
            
            if (completedEmployees.length > 1) {
                performancePatterns.push({
                    type: varianceType === 'high' ? 'warning' : 'info',
                    title: 'Performance Consistency',
                    description: varianceMessage[varianceType],
                    data: `Performance variance score: ${variance.toFixed(2)}`
                });
            }
            
            // Bias Analysis
            const biasAnalysis = analyzeBiasPatterns(completedEmployees);
            
            // Content Quality Analysis
            const contentQuality = analyzeContentQuality(completedEmployees);
            
            // AI Recommendations
            const recommendations = generateRecommendations(employees, ratingDistribution, biasAnalysis, contentQuality);
            
            // Rating insight now handled within Performance Patterns section
            
            // Anomaly Detection Analysis
            const anomalyDetection = analyzeAnomalyPatterns(employees, completedEmployees, ratingDistribution, biasAnalysis);
            
            // Executive Summary
            const executiveSummary = generateExecutiveSummary(employees, completedEmployees, ratingDistribution);
            
            return {
                performancePatterns,
                ratingDistribution,
                biasAnalysis,
                contentQuality,
                recommendations,
                anomalyDetection: anomalyDetection.anomalies,
                anomalyRiskScore: anomalyDetection.riskScore,
                anomalyRiskLevel: anomalyDetection.riskLevel,
                executiveSummary,
                completedCount: completedEmployees.length,
                overallBiasScore: Math.round(biasAnalysis.reduce((sum, bias) => sum + bias.score, 0) / biasAnalysis.length)
            };
        }
        
        function analyzeBiasPatterns(employees) {
            const biasTypes = {
                'Length Bias': 0,
                'Recency Bias': 0,
                'Subjective Language': 0,
                'Generic Feedback': 0
            };
            
            employees.forEach(emp => {
                if (!emp.evaluationData) return;
                
                // Analyze each section for bias patterns
                ['keyPriorities', 'resultsImpact', 'collaboration', 'growth', 'lookingAhead'].forEach(section => {
                    const content = emp.evaluationData[section];
                    if (!content) return;
                    
                    // Length bias (too short/long)
                    if (content.length < 50 || content.length > 1000) biasTypes['Length Bias']++;
                    
                    // Subjective language
                    const subjectiveWords = ['good', 'bad', 'great', 'poor', 'nice', 'awesome', 'terrible', 'amazing'];
                    if (subjectiveWords.some(word => content.toLowerCase().includes(word))) {
                        biasTypes['Subjective Language']++;
                    }
                    
                    // Generic feedback
                    const genericPhrases = ['did well', 'good job', 'met expectations', 'performed as expected'];
                    if (genericPhrases.some(phrase => content.toLowerCase().includes(phrase))) {
                        biasTypes['Generic Feedback']++;
                    }
                });
            });
            
            return Object.entries(biasTypes).map(([type, count]) => ({
                type,
                count,
                level: count > 5 ? 'high' : count > 2 ? 'medium' : 'low',
                score: count * 10
            }));
        }
        
        function analyzeContentQuality(employees) {
            let totalObjectivity = 0, totalSpecificity = 0, totalSections = 0;
            let completedSections = 0;
            
            employees.forEach(emp => {
                if (!emp.evaluationData) return;
                
                ['keyPriorities', 'resultsImpact', 'collaboration', 'growth', 'lookingAhead'].forEach(section => {
                    const content = emp.evaluationData[section];
                    totalSections++;
                    
                    if (content && content.length > 20) {
                        completedSections++;
                        
                        // Use differentiated objectivity calculation based on section type
                        let objectivity;
                        if (section === 'growth' || section === 'lookingAhead') {
                            // Evaluative sections - use professional judgment criteria
                            objectivity = calculateEvaluativeObjectivity(content);
                        } else {
                            // Performance sections - use data-driven criteria
                            objectivity = calculatePerformanceObjectivity(content);
                        }
                        
                        const specificity = calculateSpecificity(content, section);
                        
                        totalObjectivity += objectivity;
                        totalSpecificity += specificity;
                    }
                });
            });
            
            const avgObjectivity = Math.round(totalObjectivity / (completedSections || 1));
            const avgSpecificity = Math.round(totalSpecificity / (completedSections || 1));
            const completionRate = Math.round((completedSections / totalSections) * 100);
            
            return {
                avgObjectivity,
                avgSpecificity,
                completionRate,
                objectivityTrend: avgObjectivity > 70 ? 'Excellent' : avgObjectivity > 50 ? 'Good' : 'Needs Improvement',
                specificityTrend: avgSpecificity > 70 ? 'Detailed' : avgSpecificity > 50 ? 'Adequate' : 'Too Generic',
                completionTrend: completionRate > 80 ? 'Complete' : completionRate > 60 ? 'Partial' : 'Incomplete'
            };
        }

        function analyzeAnomalyPatterns(allEmployees, completedEmployees, ratingDistribution, biasAnalysis) {
            const anomalies = [];
            let riskScore = 0;
            
            // 1. Rating Distribution Anomalies
            const totalWithRatings = completedEmployees.filter(emp => emp.evaluationData?.overallRating).length;
            
            // Easy Rater Detection
            if (ratingDistribution.exemplary.percentage > 70 && totalWithRatings >= 3) {
                anomalies.push({
                    title: 'Easy Rater Pattern',
                    severity: 'high',
                    icon: '',
                    description: 'Unusually high concentration of exemplary ratings may indicate rating inflation or lack of differentiation.',
                    affectedCount: ratingDistribution.exemplary.count,
                    recommendation: 'Review calibration standards and consider more detailed performance criteria.'
                });
                riskScore += 25;
            }
            
            // Harsh Rater Detection
            if (ratingDistribution.opportunity.percentage > 50 && totalWithRatings >= 3) {
                anomalies.push({
                    title: 'Harsh Rater Pattern',
                    severity: 'high',
                    icon: '',
                    description: 'High percentage of opportunity ratings may indicate overly strict evaluation criteria.',
                    affectedCount: ratingDistribution.opportunity.count,
                    recommendation: 'Review rating standards and ensure fair, balanced evaluation approach.'
                });
                riskScore += 25;
            }
            
            // 2. Completion Pattern Anomalies
            const completionRate = (completedEmployees.length / allEmployees.length) * 100;
            if (completionRate < 30 && allEmployees.length > 2) {
                anomalies.push({
                    title: 'Low Completion Rate',
                    severity: 'medium',
                    icon: '⏰',
                    description: 'Significantly low evaluation completion rate may indicate process issues or time constraints.',
                    affectedCount: allEmployees.length - completedEmployees.length,
                    recommendation: 'Investigate barriers to completion and streamline evaluation process.'
                });
                riskScore += 15;
            }
            
            // 3. Content Length Anomalies
            let shortFeedbackCount = 0;
            let totalFeedbackLength = 0;
            
            completedEmployees.forEach(emp => {
                if (emp.evaluationData?.sections) {
                    const sections = ['keyPriorities', 'resultsImpact', 'collaboration', 'growthDevelopment', 'lookingAhead'];
                    sections.forEach(section => {
                        const content = emp.evaluationData.sections[section]?.feedback || '';
                        totalFeedbackLength += content.length;
                        if (content.length < 50) {
                            shortFeedbackCount++;
                        }
                    });
                }
            });
            
            const avgFeedbackLength = totalFeedbackLength / (completedEmployees.length * 5) || 0;
            if (avgFeedbackLength < 100 && completedEmployees.length > 0) {
                anomalies.push({
                    title: 'Minimal Feedback Pattern',
                    severity: 'medium',
                    icon: '',
                    description: 'Average feedback length is unusually short, potentially lacking sufficient detail for meaningful evaluation.',
                    affectedCount: Math.round(shortFeedbackCount / 5),
                    recommendation: 'Encourage more detailed, specific feedback with examples and actionable insights.'
                });
                riskScore += 10;
            }
            
            // 4. Time-based Anomalies
            const recentEvaluations = completedEmployees.filter(emp => {
                if (!emp.evaluationData?.lastModified) return false;
                const evalDate = new Date(emp.evaluationData.lastModified);
                const daysSince = (new Date() - evalDate) / (1000 * 60 * 60 * 24);
                return daysSince < 1; // Completed within last 24 hours
            });
            
            if (recentEvaluations.length > completedEmployees.length * 0.8 && completedEmployees.length > 3) {
                anomalies.push({
                    title: 'Rush Completion Pattern',
                    severity: 'medium',
                    icon: '',
                    description: 'Large number of evaluations completed in short timeframe may indicate rushed process.',
                    affectedCount: recentEvaluations.length,
                    recommendation: 'Consider spacing out evaluations for more thoughtful assessment.'
                });
                riskScore += 15;
            }
            
            // 5. Consistency Anomalies
            const ratingVariance = calculateRatingVariance(completedEmployees);
            if (ratingVariance < 0.1 && completedEmployees.length > 4) {
                anomalies.push({
                    title: 'Low Rating Variance',
                    severity: 'low',
                    icon: '',
                    description: 'Very similar ratings across team members may indicate lack of differentiation.',
                    affectedCount: completedEmployees.length,
                    recommendation: 'Ensure evaluations capture individual performance differences and unique contributions.'
                });
                riskScore += 8;
            }
            
            // 6. Bias Pattern Anomalies
            const highBiasCount = biasAnalysis.filter(bias => bias.score > 70).length;
            if (highBiasCount > 2) {
                anomalies.push({
                    title: 'Multiple Bias Patterns',
                    severity: 'high',
                    icon: '⚖️',
                    description: 'Multiple types of evaluation bias detected, potentially compromising assessment fairness.',
                    affectedCount: highBiasCount,
                    recommendation: 'Review evaluation training and implement structured assessment guidelines.'
                });
                riskScore += 20;
            }
            
            // Default case - no anomalies detected
            if (anomalies.length === 0) {
                anomalies.push({
                    title: 'No Significant Anomalies',
                    severity: 'low',
                    icon: '',
                    description: 'Evaluation patterns appear normal and balanced across standard metrics.',
                    affectedCount: 0,
                    recommendation: 'Continue current evaluation practices and monitor for emerging patterns.'
                });
            }
            
            // Calculate risk level
            let riskLevel = 'low';
            if (riskScore > 50) riskLevel = 'high';
            else if (riskScore > 25) riskLevel = 'medium';
            
            return {
                anomalies,
                riskScore: Math.min(riskScore, 100),
                riskLevel
            };
        }
        
        function calculateRatingVariance(employees) {
            const ratings = employees
                .filter(emp => emp.evaluationData?.overallRating)
                .map(emp => {
                    const rating = emp.evaluationData.overallRating;
                    return rating === 'exemplary' ? 3 : rating === 'successful' ? 2 : 1;
                });
            
            if (ratings.length < 2) return 0;
            
            const mean = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
            const variance = ratings.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / ratings.length;
            
            return variance;
        }

        function generateExecutiveSummary(allEmployees, completedEmployees, ratingDistribution) {
            const completionRate = Math.round((completedEmployees.length / allEmployees.length) * 100);
            const topPerformers = completedEmployees.filter(emp => emp.evaluationData?.overallRating === 'exemplary');
            const developmentNeeds = completedEmployees.filter(emp => emp.evaluationData?.overallRating === 'opportunity');
            
            const highlights = [];
            
            // Completion status highlight
            if (completionRate >= 80) {
                highlights.push({ icon: '', text: `${completionRate}% evaluation completion rate` });
            } else if (completionRate >= 50) {
                highlights.push({ icon: '', text: `${completionRate}% completion rate - in progress` });
            } else {
                highlights.push({ icon: '', text: `${completionRate}% completion rate - needs attention` });
            }
            
            // Performance distribution highlight
            if (topPerformers.length > 0) {
                highlights.push({ icon: '', text: `${topPerformers.length} exemplary performer${topPerformers.length !== 1 ? 's' : ''}` });
            }
            
            if (developmentNeeds.length > 0) {
                highlights.push({ icon: '', text: `${developmentNeeds.length} team member${developmentNeeds.length !== 1 ? 's' : ''} with development opportunities` });
            }
            
            // Generate key insight
            let keyInsight = '';
            if (ratingDistribution.exemplary.percentage > 40) {
                keyInsight = 'The team demonstrates strong performance with multiple high achievers. Focus on leadership development and stretch assignments to maximize potential.';
            } else if (ratingDistribution.opportunity.percentage > 30) {
                keyInsight = 'Significant development opportunities identified across the team. Prioritize targeted coaching and skill-building initiatives.';
            } else {
                keyInsight = 'The team shows balanced performance distribution. Continue supporting individual growth while maintaining current standards.';
            }
            
            // Generate action items
            const actionItems = [];
            if (completionRate < 100) {
                actionItems.push('Complete remaining evaluations to ensure comprehensive team assessment');
            }
            if (topPerformers.length > 0) {
                actionItems.push('Develop retention and advancement plans for top performers');
            }
            if (developmentNeeds.length > 0) {
                actionItems.push('Create individualized development plans with specific goals and timelines');
            }
            if (actionItems.length === 0) {
                actionItems.push('Monitor ongoing performance and maintain regular feedback cycles');
            }
            
            return {
                highlights,
                keyInsight,
                actionItems
            };
        }

        function analyzeTeamStrengths(employees) {
            if (employees.length === 0) return { topStrength: null };
            
            const competencyScores = {
                'Key Priorities': { total: 0, count: 0, name: 'Key Priorities & Results' },
                'Collaboration': { total: 0, count: 0, name: 'Collaboration & Influence' },
                'Growth & Development': { total: 0, count: 0, name: 'Growth & Development' },
                'Looking Ahead': { total: 0, count: 0, name: 'Strategic Vision' }
            };
            
            employees.forEach(employee => {
                if (employee.evaluationData?.sections) {
                    const sections = employee.evaluationData.sections;
                    
                    // Convert ratings to numeric scores (3=exemplary, 2=successful, 1=opportunity)
                    const scoreMap = { exemplary: 3, successful: 2, opportunity: 1 };
                    
                    if (sections.keyPriorities?.rating) {
                        competencyScores['Key Priorities'].total += scoreMap[sections.keyPriorities.rating] || 0;
                        competencyScores['Key Priorities'].count++;
                    }

                    if (sections.collaboration?.rating) {
                        competencyScores['Collaboration'].total += scoreMap[sections.collaboration.rating] || 0;
                        competencyScores['Collaboration'].count++;
                    }
                    if (sections.growthDevelopment?.rating) {
                        competencyScores['Growth & Development'].total += scoreMap[sections.growthDevelopment.rating] || 0;
                        competencyScores['Growth & Development'].count++;
                    }
                    if (sections.lookingAhead?.rating) {
                        competencyScores['Looking Ahead'].total += scoreMap[sections.lookingAhead.rating] || 0;
                        competencyScores['Looking Ahead'].count++;
                    }
                }
            });
            
            // Calculate averages and find top strength
            let topStrength = null;
            let highestAverage = 0;
            
            Object.keys(competencyScores).forEach(key => {
                const competency = competencyScores[key];
                if (competency.count > 0) {
                    const average = competency.total / competency.count;
                    if (average > highestAverage) {
                        highestAverage = average;
                        topStrength = {
                            name: competency.name,
                            average: average,
                            percentage: Math.round((average / 3) * 100)
                        };
                    }
                }
            });
            
            return { topStrength };
        }


        
        function generateRecommendations(employees, ratingDistribution, biasAnalysis, contentQuality) {
            const recommendations = [];
            
            // Based on completion rate
            const completionRate = Math.round((employees.filter(emp => emp.status === 'completed').length / employees.length) * 100);
            if (completionRate < 70) {
                recommendations.push({
                    priority: '1',
                    title: 'Complete Remaining Evaluations',
                    description: `${100 - completionRate}% of evaluations are still incomplete. Set a deadline to finish all assessments.`
                });
            }
            
            // Based on bias analysis
            const highBiasCount = biasAnalysis.filter(bias => bias.level === 'high').length;
            if (highBiasCount > 0) {
                recommendations.push({
                    priority: '2',
                    title: 'Address Evaluation Bias',
                    description: 'High bias detected in multiple areas. Review feedback for objectivity and add specific examples with measurable outcomes.'
                });
            }
            
            // Based on content quality
            if (contentQuality.avgObjectivity < 60) {
                recommendations.push({
                    priority: '3',
                    title: 'Improve Objectivity',
                    description: 'Add more factual, measurable examples in evaluations. Replace subjective opinions with concrete achievements and data.'
                });
            }
            
            if (contentQuality.avgSpecificity < 60) {
                recommendations.push({
                    priority: '4',
                    title: 'Increase Specificity',
                    description: 'Include more detailed examples, dates, numbers, and specific project names in your evaluations.'
                });
            }
            
            // Based on rating distribution
            if (ratingDistribution.exemplary.percentage > 70) {
                recommendations.push({
                    priority: '5',
                    title: 'Challenge High Performers',
                    description: 'Consider stretch assignments, leadership roles, or cross-functional projects for your top performers.'
                });
            }
            
            if (ratingDistribution.opportunity.percentage > 20) {
                recommendations.push({
                    priority: '6',
                    title: 'Development Planning',
                    description: 'Create detailed improvement plans with specific goals, timelines, and support resources for team members needing development.'
                });
            }
            
            return recommendations;
        }

        // Individual Evaluation Download Function

        function downloadIndividualEvaluationPDF(employeeId, event) {
            if (event) {
                event.stopPropagation(); // Prevent triggering startEvaluation
            }
            
            const reviewer = reviewerData[currentReviewer];
            const employee = reviewer.employees[employeeId];
            
            if (!employee || !employee.evaluationData || Object.keys(employee.evaluationData).length === 0) {
                alert('No evaluation data available for this employee.');
                return;
            }

            const data = employee.evaluationData;
            const currentDate = new Date().toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            
            // Initialize jsPDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('portrait', 'mm', 'a4');
            
            // Page dimensions and settings
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 12;
            const contentWidth = pageWidth - (2 * margin);
            let y = margin;
            
            // Helper function for consistent spacing
            function addSpace(amount = 5) {
                y += amount;
                if (y > pageHeight - 20) {
                    pdf.addPage();
                    y = margin;
                }
            }
            
            // Helper function to add wrapped text
            function addText(text, fontSize = 10, style = 'normal', color = [0, 0, 0], indent = 0) {
                pdf.setFontSize(fontSize);
                pdf.setFont(undefined, style);
                pdf.setTextColor(...color);
                
                const lines = pdf.splitTextToSize(text, contentWidth - indent);
                const textHeight = lines.length * (fontSize * 0.35);
                
                // Check if we need a new page
                if (y + textHeight > pageHeight - 15) {
                    pdf.addPage();
                    y = margin;
                }
                
                pdf.text(lines, margin + indent, y);
                y += textHeight + 2;
                
                // Reset color
                pdf.setTextColor(0, 0, 0);
                return y;
            }
            
            // Clean, professional header
            pdf.setFillColor(0, 115, 206); // Sam's blue
            pdf.rect(0, 0, pageWidth, 20, 'F');
            
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(14);
            pdf.setFont(undefined, 'bold');
            pdf.text('PERFORMANCE CALIBRATION SUMMARY', pageWidth/2, 13, { align: 'center' });
            
            // Reset position
            y = 35;
            
            // Clean employee section
            pdf.setTextColor(17, 34, 75);
            pdf.setFontSize(16);
            pdf.setFont(undefined, 'bold');
            pdf.text(employee.name, margin, y);
            
            // Simple rating display
            const rating = data.overallRating ? data.overallRating.toUpperCase() : 'PENDING';
            let ratingColor = [0, 115, 206]; // Sam's blue
            
            if (data.overallRating === 'exemplary') {
                ratingColor = [40, 167, 69];
            } else if (data.overallRating === 'opportunity') {
                ratingColor = [220, 53, 69];
            }
            
            pdf.setTextColor(...ratingColor);
            pdf.setFontSize(12);
            pdf.setFont(undefined, 'bold');
            pdf.text(`Performance Rating: ${rating}`, pageWidth - margin, y, { align: 'right' });
            
            addSpace(20);
            
            // PDF now matches slide 6 structure exactly
            
            // Generate the same comprehensive summary as slide 6
            const hasContent = {
                keyPriorities: data.keyPriorities && data.keyPriorities.trim().length > 0,
                resultsImpact: data.resultsImpact && data.resultsImpact.trim().length > 0,
                collaboration: data.collaboration && data.collaboration.trim().length > 0,
                growth: data.growth && data.growth.trim().length > 0,
                lookingAhead: data.lookingAhead && data.lookingAhead.trim().length > 0,
                overallRating: data.overallRating && data.overallRating.trim().length > 0
            };
            
            const contentCount = Object.values(hasContent).filter(Boolean).length;
            
            // Only show calibration points if we have sufficient content (matching slide 6 logic)
            if (contentCount >= 4) {
                // Simple section header
                pdf.setTextColor(0, 115, 206);
                pdf.setFontSize(12);
                pdf.setFont(undefined, 'bold');
                pdf.text('CALIBRATION DISCUSSION POINTS', margin, y);
                
                // Underline
                pdf.setDrawColor(0, 115, 206);
                pdf.setLineWidth(0.5);
                pdf.line(margin, y + 2, margin + 80, y + 2);
                
                addSpace(15);
                
                const calibrationPoints = generateSpecificCalibrationPoints(data, hasContent);
                
                calibrationPoints.forEach((point, index) => {
                    // Simple bullet point
                    pdf.setTextColor(0, 115, 206);
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`${index + 1}.`, margin, y);
                    
                    // Point text
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFontSize(9);
                    pdf.setFont(undefined, 'normal');
                    const lines = pdf.splitTextToSize(point, contentWidth - 10);
                    pdf.text(lines, margin + 8, y);
                    
                    const textHeight = lines.length * 4;
                    y += textHeight + 6;
                    
                    if (y > pageHeight - 30) {
                        pdf.addPage();
                        y = margin;
                    }
                });
                
                addSpace(10);
            }
            
            // Executive summary removed - go straight to detailed sections for cleaner calibration focus
            
            // Clean sections
            const sections = [
                { key: 'keyPriorities', title: 'KEY PRIORITIES & OBJECTIVES', content: data.keyPriorities },
                { key: 'resultsImpact', title: 'RESULTS & BUSINESS IMPACT', content: data.resultsImpact },
                { key: 'collaboration', title: 'COLLABORATION & INFLUENCE', content: data.collaboration },
                { key: 'growth', title: 'GROWTH & DEVELOPMENT', content: data.growth },
                { key: 'lookingAhead', title: 'LOOKING AHEAD', content: data.lookingAhead }
            ];

            sections.forEach((section, index) => {
                if (hasContent[section.key]) {
                    // Check for new page
                    if (y > pageHeight - 50) {
                        pdf.addPage();
                        y = margin;
                    }
                    
                    // Simple section header
                    pdf.setTextColor(0, 115, 206);
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(section.title, margin, y);
                    
                    addSpace(8);
                    
                    // Content
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFontSize(9);
                    pdf.setFont(undefined, 'normal');
                    
                    const content = section.content.trim();
                    const lines = pdf.splitTextToSize(content, contentWidth);
                    pdf.text(lines, margin, y);
                    y += lines.length * 4 + 10;
                }
            });
            
            addSpace(8);
            
            // Simple notes section
            if (y > pageHeight - 60) {
                pdf.addPage();
                y = margin;
            }
            
            pdf.setTextColor(0, 115, 206);
            pdf.setFontSize(10);
            pdf.setFont(undefined, 'bold');
            pdf.text('NOTES:', margin, y);
            
            addSpace(10);
            
            // Simple note lines
            pdf.setDrawColor(200, 200, 200);
            pdf.setLineWidth(0.2);
            for (let i = 0; i < 8; i++) {
                pdf.line(margin, y, margin + contentWidth, y);
                addSpace(6);
            }
            
            // Simple footer
            const pageCount = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                pdf.setPage(i);
                
                pdf.setFontSize(8);
                pdf.setTextColor(102, 102, 102);
                pdf.text(`Generated: ${currentDate}`, margin, pageHeight - 5);
                pdf.text(`Page ${i} of ${pageCount}`, pageWidth / 2, pageHeight - 5, { align: 'center' });
                pdf.text('Confidential', pageWidth - margin, pageHeight - 5, { align: 'right' });
            }
            
            // Save the PDF
            pdf.save(`${employee.name.replace(/\s+/g, '_')}_Calibration_Summary_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function exportEvaluations() {
            const reviewer = reviewerData[currentReviewer];
            const employees = Object.values(reviewer.employees || {}).filter(emp => !emp.archived);
            
            if (employees.length === 0) {
                alert('No evaluations to export.');
                return;
            }
            
            // Create PDF using jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPos = 20;
            const pageWidth = doc.internal.pageSize.width;
            const marginX = 20;
            
            // Header
            doc.setFillColor(0, 67, 160);
            doc.rect(0, 0, pageWidth, 35, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('ALL TEAM EVALUATIONS EXPORT', marginX, 25);
            
            // Report info
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            yPos = 50;
            
            doc.text(`Reviewer: ${reviewer.name.replace(/[^\x00-\x7F]/g, '')}`, marginX, yPos);
            yPos += 8;
            doc.text(`Export Date: ${new Date().toLocaleDateString()}`, marginX, yPos);
            yPos += 8;
            doc.text(`Total Evaluations: ${employees.length}`, marginX, yPos);
            yPos += 20;
            
            // Process each employee
            employees.forEach((employee, index) => {
                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Employee header
                doc.setFillColor(240, 248, 255);
                doc.rect(marginX - 5, yPos - 8, pageWidth - (marginX * 2) + 10, 20, 'F');
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 67, 160);
                doc.text(`${index + 1}. ${employee.name.replace(/[^\x00-\x7F]/g, '')}`, marginX, yPos);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text(`Position: ${employee.position.replace(/[^\x00-\x7F]/g, '')}`, marginX, yPos + 8);
                
                // Status and rating
                const status = employee.status.charAt(0).toUpperCase() + employee.status.slice(1).replace('-', ' ');
                const rating = employee.evaluationData?.overallRating || 'Not Rated';
                doc.text(`Status: ${status} | Rating: ${rating.charAt(0).toUpperCase() + rating.slice(1)}`, marginX + 100, yPos + 8);
                
                yPos += 25;
                
                // Evaluation details if completed
                if (employee.evaluationData && employee.status === 'completed') {
                    const sections = [
                        { key: 'keyPriorities', title: 'Key Priorities' },
                        { key: 'resultsImpact', title: 'Results & Impact' },
                        { key: 'collaboration', title: 'Collaboration & Influence' },
                        { key: 'growth', title: 'Growth & Development' },
                        { key: 'lookingAhead', title: 'Looking Ahead' }
                    ];
                    
                    sections.forEach(section => {
                        const content = employee.evaluationData[section.key];
                        if (content && content.trim()) {
                            // Check page break
                            if (yPos > 260) {
                                doc.addPage();
                                yPos = 20;
                            }
                            
                            doc.setFontSize(10);
                            doc.setFont(undefined, 'bold');
                            doc.text(`${section.title}:`, marginX + 5, yPos);
                            yPos += 6;
                            
                            doc.setFont(undefined, 'normal');
                            
                            // Clean content to remove problematic characters for PDF
                            const cleanContent = content.replace(/[^\x00-\x7F]/g, ''); // Remove non-ASCII characters
                            
                            // Split long text into multiple lines
                            const lines = doc.splitTextToSize(cleanContent, pageWidth - marginX - 30);
                            lines.forEach(line => {
                                if (yPos > 280) {
                                    doc.addPage();
                                    yPos = 20;
                                }
                                doc.text(line, marginX + 10, yPos);
                                yPos += 5;
                            });
                            yPos += 3;
                        }
                    });
                } else if (employee.status === 'in-progress') {
                    doc.setFontSize(10);
                    doc.setTextColor(255, 193, 7);
                    doc.text('WARNING: Evaluation in progress - partial data only', marginX + 5, yPos);
                    yPos += 8;
                    doc.setTextColor(0, 0, 0);
                } else {
                    doc.setFontSize(10);
                    doc.setTextColor(220, 53, 69);
                    doc.text('INCOMPLETE: Evaluation not started', marginX + 5, yPos);
                    yPos += 8;
                    doc.setTextColor(0, 0, 0);
                }
                
                yPos += 15;
            });
            
            // Footer on all pages
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`Sam's Club Calibration Discussion Prep Tool - All Evaluations Export`, marginX, doc.internal.pageSize.height - 15);
                doc.text(`Page ${i} of ${pageCount}`, pageWidth - 40, doc.internal.pageSize.height - 15);
                doc.text(`Generated: ${new Date().toLocaleString()}`, marginX, doc.internal.pageSize.height - 8);
            }
            
            // Download the PDF
            const fileName = `${reviewer.name.replace(/\s+/g, '_')}_All_Evaluations_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        // Intelligent Navigation System with Auto-save
        function setupAutoSave() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', (event) => {
                    // Don't process input events while loading employee data
                    if (window.loadingEmployeeData) return;
                    
                    const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
                    
                    // Direct status change for completed evaluations
                    if (employee && employee.status === 'completed') {
                        // DIRECTLY change status to in-progress
                        employee.status = 'in-progress';
                        employee.statusChangeReason = `Modified ${event.target.id || 'evaluation field'}`;
                        employee.lastUpdated = new Date().toISOString();
                        
                        // Save immediately
                        saveReviewerData();
                        
                        // Update status display
                        updateStatusDisplay();
                        
                        // Auto-regenerate comprehensive summary if on that step
                        if (currentStep === 6) {
                            setTimeout(() => {
                                generateComprehensiveSummary();
                            }, 200);
                        }
                        
                    }
                    
                    // Auto-save after short delay
                    setTimeout(saveEmployeeEvaluation, 300);
                });

                // Also save on blur (when user finishes with a field)
                input.addEventListener('blur', (event) => {
                    // Don't process blur events while loading employee data
                    if (window.loadingEmployeeData) return;
                    
                    // Just save the data, no auto-advancement
                    setTimeout(saveEmployeeEvaluation, 300);
                });
            });
        }

        // Backend logic to check step completion (auto-advancement disabled)
        function checkForAutoAdvancement(triggerElement) {
            // Auto-advancement is disabled - users must click "Next" button
            // This function now only performs validation and saves data
            
            if (window.loadingEmployeeData) return;
            if (!triggerElement || !currentEmployee || !reviewerData[currentReviewer]) return;

            const employee = reviewerData[currentReviewer].employees[currentEmployee];
            if (!employee || !employee.evaluationData) return;

            const data = employee.evaluationData;
            const stepComplete = checkCurrentStepCompletion(data);

            // Only log completion status, no auto-advancement
            if (stepComplete) {
                console.log(`Step ${currentStep + 1} is complete. User must click "Next" to proceed.`);
                
                // Optional: Show a subtle indicator that the step is ready to advance
                const nextBtn = document.getElementById('nextBtn');
                if (nextBtn && !nextBtn.classList.contains('step-ready')) {
                    nextBtn.classList.add('step-ready');
                    nextBtn.style.backgroundColor = '#00AFD7';
                    nextBtn.style.transform = 'scale(1.02)';
                }
            }
        }

        // Check if current step has sufficient content to advance
        function checkCurrentStepCompletion(data) {
            switch (currentStep) {
                case 0: // Basic Information & Rating
                    return data.employeeName && 
                           data.reviewerName && 
                           data.overallRating && 
                           data.overallRating !== '';

                case 1: // Key Priorities
                    return data.keyPriorities && 
                           data.keyPriorities.trim().length > 50;

                case 2: // Collaboration & Influence
                    return data.collaboration && 
                           data.collaboration.trim().length > 50;

                case 3: // Growth & Development
                    return data.growth && 
                           data.growth.trim().length > 50;

                case 4: // Looking Ahead
                    return data.lookingAhead && 
                           data.lookingAhead.trim().length > 50;

                case 6: // Comprehensive Summary (final step)
                    return false; // Don't auto-advance from final step

                default:
                    return false;
            }
        }





        function generateComprehensiveSummary() {
            const employee = reviewerData[currentReviewer]?.employees[currentEmployee];
            if (!employee) return;

            const evalData = employee.evaluationData || {};
            const includeMetrics = document.getElementById('includeMetrics')?.checked;
            const includeDevelopment = document.getElementById('includeDevelopment')?.checked;
            const includeStrengths = document.getElementById('includeStrengths')?.checked;

            // Check if evaluation has meaningful content
            const hasContent = {
                keyPriorities: evalData.keyPriorities && evalData.keyPriorities.trim().length > 0,
                resultsImpact: evalData.resultsImpact && evalData.resultsImpact.trim().length > 0,
                collaboration: evalData.collaboration && evalData.collaboration.trim().length > 0,
                growth: evalData.growth && evalData.growth.trim().length > 0,
                lookingAhead: evalData.lookingAhead && evalData.lookingAhead.trim().length > 0,
                overallRating: evalData.overallRating && evalData.overallRating !== ''
            };

            const contentCount = Object.values(hasContent).filter(Boolean).length;

            let summary = `Performance Evaluation Summary: ${evalData.employeeName || employee.name}\n`;
            summary += `Review Period: ${evalData.reviewPeriod || 'Current Period'}\n`;
            summary += `Overall Rating: ${evalData.overallRating ? evalData.overallRating.charAt(0).toUpperCase() + evalData.overallRating.slice(1) : 'Not Set'}\n\n`;

            // If evaluation is mostly empty, show appropriate message
            if (contentCount === 0) {
                summary += `EVALUATION STATUS:\n`;
                summary += `This evaluation has not been started. No performance data has been entered yet.\n\n`;
                summary += `NEXT STEPS:\n`;
                summary += `• Complete the Key Priorities section\n`;
                summary += `• Document Results & Impact with specific examples\n`;
                summary += `• Assess Collaboration & Influence capabilities\n`;
                summary += `• Identify Growth & Development opportunities\n`;
                summary += `• Set Looking Ahead goals and expectations\n`;
                summary += `• Assign an overall performance rating\n\n`;
                summary += `CALIBRATION NOTES:\n`;
                summary += `Evaluation cannot be discussed in calibration meetings until all sections are completed with sufficient detail and supporting evidence.`;
            } else if (contentCount < 3) {
                summary += `EVALUATION STATUS:\n`;
                summary += `This evaluation is in progress but incomplete (${contentCount} of 6 sections completed).\n\n`;
                
                // Show what's completed
                if (hasContent.overallRating) summary += `✓ Overall Rating: ${evalData.overallRating.charAt(0).toUpperCase() + evalData.overallRating.slice(1)}\n`;
                if (hasContent.keyPriorities) summary += `✓ Key Priorities completed\n`;
                if (hasContent.resultsImpact) summary += `✓ Results & Impact completed\n`;
                if (hasContent.collaboration) summary += `✓ Collaboration & Influence completed\n`;
                if (hasContent.growth) summary += `✓ Growth & Development completed\n`;
                if (hasContent.lookingAhead) summary += `✓ Looking Ahead completed\n`;

                summary += `\nREMAINING SECTIONS TO COMPLETE:\n`;
                if (!hasContent.overallRating) summary += `• Overall Performance Rating\n`;
                if (!hasContent.keyPriorities) summary += `• Key Priorities & Objectives\n`;
                if (!hasContent.resultsImpact) summary += `• Results & Business Impact\n`;
                if (!hasContent.collaboration) summary += `• Collaboration & Influence\n`;
                if (!hasContent.growth) summary += `• Growth & Development\n`;
                if (!hasContent.lookingAhead) summary += `• Looking Ahead Goals\n`;

                summary += `\nCALIBRATION READINESS:\n`;
                summary += `Evaluation requires additional completion before being ready for calibration discussions.`;
            } else {
                // Generate content-based calibration discussion points from actual evaluation inputs FIRST
                if (contentCount >= 4) {
                    summary += `CALIBRATION DISCUSSION POINTS:\n\n`;
                    
                    // Generate specific, actionable talking points from actual content
                    const specificPoints = generateSpecificCalibrationPoints(evalData, hasContent);
                    specificPoints.forEach((point, index) => {
                        summary += `${index + 1}. ${point}\n\n`;
                    });
                }

                // Remove executive summary - go straight to detailed sections

                // Key Priorities Section - only if content exists
                if (hasContent.keyPriorities) {
                    summary += `KEY PRIORITIES & OBJECTIVES:\n`;
                    summary += `${evalData.keyPriorities.trim()}\n\n`;
                }

                // Results & Impact Section - only if content exists
                if (hasContent.resultsImpact) {
                    summary += `RESULTS & BUSINESS IMPACT:\n`;
                    summary += `${evalData.resultsImpact.trim()}\n\n`;
                }

                // Collaboration Section - only if content exists
                if (hasContent.collaboration) {
                    summary += `COLLABORATION & INFLUENCE:\n`;
                    summary += `${evalData.collaboration.trim()}\n\n`;
                }

                // Strengths Section - only if content exists and option is checked
                if (includeStrengths && (hasContent.keyPriorities || hasContent.resultsImpact || hasContent.collaboration || hasContent.growth)) {
                    summary += `KEY STRENGTHS & CAPABILITIES:\n`;
                    const strengths = [];
                    
                    if (hasContent.keyPriorities && (evalData.keyPriorities.includes('exceeded') || evalData.keyPriorities.includes('achieved'))) {
                        strengths.push('Strong execution of strategic priorities');
                    }
                    
                    if (hasContent.resultsImpact && /\d+%|\$[\d,]+/.test(evalData.resultsImpact)) {
                        strengths.push('Delivers measurable business results');
                    }
                    
                    if (hasContent.collaboration && (evalData.collaboration.includes('partner') || evalData.collaboration.includes('team'))) {
                        strengths.push('Effective cross-functional collaboration');
                    }
                    
                    if (hasContent.growth && (evalData.growth.includes('develop') || evalData.growth.includes('learn'))) {
                        strengths.push('Commitment to continuous learning and development');
                    }

                    if (strengths.length > 0) {
                        strengths.forEach(strength => summary += `• ${strength}\n`);
                        summary += `\n`;
                    }
                }

                // Growth & Development Section - only if content exists
                if (hasContent.growth) {
                    summary += `GROWTH & DEVELOPMENT:\n`;
                    summary += `${evalData.growth.trim()}\n\n`;
                }

                // Development Areas Section - only if content exists
                if (includeDevelopment && hasContent.lookingAhead) {
                    summary += `DEVELOPMENT OPPORTUNITIES & NEXT STEPS:\n`;
                    summary += `${evalData.lookingAhead.trim()}\n\n`;
                }


            }



            // Update the textarea
            const summaryTextarea = document.getElementById('comprehensiveSummary');
            if (summaryTextarea) {
                summaryTextarea.value = summary;
                // Update stats
                updateSummaryStats(summary, evalData.overallRating);
            }
        }

        // Generate detailed, specific calibration snapshots from evaluation content
        function generateSpecificCalibrationPoints(evalData, hasContent) {
            const points = [];
            
            // Performance snapshot with specific achievements and metrics
            if (hasContent.keyPriorities) {
                const text = evalData.keyPriorities;
                const snapshot = [];
                
                // Extract specific achievements with context
                const achievementPhrases = text.match(/[^.!?]*(?:exceeded|achieved|delivered|completed|generated|increased|improved|saved)[^.!?]*[.!?]/gi);
                if (achievementPhrases && achievementPhrases.length > 0) {
                    achievementPhrases.slice(0, 2).forEach(phrase => {
                        snapshot.push(phrase.trim().replace(/^[^A-Za-z]*/, ''));
                    });
                }
                
                // Add any specific metrics found
                const metrics = text.match(/\d+%|\$[\d,]+(?:\.\d+)?[MK]?/g);
                if (metrics && metrics.length > 0) {
                    snapshot.push(`Key metrics: ${metrics.slice(0, 3).join(', ')}`);
                }
                
                if (snapshot.length > 0) {
                    points.push(`Performance Snapshot: ${snapshot.join(' | ')}`);
                }
            }
            
            // Collaboration snapshot with specific examples and partnerships
            if (hasContent.collaboration) {
                const text = evalData.collaboration;
                const snapshot = [];
                
                // Extract specific collaboration examples
                const collaborationExamples = text.match(/[^.!?]*(?:collaborated|partnered|worked|facilitated|coordinated)[^.!?]*[.!?]/gi);
                if (collaborationExamples && collaborationExamples.length > 0) {
                    const bestExample = collaborationExamples[0].trim().replace(/^[^A-Za-z]*/, '');
                    if (bestExample.length < 120) {
                        snapshot.push(bestExample);
                    } else {
                        snapshot.push(bestExample.substring(0, 117) + '...');
                    }
                }
                
                // Extract teams/departments worked with
                const teamMatches = text.match(/(IT|Marketing|Sales|Finance|Operations|Customer|Legal|HR|Analytics|Product|Engineering|Design|Executive|Leadership)\s*(?:team|department|group|leadership)?/gi);
                if (teamMatches && teamMatches.length > 0) {
                    const uniqueTeams = [...new Set(teamMatches.slice(0, 3))];
                    snapshot.push(`Teams: ${uniqueTeams.join(', ')}`);
                }
                
                if (snapshot.length > 0) {
                    points.push(`Collaboration Snapshot: ${snapshot.join(' | ')}`);
                }
            }
            
            // Development snapshot with specific growth areas and actions
            if (hasContent.growth) {
                const text = evalData.growth;
                const snapshot = [];
                
                // Extract specific development priorities
                const priorities = [];
                if (text.includes('(1)')) {
                    const priority1 = text.match(/\(1\)[^(2)]*/);
                    if (priority1) {
                        priorities.push(priority1[0].replace('(1)', '').trim().split('.')[0]);
                    }
                }
                
                if (priorities.length === 0) {
                    // Look for key development themes
                    const developmentMatches = text.match(/(?:develop|enhance|build|strengthen|improve)[^.!?]*[.!?]/gi);
                    if (developmentMatches && developmentMatches.length > 0) {
                        priorities.push(developmentMatches[0].trim());
                    }
                }
                
                if (priorities.length > 0) {
                    snapshot.push(`Priority: ${priorities[0]}`);
                }
                
                // Extract recommended actions/programs
                const actionMatches = text.match(/(?:recommend|suggest|propose)[^.!?]*[.!?]/gi);
                if (actionMatches && actionMatches.length > 0) {
                    const action = actionMatches[0].trim().replace(/^[^A-Za-z]*/, '');
                    snapshot.push(`Action: ${action}`);
                }
                
                if (snapshot.length > 0) {
                    points.push(`Development Snapshot: ${snapshot.join(' | ')}`);
                }
            }
            
            // Career trajectory snapshot with specific advancement details
            if (hasContent.lookingAhead) {
                const text = evalData.lookingAhead;
                const snapshot = [];
                
                // Extract advancement potential
                const advancementMatches = text.match(/(?:positioned|ready|prepared)[^.!?]*(?:advancement|promotion|director|senior|VP|CMO)[^.!?]*[.!?]/gi);
                if (advancementMatches && advancementMatches.length > 0) {
                    snapshot.push(advancementMatches[0].trim());
                }
                
                // Extract timeline information
                const timeMatches = text.match(/(?:\d+-\d+\s*months?|\d+\s*years?|next\s+year|within\s+\d+[^.!?]*)/gi);
                if (timeMatches && timeMatches.length > 0) {
                    snapshot.push(`Timeline: ${timeMatches[0].trim()}`);
                }
                
                // Extract readiness indicators
                if (text.toLowerCase().includes('ready') || text.toLowerCase().includes('prepared')) {
                    snapshot.push('Promotion ready');
                } else if (text.toLowerCase().includes('development') || text.toLowerCase().includes('support')) {
                    snapshot.push('Requires development support');
                }
                
                if (snapshot.length > 0) {
                    points.push(`Career Trajectory: ${snapshot.join(' | ')}`);
                }
            }
            
            return points;
        }

        // Helper functions to extract meaningful discussion points from evaluation content
        function extractAchievements(keyPrioritiesText) {
            const achievements = [];
            const text = keyPrioritiesText.toLowerCase();
            
            // Look for achievement indicators
            if (text.includes('exceeded') || text.includes('surpassed')) {
                achievements.push('Exceeded performance targets');
            }
            if (text.includes('delivered') || text.includes('completed')) {
                achievements.push('Successfully delivered key objectives');
            }
            
            // Extract specific metrics if present
            const metrics = keyPrioritiesText.match(/\d+%|\$[\d,]+|\d+\.\d+/g);
            if (metrics && metrics.length > 0) {
                achievements.push(`Achieved measurable results (${metrics.slice(0, 2).join(', ')})`);
            }
            
            return achievements;
        }
        
        function extractCollaborationInsights(collaborationText) {
            const text = collaborationText.toLowerCase();
            const insights = [];
            
            if (text.includes('cross-functional') || text.includes('partnership')) {
                insights.push('Strong cross-functional partnership capabilities');
            }
            if (text.includes('conflict') || text.includes('challenge')) {
                insights.push('navigates collaboration challenges effectively');
            }
            if (text.includes('influence') || text.includes('stakeholder')) {
                insights.push('demonstrates stakeholder influence and management skills');
            }
            
            return insights.length > 0 ? insights.join(', ') : 'Documented collaboration effectiveness with multiple teams';
        }
        
        function extractDevelopmentPriorities(growthText) {
            const priorities = [];
            
            // Look for numbered priorities or key development areas
            if (growthText.includes('(1)') || growthText.includes('first') || growthText.includes('priority')) {
                const matches = growthText.match(/\(1\)[^(2)]*|\bfirst[^.]*\.|priority[^.]*\./gi);
                if (matches) {
                    priorities.push(matches[0].replace(/^\(1\)\s*|first\s*|priority\s*/i, '').trim());
                }
            }
            
            // Extract key development themes
            if (growthText.toLowerCase().includes('leadership')) {
                priorities.push('Leadership development identified as key area');
            }
            if (growthText.toLowerCase().includes('strategic') || growthText.toLowerCase().includes('strategy')) {
                priorities.push('Strategic thinking enhancement needed');
            }
            
            return priorities.length > 0 ? priorities.join('; ') : 'Specific development areas identified for targeted growth';
        }
        
        function extractPotentialIndicators(lookingAheadText) {
            const text = lookingAheadText.toLowerCase();
            
            if (text.includes('advancement') || text.includes('promotion')) {
                return 'Ready for advancement opportunities and increased scope';
            }
            if (text.includes('director') || text.includes('senior') || text.includes('lead')) {
                return 'Positioned for senior role progression within organization';
            }
            if (text.includes('development') && text.includes('support')) {
                return 'Requires targeted development support for continued growth';
            }
            
            return 'Clear development pathway and future growth potential identified';
        }
        
        function getRatingContext(rating, evalData) {
            const hasQuantitativeData = /\d+%|\$[\d,]+/.test(evalData.keyPriorities || '') || /\d+%|\$[\d,]+/.test(evalData.collaboration || '');
            
            if (rating === 'exemplary') {
                return hasQuantitativeData ? 
                    'Exceptional performance with documented quantitative impact and leadership demonstration' :
                    'Exceptional performance demonstrated through strategic contributions and leadership excellence';
            } else if (rating === 'successful') {
                return hasQuantitativeData ?
                    'Consistent performance meeting expectations with measurable business contributions' :
                    'Solid performance consistently meeting role expectations and organizational standards';
            } else {
                return 'Developing performance with identified areas for improvement and targeted support needs';
            }
        }

        function updateSummaryStats(summary, rating) {
            const wordCount = summary.trim().split(/\s+/).length;
            const readTime = Math.ceil(wordCount / 200); // Average reading speed 200 words/minute

            const wordCountElement = document.getElementById('summaryWordCount');
            const readTimeElement = document.getElementById('summaryReadTime');
            const ratingElement = document.getElementById('summaryRating');

            if (wordCountElement) wordCountElement.textContent = wordCount;
            if (readTimeElement) readTimeElement.textContent = `${readTime} min`;
            if (ratingElement) ratingElement.textContent = rating ? rating.charAt(0).toUpperCase() + rating.slice(1) : 'Not Set';
        }

        function copySummaryToClipboard() {
            const summaryTextarea = document.getElementById('comprehensiveSummary');
            if (summaryTextarea) {
                summaryTextarea.select();
                summaryTextarea.setSelectionRange(0, 99999); // For mobile devices
                
                try {
                    document.execCommand('copy');
                    
                    // Show temporary feedback
                    const copyBtn = document.querySelector('button[onclick="copySummaryToClipboard()"]');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'Copied!';
                        copyBtn.style.background = '#28a745';
                        
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                            copyBtn.style.background = '';
                        }, 2000);
                    }
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
            }
        }

        function downloadSummaryAsPDF() {
            // Use the same PDF format as the individual evaluation download
            if (!currentEmployee) {
                alert('Please select an employee first.');
                return;
            }
            
            // Call the improved downloadIndividualEvaluationPDF function
            downloadIndividualEvaluationPDF(currentEmployee, null);
        }

        // Organization Data - will be populated from CSV
        let organizationData = {};
        let allManagers = [];
        let selectedReviewer = null;
        let highlightedIndex = -1;

        // Enhanced Reviewer Search Functions
        async function loadOrganizationData() {
            try {
                const response = await fetch('Org Roster .csv');
                const csvText = await response.text();
                parseOrganizationCSV(csvText);
            } catch (error) {
                console.error('Error loading organization data:', error);
                // Fallback to demo data
                loadDemoOrganizationData();
            }
        }

        function parseOrganizationCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            
            // Clear existing data
            organizationData = {};
            allManagers = [];
            
            // Process each employee row
            for (let i = 1; i < lines.length; i++) {
                const row = parseCSVRow(lines[i]);
                if (row.length < 5) continue; // Skip incomplete rows
                
                const employee = {
                    firstName: row[0]?.trim() || '',
                    lastName: row[1]?.trim() || '',
                    level: row[2]?.trim() || '',
                    position: row[3]?.trim() || '',
                    manager: row[4]?.trim() || ''
                };
                
                // Skip if no manager or employee name
                if (!employee.manager || (!employee.firstName && !employee.lastName)) continue;
                
                const fullName = `${employee.firstName} ${employee.lastName}`.trim();
                const manager = employee.manager;
                
                // Initialize manager entry if doesn't exist
                if (!organizationData[manager]) {
                    organizationData[manager] = [];
                    allManagers.push(manager);
                }
                
                // Add employee to manager's team
                organizationData[manager].push({
                    id: `emp_${i}`,
                    name: fullName,
                    position: employee.position,
                    level: employee.level,
                    status: 'not-started',
                    evaluationData: {},
                    lastUpdated: new Date().toISOString()
                });
            }
            
            // Sort managers alphabetically by last name and remove duplicates
            allManagers = [...new Set(allManagers)].sort((a, b) => {
                const lastNameA = a.split(' ').pop().toLowerCase();
                const lastNameB = b.split(' ').pop().toLowerCase();
                return lastNameA.localeCompare(lastNameB);
            });
            
            console.log(`Loaded ${allManagers.length} managers with ${Object.values(organizationData).reduce((sum, team) => sum + team.length, 0)} total employees`);
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"' && (i === 0 || row[i-1] === ',')) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes && (i === row.length - 1 || row[i+1] === ',')) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        function loadDemoOrganizationData() {
            // Fallback demo data if CSV fails to load
            organizationData = {
                'Sarah Johnson': [
                    { id: 'emp1', name: 'Alice Thompson', position: 'Marketing Specialist', level: 'H', status: 'not-started' },
                    { id: 'emp2', name: 'Bob Wilson', position: 'Brand Analyst', level: 'I', status: 'not-started' }
                ],
                'Mike Chen': [
                    { id: 'emp3', name: 'Carol Davis', position: 'Creative Director', level: 'G', status: 'not-started' },
                    { id: 'emp4', name: 'David Lee', position: 'UX Designer', level: 'H', status: 'not-started' }
                ],
                'Lisa Williams': [
                    { id: 'emp5', name: 'Emily Brown', position: 'Marketing Manager', level: 'F', status: 'not-started' }
                ]
            };
            allManagers = Object.keys(organizationData).sort((a, b) => {
                const lastNameA = a.split(' ').pop().toLowerCase();
                const lastNameB = b.split(' ').pop().toLowerCase();
                return lastNameA.localeCompare(lastNameB);
            });
        }

        function showReviewerDropdown() {
            const dropdown = document.getElementById('reviewerDropdown');
            if (dropdown && allManagers.length === 0) {
                loadOrganizationData();
            }
            
            setTimeout(() => {
                if (dropdown) {
                    dropdown.style.display = 'block';
                    updateDropdownContent('');
                }
            }, 100);
        }

        function searchReviewers() {
            const searchTerm = document.getElementById('reviewerSearch').value;
            updateDropdownContent(searchTerm);
            highlightedIndex = -1;
        }

        function updateDropdownContent(searchTerm) {
            const dropdown = document.getElementById('reviewerDropdown');
            if (!dropdown) return;
            
            if (allManagers.length === 0) {
                dropdown.innerHTML = '<div class="dropdown-loading">Loading organization data...</div>';
                return;
            }
            
            const filteredManagers = allManagers.filter(manager => 
                manager.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredManagers.length === 0) {
                dropdown.innerHTML = '<div class="no-results">No managers found matching your search</div>';
                return;
            }
            
            dropdown.innerHTML = filteredManagers.map((manager, index) => {
                const teamSize = organizationData[manager] ? organizationData[manager].length : 0;
                return `
                    <div class="reviewer-option" data-manager="${manager}" onclick="selectReviewer('${manager}')" title="Team Size: ${teamSize} direct reports">
                        <div class="reviewer-name">${manager}</div>
                    </div>
                `;
            }).join('');
        }

        function selectReviewer(managerName) {
            selectedReviewer = managerName;
            document.getElementById('reviewerSearch').value = managerName;
            document.getElementById('reviewerDropdown').style.display = 'none';
            document.getElementById('accessBtn').disabled = false;
            
            // Highlight selected option
            document.querySelectorAll('.reviewer-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-manager="${managerName}"]`)?.classList.add('selected');
        }

        function selectFirstReviewer() {
            const firstOption = document.querySelector('.reviewer-option');
            if (firstOption) {
                const managerName = firstOption.getAttribute('data-manager');
                selectReviewer(managerName);
            }
        }

        function loginSelectedReviewer() {
            if (!selectedReviewer) {
                alert('Please select a manager from the list');
                return;
            }
            
            // Auto-generate reviewer ID from name
            const reviewerId = selectedReviewer.toLowerCase().replace(/\s+/g, '.').replace(/[^a-z0-9.]/g, '');
            
            currentReviewer = reviewerId;
            
            // Initialize reviewer data with their actual team from CSV
            if (!reviewerData[reviewerId]) {
                const teamData = {};
                const employees = organizationData[selectedReviewer] || [];
                
                employees.forEach(emp => {
                    teamData[emp.id] = {
                        ...emp,
                        lastUpdated: new Date().toISOString()
                    };
                });
                
                reviewerData[reviewerId] = {
                    name: selectedReviewer,
                    employees: teamData,
                    createdDate: new Date().toISOString()
                };
                saveReviewerData();
            }
            
            // Update URL and load dashboard
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('reviewer', reviewerId);
            window.history.pushState({}, '', newUrl);
            
            loadReviewerDashboard();
        }

        // Hide dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const container = event.target.closest('.reviewer-search-container');
            if (!container) {
                const dropdown = document.getElementById('reviewerDropdown');
                if (dropdown) {
                    dropdown.style.display = 'none';
                }
            }
        });

        // Keyboard navigation for dropdown
        document.addEventListener('keydown', function(event) {
            const dropdown = document.getElementById('reviewerDropdown');
            if (!dropdown || dropdown.style.display === 'none') return;
            
            const options = dropdown.querySelectorAll('.reviewer-option');
            if (options.length === 0) return;
            
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                highlightedIndex = Math.min(highlightedIndex + 1, options.length - 1);
                updateHighlight(options);
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                highlightedIndex = Math.max(highlightedIndex - 1, -1);
                updateHighlight(options);
            } else if (event.key === 'Enter' && highlightedIndex >= 0) {
                event.preventDefault();
                const selectedOption = options[highlightedIndex];
                const managerName = selectedOption.getAttribute('data-manager');
                selectReviewer(managerName);
            }
        });

        function updateHighlight(options) {
            options.forEach((option, index) => {
                option.classList.remove('highlighted');
                if (index === highlightedIndex) {
                    option.classList.add('highlighted');
                    option.scrollIntoView({ block: 'nearest' });
                }
            });
        }

        // Employee Search Variables
        let selectedEmployeeId = null;
        let employeeHighlightedIndex = -1;
        let currentEmployees = [];

        // Employee Search Functions
        function showEmployeeDropdown() {
            const dropdown = document.getElementById('employeeDropdown');
            if (dropdown) {
                dropdown.style.display = 'block';
                updateEmployeeDropdownContent('');
            }
        }

        function searchEmployees() {
            const searchTerm = document.getElementById('employeeSearch').value;
            updateEmployeeDropdownContent(searchTerm);
            employeeHighlightedIndex = -1;
        }

        function updateEmployeeDropdownContent(searchTerm) {
            const dropdown = document.getElementById('employeeDropdown');
            if (!dropdown) return;
            
            // Get current employees from reviewer data
            const reviewer = reviewerData[currentReviewer];
            if (!reviewer || !reviewer.employees) {
                dropdown.innerHTML = '<div class="dropdown-loading">No team members found...</div>';
                return;
            }
            
            currentEmployees = Object.values(reviewer.employees)
                .filter(emp => !emp.archived)
                .sort((a, b) => {
                    const lastNameA = a.name.split(' ').pop().toLowerCase();
                    const lastNameB = b.name.split(' ').pop().toLowerCase();
                    return lastNameA.localeCompare(lastNameB);
                });
            
            const filteredEmployees = currentEmployees.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredEmployees.length === 0) {
                dropdown.innerHTML = '<div class="no-results">No team members found matching your search</div>';
                return;
            }
            
            dropdown.innerHTML = filteredEmployees.map((emp, index) => {
                const statusText = emp.status === 'completed' ? 'Complete' : 
                                 emp.status === 'in-progress' ? 'In Progress' : 'Not Started';
                const statusClass = emp.status.replace('-', '');
                
                return `
                    <div class="employee-option" data-employee-id="${emp.id}" onclick="selectEmployee('${emp.id}', '${emp.name}')">
                        <div class="employee-name">${emp.name}</div>
                        <div class="employee-status-info">
                            <span class="status-indicator ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectEmployee(employeeId, employeeName) {
            selectedEmployeeId = employeeId;
            document.getElementById('employeeSearch').value = employeeName;
            document.getElementById('employeeDropdown').style.display = 'none';
            
            // Highlight selected option
            document.querySelectorAll('.employee-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-employee-id="${employeeId}"]`)?.classList.add('selected');
            
            // Show employee actions panel
            handleEmployeeSelection(employeeId);
        }

        function selectFirstEmployee() {
            const firstOption = document.querySelector('.employee-option');
            if (firstOption) {
                const employeeId = firstOption.getAttribute('data-employee-id');
                const employeeName = firstOption.querySelector('.employee-name').textContent;
                selectEmployee(employeeId, employeeName);
            }
        }

        // Enhanced handleEmployeeSelection for the new dropdown
        function handleEmployeeSelection(employeeId) {
            selectedEmployeeId = employeeId;
            const actionsPanel = document.getElementById('employee-actions-panel');
            
            if (employeeId) {
                const employee = reviewerData[currentReviewer]?.employees[employeeId];
                if (employee) {
                    // Show actions panel if it exists
                    if (actionsPanel) {
                        actionsPanel.style.display = 'block';
                        
                        // Update download functionality based on employee data
                        const hasEvalData = employee.evaluationData && Object.keys(employee.evaluationData).length > 0;
                        const downloadBtn = actionsPanel.querySelector('.smart-action-item:nth-child(2)');
                        if (downloadBtn) {
                            downloadBtn.style.opacity = hasEvalData ? '1' : '0.5';
                            downloadBtn.style.pointerEvents = hasEvalData ? 'auto' : 'none';
                        }
                    }
                }
            } else if (actionsPanel) {
                actionsPanel.style.display = 'none';
            }
        }

        // Hide employee dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const employeeContainer = event.target.closest('.employee-search-container');
            const reviewerContainer = event.target.closest('.reviewer-search-container');
            
            if (!employeeContainer) {
                const employeeDropdown = document.getElementById('employeeDropdown');
                if (employeeDropdown) {
                    employeeDropdown.style.display = 'none';
                }
            }
            
            if (!reviewerContainer) {
                const reviewerDropdown = document.getElementById('reviewerDropdown');
                if (reviewerDropdown) {
                    reviewerDropdown.style.display = 'none';
                }
            }
        });

        // Enhanced keyboard navigation for both dropdowns
        document.addEventListener('keydown', function(event) {
            // Handle reviewer dropdown
            const reviewerDropdown = document.getElementById('reviewerDropdown');
            if (reviewerDropdown && reviewerDropdown.style.display !== 'none') {
                const options = reviewerDropdown.querySelectorAll('.reviewer-option');
                if (options.length > 0) {
                    if (event.key === 'ArrowDown') {
                        event.preventDefault();
                        highlightedIndex = Math.min(highlightedIndex + 1, options.length - 1);
                        updateHighlight(options);
                    } else if (event.key === 'ArrowUp') {
                        event.preventDefault();
                        highlightedIndex = Math.max(highlightedIndex - 1, -1);
                        updateHighlight(options);
                    } else if (event.key === 'Enter' && highlightedIndex >= 0) {
                        event.preventDefault();
                        const selectedOption = options[highlightedIndex];
                        const managerName = selectedOption.getAttribute('data-manager');
                        selectReviewer(managerName);
                    }
                }
                return;
            }
            
            // Handle employee dropdown
            const employeeDropdown = document.getElementById('employeeDropdown');
            if (employeeDropdown && employeeDropdown.style.display !== 'none') {
                const options = employeeDropdown.querySelectorAll('.employee-option');
                if (options.length > 0) {
                    if (event.key === 'ArrowDown') {
                        event.preventDefault();
                        employeeHighlightedIndex = Math.min(employeeHighlightedIndex + 1, options.length - 1);
                        updateEmployeeHighlight(options);
                    } else if (event.key === 'ArrowUp') {
                        event.preventDefault();
                        employeeHighlightedIndex = Math.max(employeeHighlightedIndex - 1, -1);
                        updateEmployeeHighlight(options);
                    } else if (event.key === 'Enter' && employeeHighlightedIndex >= 0) {
                        event.preventDefault();
                        const selectedOption = options[employeeHighlightedIndex];
                        const employeeId = selectedOption.getAttribute('data-employee-id');
                        const employeeName = selectedOption.querySelector('.employee-name').textContent;
                        selectEmployee(employeeId, employeeName);
                    }
                }
            }
        });

        function updateEmployeeHighlight(options) {
            options.forEach((option, index) => {
                option.classList.remove('highlighted');
                if (index === employeeHighlightedIndex) {
                    option.classList.add('highlighted');
                    option.scrollIntoView({ block: 'nearest' });
                }
            });
        }

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            initializeReviewerSystem();
        });
    </script>
    

</body>
</html>